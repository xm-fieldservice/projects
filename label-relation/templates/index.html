<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…³ç³»çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://unpkg.com/@antv/g6@4.8.24/dist/g6.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #f5f5f5;
        }
        
        .header {
            background: #001529;
            color: white;
            padding: 16px 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 500;
        }
        
        .container {
            display: flex;
            height: calc(100vh - 64px);
        }
        
        .sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid #e8e8e8;
            padding: 24px;
            overflow-y: auto;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .toolbar {
            background: white;
            border-bottom: 1px solid #e8e8e8;
            padding: 16px 24px;
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .graph-container {
            flex: 1;
            position: relative;
            background: white;
        }
        
        .tab-container {
            background: white;
            border-bottom: 1px solid #e8e8e8;
        }
        
        .tab-list {
            display: flex;
            padding: 0 24px;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #1890ff;
            border-bottom-color: #1890ff;
        }
        
        .tab-content {
            display: none;
            padding: 24px;
            height: calc(100vh - 160px);
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #1890ff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #40a9ff;
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            border: 1px solid #d9d9d9;
        }
        
        .btn-secondary:hover {
            background: #e6f7ff;
            border-color: #1890ff;
        }
        
        .search-box {
            position: relative;
            max-width: 300px;
        }
        
        .search-box input {
            padding-right: 40px;
        }
        
        .search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 16px;
            overflow: hidden;
        }
        
        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e8e8e8;
            font-weight: 500;
            color: #333;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .timeline-container {
            height: 400px;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
        }
        
        .project-form {
            max-width: 600px;
        }
        
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
            margin-bottom: 8px;
        }
        
        .task-name {
            font-weight: 500;
        }
        
        .task-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
        }
        
        .status-todo { background: #666; }
        .status-progress { background: #1890ff; }
        .status-done { background: #52c41a; }
        
        .progress-bar {
            width: 100px;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #1890ff;
            transition: width 0.3s;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #a8071a;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 16px;
        }
        
        .success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #389e0d;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 16px;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 200px;
            }
            
            .tab-list {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>å…³ç³»çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ</h1>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <div class="card">
                <div class="card-header">å›¾è°±æ§åˆ¶</div>
                <div class="card-body">
                    <div class="form-group">
                        <label>èŠ‚ç‚¹ç±»å‹ç­›é€‰</label>
                        <select class="form-control" id="nodeTypeFilter">
                            <option value="">å…¨éƒ¨ç±»å‹</option>
                            <option value="Person">äººå‘˜</option>
                            <option value="Project">é¡¹ç›®</option>
                            <option value="Task">ä»»åŠ¡</option>
                            <option value="Document">æ–‡æ¡£</option>
                            <option value="Event">äº‹ä»¶</option>
                            <option value="Organization">ç»„ç»‡</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>å¸ƒå±€ç®—æ³•</label>
                        <select class="form-control" id="layoutSelect">
                            <option value="force">åŠ›å¯¼å‘å¸ƒå±€</option>
                            <option value="circular">ç¯å½¢å¸ƒå±€</option>
                            <option value="radial">è¾å°„å¸ƒå±€</option>
                            <option value="grid">ç½‘æ ¼å¸ƒå±€</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="applyFilter()">åº”ç”¨ç­›é€‰</button>
                    <button class="btn btn-secondary" onclick="resetGraph()">é‡ç½®å›¾è°±</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">å¿«é€Ÿæ“ä½œ</div>
                <div class="card-body">
                    <button class="btn btn-primary" onclick="showCreateEntityModal()" style="width: 100%; margin-bottom: 8px;">åˆ›å»ºå®ä½“</button>
                    <button class="btn btn-primary" onclick="showCreateRelationModal()" style="width: 100%; margin-bottom: 8px;">åˆ›å»ºå…³ç³»</button>
                    <button class="btn btn-secondary" onclick="exportGraph()" style="width: 100%;">å¯¼å‡ºå›¾è°±</button>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="tab-container">
                <div class="tab-list">
                    <div class="tab active" data-tab="graph">å…³ç³»å›¾è°±</div>
                    <div class="tab" data-tab="knowledge">çŸ¥è¯†ç®¡ç†</div>
                    <div class="tab" data-tab="project">é¡¹ç›®ç®¡ç†</div>
                    <div class="tab" data-tab="timeline">æ—¶é—´è½´è§†å›¾</div>
                </div>
            </div>
            
            <!-- å…³ç³»å›¾è°±æ ‡ç­¾é¡µ -->
            <div class="tab-content active" id="graph-tab">
                <div class="toolbar">
                    <div class="search-box">
                        <input type="text" class="form-control" placeholder="æœç´¢èŠ‚ç‚¹..." id="searchInput">
                        <button class="search-btn" onclick="searchNodes()">ğŸ”</button>
                    </div>
                    <button class="btn btn-secondary" onclick="fitView()">é€‚åº”ç”»å¸ƒ</button>
                    <button class="btn btn-secondary" onclick="zoomIn()">æ”¾å¤§</button>
                    <button class="btn btn-secondary" onclick="zoomOut()">ç¼©å°</button>
                </div>
                <div class="graph-container" id="graph-container"></div>
            </div>
            
            <!-- çŸ¥è¯†ç®¡ç†æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="knowledge-tab">
                <div class="card">
                    <div class="card-header">æ–‡æ¡£å¤„ç†</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>æ–‡æ¡£å†…å®¹</label>
                            <textarea class="form-control" rows="6" id="documentContent" placeholder="è¯·è¾“å…¥æ–‡æ¡£å†…å®¹..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>æ–‡æ¡£æ ‡é¢˜</label>
                            <input type="text" class="form-control" id="documentTitle" placeholder="è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜">
                        </div>
                        <div class="form-group">
                            <label>æ–‡æ¡£ç±»å‹</label>
                            <select class="form-control" id="documentType">
                                <option value="contract">åˆåŒ</option>
                                <option value="report">æŠ¥å‘Š</option>
                                <option value="policy">æ”¿ç­–</option>
                                <option value="meeting">ä¼šè®®è®°å½•</option>
                                <option value="other">å…¶ä»–</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="processDocument()">å¤„ç†æ–‡æ¡£</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">çŸ¥è¯†æœç´¢</div>
                    <div class="card-body">
                        <div class="form-group">
                            <input type="text" class="form-control" id="knowledgeSearch" placeholder="è¾“å…¥æœç´¢å…³é”®è¯...">
                        </div>
                        <button class="btn btn-primary" onclick="searchKnowledge()">æœç´¢</button>
                        <div id="searchResults" style="margin-top: 16px;"></div>
                    </div>
                </div>
            </div>
            
            <!-- é¡¹ç›®ç®¡ç†æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="project-tab">
                <div class="card">
                    <div class="card-header">åˆ›å»ºé¡¹ç›®</div>
                    <div class="card-body project-form">
                        <div class="form-group">
                            <label>é¡¹ç›®åç§°</label>
                            <input type="text" class="form-control" id="projectName" placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°">
                        </div>
                        <div class="form-group">
                            <label>é¡¹ç›®æè¿°</label>
                            <textarea class="form-control" rows="3" id="projectDescription" placeholder="è¯·è¾“å…¥é¡¹ç›®æè¿°"></textarea>
                        </div>
                        <div style="display: flex; gap: 16px;">
                            <div class="form-group" style="flex: 1;">
                                <label>å¼€å§‹æ—¥æœŸ</label>
                                <input type="date" class="form-control" id="projectStartDate">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label>ç»“æŸæ—¥æœŸ</label>
                                <input type="date" class="form-control" id="projectEndDate">
                            </div>
                        </div>
                        <div style="display: flex; gap: 16px;">
                            <div class="form-group" style="flex: 1;">
                                <label>ä¼˜å…ˆçº§</label>
                                <select class="form-control" id="projectPriority">
                                    <option value="low">ä½</option>
                                    <option value="medium" selected>ä¸­</option>
                                    <option value="high">é«˜</option>
                                    <option value="critical">ç´§æ€¥</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label>çŠ¶æ€</label>
                                <select class="form-control" id="projectStatus">
                                    <option value="planning">è§„åˆ’ä¸­</option>
                                    <option value="active" selected>è¿›è¡Œä¸­</option>
                                    <option value="paused">æš‚åœ</option>
                                    <option value="completed">å·²å®Œæˆ</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="createProject()">åˆ›å»ºé¡¹ç›®</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">ä»»åŠ¡ç®¡ç†</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>é€‰æ‹©é¡¹ç›®</label>
                            <select class="form-control" id="taskProjectSelect">
                                <option value="">è¯·å…ˆåˆ›å»ºé¡¹ç›®</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ä»»åŠ¡åç§°</label>
                            <input type="text" class="form-control" id="taskName" placeholder="è¯·è¾“å…¥ä»»åŠ¡åç§°">
                        </div>
                        <div class="form-group">
                            <label>ä»»åŠ¡æè¿°</label>
                            <textarea class="form-control" rows="3" id="taskDescription" placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°"></textarea>
                        </div>
                        <div style="display: flex; gap: 16px;">
                            <div class="form-group" style="flex: 1;">
                                <label>è´Ÿè´£äºº</label>
                                <input type="text" class="form-control" id="taskAssignee" placeholder="è¯·è¾“å…¥è´Ÿè´£äºº">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label>è¿›åº¦ (%)</label>
                                <input type="number" class="form-control" id="taskProgress" min="0" max="100" value="0">
                            </div>
                        </div>
                        <div style="display: flex; gap: 16px;">
                            <div class="form-group" style="flex: 1;">
                                <label>å¼€å§‹æ—¥æœŸ</label>
                                <input type="date" class="form-control" id="taskStartDate">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label>ç»“æŸæ—¥æœŸ</label>
                                <input type="date" class="form-control" id="taskEndDate">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="createTask()">åˆ›å»ºä»»åŠ¡</button>
                        <div id="taskList" style="margin-top: 16px;"></div>
                    </div>
                </div>
            </div>
            
            <!-- æ—¶é—´è½´è§†å›¾æ ‡ç­¾é¡µ -->
            <div class="tab-content" id="timeline-tab">
                <div class="card">
                    <div class="card-header">é¡¹ç›®æ—¶é—´è½´</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>é€‰æ‹©é¡¹ç›®</label>
                            <select class="form-control" id="timelineProjectSelect">
                                <option value="">è¯·é€‰æ‹©é¡¹ç›®</option>
                            </select>
                        </div>
                        <div class="timeline-container" id="timeline-container">
                            <div class="loading">è¯·é€‰æ‹©é¡¹ç›®æŸ¥çœ‹æ—¶é—´è½´</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let graph = null;
        let currentProject = null;
        let projects = [];
        
        // åˆå§‹åŒ–å›¾è°±
        function initGraph() {
            const container = document.getElementById('graph-container');
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            graph = new G6.Graph({
                container: 'graph-container',
                width: width,
                height: height,
                modes: {
                    default: [
                        'drag-canvas',
                        'zoom-canvas',
                        'drag-node',
                        'click-select'
                    ]
                },
                defaultNode: {
                    size: 30,
                    style: {
                        fill: '#1890FF',
                        stroke: '#FFF',
                        lineWidth: 2
                    },
                    labelCfg: {
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#333'
                        }
                    }
                },
                defaultEdge: {
                    style: {
                        stroke: '#666',
                        lineWidth: 2,
                        endArrow: {
                            path: G6.Arrow.triangle(8, 8),
                            fill: '#666'
                        }
                    },
                    labelCfg: {
                        autoRotate: true,
                        style: {
                            fontSize: 10,
                            fill: '#666'
                        }
                    }
                },
                layout: {
                    type: 'force',
                    preventOverlap: true,
                    nodeSpacing: 80,
                    linkDistance: 150
                }
            });
            
            // ç»‘å®šäº‹ä»¶
            graph.on('node:click', (e) => {
                const item = e.item;
                const model = item.getModel();
                showNodeInfo(model);
            });
            
            graph.on('edge:click', (e) => {
                const item = e.item;
                const model = item.getModel();
                showEdgeInfo(model);
            });
            
            // åŠ è½½æ•°æ®
            loadGraphData();
        }
        
        // åŠ è½½å›¾è°±æ•°æ®
        async function loadGraphData() {
            try {
                const response = await axios.get('/api/graph/data');
                const data = response.data;
                
                graph.data(data);
                graph.render();
                graph.fitView();
            } catch (error) {
                console.error('åŠ è½½å›¾è°±æ•°æ®å¤±è´¥:', error);
                showMessage('åŠ è½½å›¾è°±æ•°æ®å¤±è´¥', 'error');
            }
        }
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        function initTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                    tab.classList.add('active');
                    const targetTab = tab.getAttribute('data-tab');
                    document.getElementById(targetTab + '-tab').classList.add('active');
                    
                    // ç‰¹æ®Šå¤„ç†å›¾è°±æ ‡ç­¾é¡µ
                    if (targetTab === 'graph' && graph) {
                        setTimeout(() => {
                            graph.changeSize(
                                document.getElementById('graph-container').clientWidth,
                                document.getElementById('graph-container').clientHeight
                            );
                            graph.fitView();
                        }, 100);
                    }
                });
            });
        }
        
        // åº”ç”¨ç­›é€‰
        function applyFilter() {
            const nodeType = document.getElementById('nodeTypeFilter').value;
            const layout = document.getElementById('layoutSelect').value;
            
            // æ›´æ–°å¸ƒå±€
            graph.updateLayout({
                type: layout,
                preventOverlap: true,
                nodeSpacing: 80,
                linkDistance: 150
            });
            
            // ç­›é€‰èŠ‚ç‚¹
            const nodes = graph.getNodes();
            nodes.forEach(node => {
                const model = node.getModel();
                if (nodeType && model.type !== nodeType) {
                    graph.hideItem(node);
                } else {
                    graph.showItem(node);
                }
            });
        }
        
        // é‡ç½®å›¾è°±
        function resetGraph() {
            document.getElementById('nodeTypeFilter').value = '';
            document.getElementById('layoutSelect').value = 'force';
            
            const nodes = graph.getNodes();
            nodes.forEach(node => {
                graph.showItem(node);
            });
            
            graph.updateLayout({
                type: 'force',
                preventOverlap: true,
                nodeSpacing: 80,
                linkDistance: 150
            });
            
            graph.fitView();
        }
        
        // æœç´¢èŠ‚ç‚¹
        function searchNodes() {
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            if (!keyword) return;
            
            const nodes = graph.getNodes();
            let foundNode = null;
            
            nodes.forEach(node => {
                const model = node.getModel();
                if (model.label && model.label.toLowerCase().includes(keyword)) {
                    foundNode = node;
                    graph.setItemState(node, 'highlight', true);
                } else {
                    graph.setItemState(node, 'highlight', false);
                }
            });
            
            if (foundNode) {
                graph.focusItem(foundNode, true);
            }
        }
        
        // é€‚åº”ç”»å¸ƒ
        function fitView() {
            graph.fitView();
        }
        
        // æ”¾å¤§
        function zoomIn() {
            const zoom = graph.getZoom();
            graph.zoomTo(zoom * 1.2);
        }
        
        // ç¼©å°
        function zoomOut() {
            const zoom = graph.getZoom();
            graph.zoomTo(zoom / 1.2);
        }
        
        // å¤„ç†æ–‡æ¡£
        async function processDocument() {
            const content = document.getElementById('documentContent').value;
            const title = document.getElementById('documentTitle').value;
            const type = document.getElementById('documentType').value;
            
            if (!content || !title) {
                showMessage('è¯·å¡«å†™æ–‡æ¡£å†…å®¹å’Œæ ‡é¢˜', 'error');
                return;
            }
            
            try {
                const response = await axios.post('/api/documents', {
                    content: content,
                    metadata: {
                        title: title,
                        type: type,
                        created_at: new Date().toISOString()
                    }
                });
                
                showMessage('æ–‡æ¡£å¤„ç†æˆåŠŸ', 'success');
                
                // æ¸…ç©ºè¡¨å•
                document.getElementById('documentContent').value = '';
                document.getElementById('documentTitle').value = '';
                
                // é‡æ–°åŠ è½½å›¾è°±
                loadGraphData();
            } catch (error) {
                console.error('æ–‡æ¡£å¤„ç†å¤±è´¥:', error);
                showMessage('æ–‡æ¡£å¤„ç†å¤±è´¥', 'error');
            }
        }
        
        // æœç´¢çŸ¥è¯†
        async function searchKnowledge() {
            const query = document.getElementById('knowledgeSearch').value;
            if (!query) return;
            
            try {
                const response = await axios.get('/api/search', {
                    params: { q: query }
                });
                
                const results = response.data;
                displaySearchResults(results);
            } catch (error) {
                console.error('æœç´¢å¤±è´¥:', error);
                showMessage('æœç´¢å¤±è´¥', 'error');
            }
        }
        
        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displaySearchResults(results) {
            const container = document.getElementById('searchResults');
            
            if (results.length === 0) {
                container.innerHTML = '<p>æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</p>';
                return;
            }
            
            let html = '<h4>æœç´¢ç»“æœ:</h4>';
            results.forEach(result => {
                html += `
                    <div class="card" style="margin-bottom: 12px;">
                        <div class="card-body">
                            <h5>${result.metadata.title || 'æœªçŸ¥æ–‡æ¡£'}</h5>
                            <p><strong>å®ä½“:</strong> ${result.entity.name} (${result.entity.type})</p>
                            <p><strong>ç±»å‹:</strong> ${result.metadata.type || 'æœªçŸ¥'}</p>
                            <p><strong>å†…å®¹æ‘˜è¦:</strong> ${result.document.content.substring(0, 100)}...</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // åˆ›å»ºé¡¹ç›®
        async function createProject() {
            const name = document.getElementById('projectName').value;
            const description = document.getElementById('projectDescription').value;
            const startDate = document.getElementById('projectStartDate').value;
            const endDate = document.getElementById('projectEndDate').value;
            const priority = document.getElementById('projectPriority').value;
            const status = document.getElementById('projectStatus').value;
            
            if (!name || !startDate || !endDate) {
                showMessage('è¯·å¡«å†™é¡¹ç›®åç§°å’Œæ—¶é—´èŒƒå›´', 'error');
                return;
            }
            
            try {
                const response = await axios.post('/api/projects', {
                    name: name,
                    description: description,
                    start_date: startDate,
                    end_date: endDate,
                    priority: priority,
                    status: status
                });
                
                showMessage('é¡¹ç›®åˆ›å»ºæˆåŠŸ', 'success');
                
                // æ¸…ç©ºè¡¨å•
                document.getElementById('projectName').value = '';
                document.getElementById('projectDescription').value = '';
                document.getElementById('projectStartDate').value = '';
                document.getElementById('projectEndDate').value = '';
                
                // æ›´æ–°é¡¹ç›®é€‰æ‹©å™¨
                updateProjectSelectors();
                
                // é‡æ–°åŠ è½½å›¾è°±
                loadGraphData();
            } catch (error) {
                console.error('åˆ›å»ºé¡¹ç›®å¤±è´¥:', error);
                showMessage('åˆ›å»ºé¡¹ç›®å¤±è´¥', 'error');
            }
        }
        
        // åˆ›å»ºä»»åŠ¡
        async function createTask() {
            const projectId = document.getElementById('taskProjectSelect').value;
            const name = document.getElementById('taskName').value;
            const description = document.getElementById('taskDescription').value;
            const assignee = document.getElementById('taskAssignee').value;
            const progress = document.getElementById('taskProgress').value;
            const startDate = document.getElementById('taskStartDate').value;
            const endDate = document.getElementById('taskEndDate').value;
            
            if (!projectId || !name || !startDate || !endDate) {
                showMessage('è¯·å¡«å†™å¿…è¦çš„ä»»åŠ¡ä¿¡æ¯', 'error');
                return;
            }
            
            try {
                const response = await axios.post(`/api/projects/${projectId}/tasks`, {
                    name: name,
                    description: description,
                    assignee: assignee,
                    progress: parseInt(progress),
                    start_date: startDate,
                    end_date: endDate,
                    status: 'todo',
                    priority: 'medium'
                });
                
                showMessage('ä»»åŠ¡åˆ›å»ºæˆåŠŸ', 'success');
                
                // æ¸…ç©ºè¡¨å•
                document.getElementById('taskName').value = '';
                document.getElementById('taskDescription').value = '';
                document.getElementById('taskAssignee').value = '';
                document.getElementById('taskProgress').value = '0';
                document.getElementById('taskStartDate').value = '';
                document.getElementById('taskEndDate').value = '';
                
                // é‡æ–°åŠ è½½å›¾è°±
                loadGraphData();
            } catch (error) {
                console.error('åˆ›å»ºä»»åŠ¡å¤±è´¥:', error);
                showMessage('åˆ›å»ºä»»åŠ¡å¤±è´¥', 'error');
            }
        }
        
        // æ›´æ–°é¡¹ç›®é€‰æ‹©å™¨
        function updateProjectSelectors() {
            // è¿™é‡Œåº”è¯¥ä»åç«¯è·å–é¡¹ç›®åˆ—è¡¨
            // ä¸ºäº†æ¼”ç¤ºï¼Œå…ˆä½¿ç”¨é™æ€æ•°æ®
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            
            // æ’å…¥åˆ°å½“å‰æ´»åŠ¨çš„æ ‡ç­¾é¡µé¡¶éƒ¨
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(messageDiv, activeTab.firstChild);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
        
        // æ˜¾ç¤ºèŠ‚ç‚¹ä¿¡æ¯
        function showNodeInfo(model) {
            console.log('èŠ‚ç‚¹ä¿¡æ¯:', model);
            // è¿™é‡Œå¯ä»¥æ·»åŠ èŠ‚ç‚¹è¯¦æƒ…æ¨¡æ€æ¡†
        }
        
        // æ˜¾ç¤ºè¾¹ä¿¡æ¯
        function showEdgeInfo(model) {
            console.log('å…³ç³»ä¿¡æ¯:', model);
            // è¿™é‡Œå¯ä»¥æ·»åŠ å…³ç³»è¯¦æƒ…æ¨¡æ€æ¡†
        }
        
        // å¯¼å‡ºå›¾è°±
        function exportGraph() {
            const dataURL = graph.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = 'å…³ç³»å›¾è°±.png';
            link.href = dataURL;
            link.click();
        }
        
        // çª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´å›¾è°±
        window.addEventListener('resize', () => {
            if (graph) {
                const container = document.getElementById('graph-container');
                graph.changeSize(container.clientWidth, container.clientHeight);
            }
        });
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initTabs();
            initGraph();
        });
    </script>
</body>
</html> 