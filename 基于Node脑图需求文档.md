基于Node.js的脑图开发需求文档  
**版本：1.0** | **日期：2025年06月02日**  

---

### **一、核心功能需求**
#### 1. **节点操作模块**  
- **增删改查**  
  - **添加节点**：支持通过快捷键（`Tab`添加子节点、`Enter`添加同级节点）或右键菜单操作。  
  - **删除节点**：选中节点后按`Delete`键或右键删除，自动递归删除子节点。  
  - **编辑节点**：双击节点文本直接编辑，支持实时保存。  
  - **移动节点**：拖拽调整位置，支持快捷键`Alt+↑/↓`调整层级关系。  
- **节点属性**  
  - 支持设置颜色、字体、边框样式（如`set_node_color()`、`set_font()`）。  
  - 节点展开/折叠：`expand_node()`展开子节点，`collapse_node()`收起子节点。  
- **动态交互**  
  - 节点拖拽时实时更新位置与连接线。  
  - 支持多选节点批量操作（如批量删除、样式统一）。  

#### 2. **标签系统**  
- **标签架构**  
  - 采用**分面结构**（Faceted Classification），支持多维度分类（如主题、优先级、状态）。  
  - 标签支持层级关系（父标签→子标签），例如：  
    ```plaintext
    技术栈 
      ├─ 前端：React  
      └─ 后端：Node.js  
    ```  
- **标签操作**  
  - 手动为节点添加/移除标签，支持标签自动补全。  
  - 按标签筛选节点，动态高亮关联内容。  
- **数据同步**  
  - 标签数据存储为JSON结构，与节点ID关联。  

#### 3. **节点详情页**  
- **详情页结构**  
  ```mermaid
  graph LR
    A[节点标题] --> B[标签列表]
    A --> C[MD格式内容]
    A --> D[编辑按钮]
  ```  
- **MD格式阅读器**  
  - 集成**Markdown解析引擎**（如`marked.js`），实时渲染节点内容为富文本。  
  - 支持语法高亮、表格、代码块等MD特性。  
- **详情页交互**  
  - 点击节点呼出详情弹窗，支持缩放与全屏模式。  

#### 4. **详情页手动编辑**  
- **富文本编辑器**  
  - 集成**所见即所得编辑器**（如`Quill`或`TinyMCE`），提供工具栏（加粗、列表、链接等）。  
  - 支持**双模式切换**：Markdown源码编辑 ↔ 可视化编辑。  
- **数据同步机制**  
  - 编辑内容自动保存至节点数据模型，实时更新脑图渲染。  
  - 版本历史记录：保存编辑历史，支持回滚。  

---

### **二、技术实现方案**
#### 1. **技术栈**  
| 模块          | 技术选型                     | 说明                          |
|---------------|------------------------------|-------------------------------|
| **前端框架**  | Vue.js + TypeScript          | 组件化开发，响应式数据绑定 |
| **脑图渲染**  | Go.js 或 AntV G6             | 动态布局算法（逻辑结构图） |
| **后端服务**  | Node.js + Express            | RESTful API 提供数据接口  |
| **数据库**    | MongoDB                      | 存储节点树、标签关系       |
| **MD解析器**  | marked.js + highlight.js     | 支持代码高亮与扩展语法     |

#### 2. **关键逻辑实现**  
- **节点定位算法**  
  根节点居中 → 子节点位置 = `父节点left + 父节点width + 间距`，递归计算层级。  
- **标签关联查询**  
  使用MongoDB聚合管道，按标签ID快速检索关联节点。  
- **实时协同编辑**  
  通过WebSocket同步详情页编辑内容（可选扩展功能）。  

---

### **三、非功能性需求**
1. **性能**  
   - 节点加载延迟 ≤ 100ms（千节点以内）。  
   - 详情页MD渲染时间 ≤ 50ms。  
2. **兼容性**  
   - 支持Chrome/Firefox/Safari最新版。  
3. **安全性**  
   - 详情页内容输入XSS过滤。  
4. **可维护性**  
   - 代码模块化：分离为`NodeService`、`TagSystem`、`DetailEditor`等独立模块。  

---

### **四、交付物与里程碑**
| 阶段       | 交付内容                     | 时间节点   |
|------------|------------------------------|------------|
| 原型设计   | 节点操作MVP + 脑图基础渲染   | 第1周      |
| Alpha版本  | 标签系统 + 详情页框架        | 第3周      |
| Beta版本   | MD编辑器集成 + 完整交互测试  | 第5周      |
| 正式发布   | 性能优化 + 文档完善          | 第8周      |

> **引用说明**：  
> - 节点操作逻辑参考；标签系统设计基于；  
> - MD阅读器实现借鉴；详情页编辑交互参考；  
> - 技术架构整合MERN方案与脑图布局算法。  
> 完整源码与API文档详见各引用来源。