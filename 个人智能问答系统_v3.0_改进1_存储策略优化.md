# ä¸ªäººæ™ºèƒ½é—®ç­”ç³»ç»Ÿ v3.0 æ”¹è¿›1ï¼šå­˜å‚¨ç­–ç•¥ä¼˜åŒ–

## ğŸ“‹ **æ”¹è¿›æ¦‚è¿°**

**æ”¹è¿›ç›®æ ‡**ï¼šä¼˜åŒ–v3.0ç‰ˆæœ¬çš„å­˜å‚¨ç­–ç•¥ï¼Œè§£å†³äº‘åŒæ­¥å¿…è¦æ€§é—®é¢˜ï¼Œæä¾›çµæ´»çš„ç”¨æˆ·é€‰æ‹©
**æ ¸å¿ƒæ”¹è¿›**ï¼šåŒè½¨å­˜å‚¨ç­–ç•¥ + ç”¨æˆ·è®¾ç½®å¼€å…³
**å½±å“èŒƒå›´**ï¼šQANoteBlockã€UIBlockã€ç”¨æˆ·è®¾ç½®ç•Œé¢

---

## ğŸ¤” **é—®é¢˜åˆ†æï¼šäº‘åŒæ­¥çš„å¿…è¦æ€§**

### **åŸå§‹é—®é¢˜**
v3.0æ–‡æ¡£ä¸­å­˜å‚¨ç­–ç•¥æ¦‚å¿µæ¨¡ç³Šï¼š
- äº‘ç«¯åŒæ­¥ vs æœåŠ¡å™¨å­˜å‚¨æ¦‚å¿µæ··æ·†
- æœ¬åœ°å­˜å‚¨ä¸æœåŠ¡å™¨å­˜å‚¨çš„å…³ç³»ä¸æ˜ç¡®
- ç”¨æˆ·æ— æ³•æ§åˆ¶å­˜å‚¨è¡Œä¸º

### **éƒ¨ç½²æ¶æ„é‡æ–°å®¡è§†**
```
ç”¨æˆ·æµè§ˆå™¨ â†â†’ æœåŠ¡å™¨(å‰ç«¯+åç«¯+æ•°æ®åº“)
```

**å…³é”®å‘ç°**ï¼šåœ¨æœåŠ¡å™¨éƒ¨ç½²æ¶æ„ä¸­ï¼Œ"äº‘åŒæ­¥"å®é™…ä¸Šå°±æ˜¯"æœåŠ¡å™¨å­˜å‚¨"ï¼Œç»å¯¹å¿…è¦ï¼

### **å­˜å‚¨å±‚æ¬¡é‡æ–°å®šä¹‰**

| å­˜å‚¨ç±»å‹ | å®é™…ä½ç½® | ä½œç”¨ | å¿…è¦æ€§ |
|----------|----------|------|--------|
| **æœåŠ¡å™¨æ•°æ®åº“** | éƒ¨ç½²æœåŠ¡å™¨ | ä¸»è¦æ•°æ®å­˜å‚¨ã€è·¨è®¾å¤‡åŒæ­¥ã€å›¢é˜Ÿå…±äº« | ğŸ”´ **å¿…é¡»** |
| **æµè§ˆå™¨localStorage** | ç”¨æˆ·è®¾å¤‡ | æœ¬åœ°ç¼“å­˜ã€å¿«é€Ÿè®¿é—®ã€ç¦»çº¿ä½“éªŒ | ğŸŸ¡ **å¯é€‰** |
| **æ–‡ä»¶ä¸‹è½½** | ç”¨æˆ·è®¾å¤‡ | ä¸ªäººå¤‡ä»½ã€ç¦»çº¿æŸ¥çœ‹ | ğŸŸ¢ **æ¨è** |

---

## ğŸ”„ **æ”¹è¿›æ–¹æ¡ˆï¼šåŒè½¨å­˜å‚¨ç­–ç•¥**

### **æ ¸å¿ƒè®¾è®¡ç†å¿µ**
- **æœåŠ¡å™¨å­˜å‚¨**ï¼šæ•°æ®æŒä¹…åŒ–ã€è·¨è®¾å¤‡åŒæ­¥ã€å›¢é˜Ÿå…±äº«
- **æœ¬åœ°å­˜å‚¨**ï¼šå¿«é€Ÿè®¿é—®ã€ç¦»çº¿ä½“éªŒã€ç”¨æˆ·ä½“éªŒä¼˜åŒ–  
- **ä¸¤è€…åŒæ­¥è¿›è¡Œ**ï¼šä¸æ˜¯ä¸»å¤‡å…³ç³»ï¼Œè€Œæ˜¯å¹¶è¡Œäº’è¡¥
- **ç”¨æˆ·å¯æ§**ï¼šé€šè¿‡è®¾ç½®å¼€å…³æ§åˆ¶æœ¬åœ°å­˜å‚¨è¡Œä¸º

### **å­˜å‚¨ç­–ç•¥å¯¹æ¯”**

| æ¨¡å¼ | æœåŠ¡å™¨å­˜å‚¨ | æœ¬åœ°å­˜å‚¨ | ç”¨æˆ·ä½“éªŒ | é€‚ç”¨åœºæ™¯ |
|------|------------|----------|----------|----------|
| **åŒè½¨æ¨¡å¼** | âœ… å¼€å¯ | âœ… å¼€å¯ | ğŸ”¥ æœ€ä½³ | ä¸ªäººä½¿ç”¨ã€éœ€è¦ç¦»çº¿è®¿é—® |
| **æœåŠ¡å™¨æ¨¡å¼** | âœ… å¼€å¯ | âŒ å…³é—­ | ğŸ¯ ç®€æ´ | å›¢é˜Ÿåä½œã€ä¼ä¸šç¯å¢ƒ |

---

## ğŸ’¡ **æŠ€æœ¯å®ç°æ–¹æ¡ˆ**

### **1. æ ¸å¿ƒå­˜å‚¨æ¥å£ä¼˜åŒ–**

```javascript
// QANoteBlock.js - ä¼˜åŒ–åçš„saveNoteæ–¹æ³•
saveNote: async (noteData) => {
    const localSyncEnabled = getLocalSyncEnabled();
    const startTime = Date.now();
    
    if (localSyncEnabled) {
        // ğŸ”„ åŒè½¨æ¨¡å¼ï¼šæœåŠ¡å™¨+æœ¬åœ°åŒæ­¥
        const [serverResult, localResult] = await Promise.allSettled([
            APIClient.saveNote(noteData),
            NotebookManager.saveNote(noteData.title, noteData.content, noteData.tags)
        ]);
        
        return {
            success: serverResult.status === 'fulfilled' && serverResult.value.success,
            data: {
                noteId: serverResult.status === 'fulfilled' ? 
                    serverResult.value.data.noteId : `local_${Date.now()}`,
                savedAt: new Date().toISOString(),
                storageMode: 'dual',
                storage: {
                    server: {
                        success: serverResult.status === 'fulfilled' && serverResult.value.success,
                        noteId: serverResult.status === 'fulfilled' ? serverResult.value.data.noteId : null,
                        error: serverResult.status === 'rejected' ? serverResult.reason.message : null
                    },
                    local: {
                        success: localResult.status === 'fulfilled',
                        cached: localResult.status === 'fulfilled',
                        downloaded: localResult.status === 'fulfilled',
                        error: localResult.status === 'rejected' ? localResult.reason.message : null
                    }
                },
                performance: {
                    totalTime: Date.now() - startTime,
                    mode: 'dual'
                }
            },
            error: serverResult.status === 'rejected' || 
                   (serverResult.status === 'fulfilled' && !serverResult.value.success) ?
                   'æœåŠ¡å™¨ä¿å­˜å¤±è´¥' + (localResult.status === 'fulfilled' ? 'ï¼Œä½†å·²ä¿å­˜åˆ°æœ¬åœ°' : '') :
                   null
        };
        
    } else {
        // ğŸ¯ æœåŠ¡å™¨æ¨¡å¼ï¼šä»…æœåŠ¡å™¨å­˜å‚¨
        try {
            const serverResult = await APIClient.saveNote(noteData);
            
            return {
                success: serverResult.success,
                data: {
                    noteId: serverResult.data.noteId,
                    savedAt: serverResult.data.savedAt,
                    storageMode: 'server-only',
                    storage: {
                        server: {
                            success: serverResult.success,
                            noteId: serverResult.data.noteId,
                            error: serverResult.success ? null : 'æœåŠ¡å™¨ä¿å­˜å¤±è´¥'
                        },
                        local: {
                            success: false,
                            cached: false,
                            downloaded: false,
                            disabled: true // æ ‡è®°ä¸ºç”¨æˆ·ä¸»åŠ¨ç¦ç”¨
                        }
                    },
                    performance: {
                        totalTime: Date.now() - startTime,
                        mode: 'server-only'
                    }
                },
                error: serverResult.success ? null : serverResult.error
            };
            
        } catch (error) {
            return {
                success: false,
                data: {
                    storageMode: 'server-only',
                    storage: {
                        server: { success: false, error: error.message },
                        local: { success: false, disabled: true }
                    }
                },
                error: `ä¿å­˜å¤±è´¥ï¼š${error.message}ï¼ˆæç¤ºï¼šå¯åœ¨è®¾ç½®ä¸­å¼€å¯æœ¬åœ°åŒæ­¥ä½œä¸ºå¤‡é€‰ï¼‰`
            };
        }
    }
}
```

### **2. é—®ç­”è‡ªåŠ¨ä¿å­˜ä¼˜åŒ–**

```javascript
// QANoteBlock.js - ä¼˜åŒ–åçš„askQuestionæ–¹æ³•
askQuestion: async (questionData) => {
    const response = await APIClient.sendQuestion(questionData);
    
    if (response.success && response.data.ai_response) {
        // ğŸ”„ æ ¹æ®ç”¨æˆ·è®¾ç½®è¿›è¡Œè‡ªåŠ¨ä¿å­˜
        const autoSaveResult = await this.saveNote({
            title: questionData.title,
            content: response.data.ai_response.response,
            tags: [...questionData.tags, 'AIé—®ç­”']
        });
        
        return {
            ...response,
            data: {
                ...response.data,
                autoSaved: autoSaveResult.success, // åŸºäºæœåŠ¡å™¨å­˜å‚¨æˆåŠŸä¸å¦
                autoSaveDetails: autoSaveResult,
                // ç”¨æˆ·åé¦ˆä¼˜åŒ–
                userMessage: autoSaveResult.data.storage.local.success ? 
                    'é—®ç­”å·²ä¿å­˜å¹¶å¯ç«‹å³æŸ¥çœ‹' : 'é—®ç­”å·²ä¿å­˜åˆ°æœåŠ¡å™¨'
            }
        };
    }
    
    return response;
}
```

### **3. æ•°æ®åŠ è½½ç­–ç•¥ä¼˜åŒ–**

```javascript
// QANoteBlock.js - æ™ºèƒ½æ•°æ®åŠ è½½
async loadNotebookPreview() {
    const localSyncEnabled = getLocalSyncEnabled();
    
    try {
        // æ€»æ˜¯ä»æœåŠ¡å™¨åŠ è½½æœ€æ–°æ•°æ®
        const serverNotes = await APIClient.getContent('note', 20);
        
        if (localSyncEnabled) {
            // æœ¬åœ°åŒæ­¥å¼€å¯æ—¶ï¼Œåˆå¹¶æœ¬åœ°æ•°æ®
            const localContent = NotebookManager.getNotebookContent();
            this.displayNotes({
                server: serverNotes.data || [],
                local: localContent,
                syncStatus: 'online',
                mode: 'dual'
            });
        } else {
            // ä»…æœåŠ¡å™¨æ¨¡å¼
            this.displayNotes({
                server: serverNotes.data || [],
                local: null,
                syncStatus: 'online',
                mode: 'server-only'
            });
        }
        
    } catch (error) {
        if (localSyncEnabled) {
            // æœ‰æœ¬åœ°å¤‡ä»½æ—¶çš„é™çº§
            const localContent = NotebookManager.getNotebookContent();
            this.displayNotes({
                server: [],
                local: localContent,
                syncStatus: 'offline',
                mode: 'local-fallback',
                message: 'æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨ï¼Œæ˜¾ç¤ºæœ¬åœ°æ•°æ®'
            });
        } else {
            // ä»…æœåŠ¡å™¨æ¨¡å¼çš„é”™è¯¯å¤„ç†
            this.displayNotes({
                server: [],
                local: null,
                syncStatus: 'error',
                mode: 'server-only',
                message: 'æ— æ³•è¿æ¥æœåŠ¡å™¨ï¼Œä¸”æœªå¼€å¯æœ¬åœ°ç¼“å­˜'
            });
        }
    }
}
```

---

## ğŸ”§ **æœ¬åœ°å­˜å‚¨å·¥å…·åŒ…å®ç°**

### **1. QANoteSaveræ ¸å¿ƒç±»è®¾è®¡**

ä¸ºäº†æ›´å¥½åœ°æ”¯æŒä¸‰ç§å­˜å‚¨åœºæ™¯ï¼Œæˆ‘ä»¬åŸºäºåŸæœ‰çš„æœ¬åœ°ç¬”è®°ä¿å­˜å·¥å…·ï¼Œåˆ›å»ºäº†ä¸“é—¨é€‚é…æ™ºèƒ½é—®ç­”ç³»ç»Ÿçš„`QANoteSaver`ç±»ï¼š

```javascript
// qa-note-saver.js - æ™ºèƒ½é—®ç­”ç³»ç»Ÿä¸“ç”¨å­˜å‚¨å™¨
class QANoteSaver {
    constructor(options = {}) {
        this.config = {
            // å­˜å‚¨æ¨¡å¼ï¼š'local' | 'server' | 'hybrid'
            mode: options.mode || 'local',
            
            // æœåŠ¡å™¨é…ç½®
            apiUrl: options.apiUrl || 'http://localhost:8000/api/v1',
            apiKey: options.apiKey || null,
            
            // åº”ç”¨é…ç½®
            appName: options.appName || 'æ™ºèƒ½é—®ç­”ç³»ç»Ÿ',
            debugMode: options.debugMode || false,
            
            // ç¦»çº¿ç­–ç•¥
            offlineMode: options.offlineMode || 'auto', // 'auto' | 'force' | 'disabled'
            
            // åŒæ­¥ç­–ç•¥
            syncStrategy: options.syncStrategy || 'immediate', // 'immediate' | 'batch' | 'manual'
            
            // ç¼“å­˜é…ç½®
            localCacheEnabled: options.localCacheEnabled !== false,
            maxCacheSize: options.maxCacheSize || 100,
            
            ...options
        };
        
        // æ ¸å¿ƒçŠ¶æ€
        this.isOnline = navigator.onLine;
        this.pendingQueue = []; // ç¦»çº¿æ—¶çš„å¾…å¤„ç†é˜Ÿåˆ—
        this.localCache = new Map(); // æœ¬åœ°ç¼“å­˜
        this.authToken = this.getAuthToken();
        
        this.init();
    }
}
```

### **2. ä¸‰ç§å­˜å‚¨æ¨¡å¼çš„å…·ä½“å®ç°**

#### **æ¨¡å¼1ï¼šçº¯æœ¬åœ°å­˜å‚¨**
```javascript
async saveToLocal(data) {
    this.log('ğŸ“‚ ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¨¡å¼');
    
    // æ ¼å¼åŒ–æ•°æ®
    const formattedData = this.formatForLocal(data);
    
    // å°è¯•ä½¿ç”¨File System API
    if ('showSaveFilePicker' in window && this.selectedFileHandle) {
        return await this.saveToLocalFile(formattedData);
    }
    
    // é™çº§ï¼šä½¿ç”¨localStorage + ä¸‹è½½
    return await this.saveToLocalStorage(formattedData);
}
```

#### **æ¨¡å¼2ï¼šæœåŠ¡å™¨å­˜å‚¨**
```javascript
async saveToServer(data) {
    this.log('ğŸŒ ä½¿ç”¨æœåŠ¡å™¨å­˜å‚¨æ¨¡å¼');
    
    // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
    if (!this.isOnline) {
        if (this.config.offlineMode === 'force') {
            throw new Error('ç½‘ç»œä¸å¯ç”¨ï¼Œä¸”ç¦ç”¨äº†ç¦»çº¿æ¨¡å¼');
        }
        
        // æ·»åŠ åˆ°ç¦»çº¿é˜Ÿåˆ—
        this.addToOfflineQueue(data);
        throw new Error('ç½‘ç»œä¸å¯ç”¨ï¼Œå·²æ·»åŠ åˆ°ç¦»çº¿é˜Ÿåˆ—');
    }
    
    // å‘é€åˆ°æœåŠ¡å™¨
    const response = await this.sendToAPI(data);
    
    // å¯é€‰ï¼šä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜
    if (this.config.localCacheEnabled) {
        this.saveToCache(data, response);
    }
    
    return response;
}
```

#### **æ¨¡å¼3ï¼šæ··åˆå­˜å‚¨**
```javascript
async saveToHybrid(data) {
    this.log('ğŸ”„ ä½¿ç”¨æ··åˆå­˜å‚¨æ¨¡å¼');
    
    const results = { local: null, server: null, mode: 'hybrid' };
    
    // ç«‹å³ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜
    results.local = await this.saveToLocalCache(data);
    
    // å°è¯•åŒæ­¥åˆ°æœåŠ¡å™¨
    if (this.isOnline) {
        try {
            results.server = await this.sendToAPI(data);
            results.synced = true;
        } catch (error) {
            this.log('âš ï¸ æœåŠ¡å™¨åŒæ­¥å¤±è´¥ï¼Œä»…ä¿å­˜åˆ°æœ¬åœ°:', error.message);
            this.addToOfflineQueue(data);
            results.synced = false;
            results.error = error.message;
        }
    } else {
        this.log('ğŸ“± ç¦»çº¿çŠ¶æ€ï¼Œä»…ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜');
        this.addToOfflineQueue(data);
        results.synced = false;
    }
    
    return results;
}
```

### **3. ç¦»çº¿é˜Ÿåˆ—åŒæ­¥æœºåˆ¶**

```javascript
// ç¦»çº¿é˜Ÿåˆ—ç®¡ç†
addToOfflineQueue(data) {
    this.pendingQueue.push({
        id: this.generateId(),
        data,
        timestamp: new Date().toISOString(),
        retryCount: 0
    });
    
    this.log(`ğŸ“‹ å·²æ·»åŠ åˆ°ç¦»çº¿é˜Ÿåˆ—ï¼Œå¾…å¤„ç†: ${this.pendingQueue.length} é¡¹`);
    this.persistOfflineQueue();
}

// åŒæ­¥ç¦»çº¿é˜Ÿåˆ—
async syncOfflineQueue() {
    if (this.pendingQueue.length === 0 || !this.isOnline) {
        return { synced: 0, failed: 0 };
    }
    
    this.log(`ğŸ”„ å¼€å§‹åŒæ­¥ç¦»çº¿é˜Ÿåˆ—: ${this.pendingQueue.length} é¡¹`);
    
    const results = { synced: 0, failed: 0, errors: [] };
    const failedItems = [];
    
    for (const item of this.pendingQueue) {
        try {
            await this.sendToAPI(item.data);
            results.synced++;
            this.log(`âœ… åŒæ­¥æˆåŠŸ: ${item.data.title}`);
        } catch (error) {
            item.retryCount++;
            if (item.retryCount < 3) {
                failedItems.push(item);
            }
            results.failed++;
            results.errors.push({ id: item.id, error: error.message });
            this.log(`âŒ åŒæ­¥å¤±è´¥: ${item.data.title} - ${error.message}`);
        }
    }
    
    // æ›´æ–°é˜Ÿåˆ—ï¼ˆåªä¿ç•™éœ€è¦é‡è¯•çš„é¡¹ï¼‰
    this.pendingQueue = failedItems;
    this.persistOfflineQueue();
    
    return results;
}
```

### **4. ç®€åŒ–é›†æˆæ¥å£**

ä¸ºäº†ä¾¿äºåœ¨æ™ºèƒ½é—®ç­”ç³»ç»Ÿä¸­å¿«é€Ÿé›†æˆï¼Œæä¾›äº†ç®€åŒ–çš„æ¥å£ï¼š

```javascript
// ç®€åŒ–çš„é›†æˆæ¥å£
class QANoteSaverSimple {
    constructor(apiUrl = 'http://localhost:8000/api/v1') {
        this.saver = new QANoteSaver({
            mode: 'hybrid',
            apiUrl: apiUrl,
            debugMode: false
        });
    }
    
    // ä¿å­˜ç¬”è®°
    async saveNote(title, content, tags = []) {
        return await this.saver.saveContent({
            title,
            content,
            type: 'note',
            tags
        });
    }
    
    // ä¿å­˜é—®ç­”
    async saveQA(title, content, agentId, tags = []) {
        return await this.saver.saveContent({
            title,
            content,
            type: 'qa',
            agentId,
            tags
        });
    }
    
    // è·å–çŠ¶æ€
    getStatus() {
        return this.saver.getStatus();
    }
}
```

### **5. æ™ºèƒ½é—®ç­”ç³»ç»Ÿé›†æˆç¤ºä¾‹**

#### **é›†æˆåˆ°QANoteBlock**
```javascript
// QANoteBlock.js - ä½¿ç”¨QANoteSaverçš„æ”¹è¿›ç‰ˆæœ¬
class QANoteBlock {
    constructor() {
        // åˆå§‹åŒ–QAä¸“ç”¨å­˜å‚¨å™¨
        this.qaSaver = new QANoteSaverSimple();
        
        // æ ¹æ®ç”¨æˆ·è®¾ç½®é€‰æ‹©å­˜å‚¨æ¨¡å¼
        const localSyncEnabled = getLocalSyncEnabled();
        this.qaSaver.saver.switchMode(localSyncEnabled ? 'hybrid' : 'server');
        
        this.init();
    }
    
    // ä¼˜åŒ–åçš„ä¿å­˜ç¬”è®°æ–¹æ³•
    async saveNote(noteData) {
        const startTime = Date.now();
        
        try {
            const result = await this.qaSaver.saveNote(
                noteData.title,
                noteData.content,
                noteData.tags
            );
            
            // æ ¹æ®å­˜å‚¨æ¨¡å¼ç”Ÿæˆç”¨æˆ·åé¦ˆ
            const feedback = this.generateSaveFeedback(result);
            UIBlock.showMessage(feedback.message, feedback.type);
            
            return {
                success: true,
                data: {
                    noteId: result.id || result.server?.id,
                    savedAt: new Date().toISOString(),
                    storageMode: this.qaSaver.saver.config.mode,
                    performance: { totalTime: Date.now() - startTime }
                }
            };
            
        } catch (error) {
            UIBlock.showMessage(`ä¿å­˜å¤±è´¥: ${error.message}`, 'error');
            throw error;
        }
    }
    
    // ä¼˜åŒ–åçš„é—®ç­”ä¿å­˜æ–¹æ³•
    async askQuestion(questionData) {
        try {
            // å‘é€é—®é¢˜åˆ°AI
            const response = await APIClient.sendQuestion(questionData);
            
            if (response.success && response.data.ai_response) {
                // è‡ªåŠ¨ä¿å­˜é—®ç­”è®°å½•
                const saveResult = await this.qaSaver.saveQA(
                    questionData.title,
                    response.data.ai_response.response,
                    questionData.agent_id,
                    [...questionData.tags, 'AIé—®ç­”']
                );
                
                return {
                    ...response,
                    data: {
                        ...response.data,
                        autoSaved: !!saveResult,
                        saveDetails: saveResult
                    }
                };
            }
            
            return response;
            
        } catch (error) {
            console.error('é—®ç­”å¤±è´¥:', error);
            throw error;
        }
    }
    
    // ç”Ÿæˆä¿å­˜åé¦ˆä¿¡æ¯
    generateSaveFeedback(result) {
        const mode = this.qaSaver.saver.config.mode;
        
        if (mode === 'hybrid') {
            if (result.synced) {
                return { message: 'âœ… å·²åŒæ­¥ä¿å­˜åˆ°æœåŠ¡å™¨å’Œæœ¬åœ°', type: 'success' };
            } else {
                return { message: 'ğŸ“± å·²ä¿å­˜åˆ°æœ¬åœ°ï¼Œå°†åœ¨ç½‘ç»œæ¢å¤æ—¶åŒæ­¥', type: 'warning' };
            }
        } else if (mode === 'server') {
            return { message: 'âœ… å·²ä¿å­˜åˆ°æœåŠ¡å™¨', type: 'success' };
        } else {
            return { message: 'ğŸ“ å·²ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶', type: 'success' };
        }
    }
}
```

#### **æ•°æ®æ ¼å¼æ ‡å‡†åŒ–**
```javascript
// æ™ºèƒ½é—®ç­”ç³»ç»Ÿä¸“ç”¨çš„æ•°æ®æ ¼å¼
const QADataFormat = {
    // ç¬”è®°æ•°æ®æ ¼å¼
    note: {
        title: string,      // ç¬”è®°æ ‡é¢˜
        content: string,    // ç¬”è®°å†…å®¹
        type: 'note',       // å›ºå®šä¸º 'note'
        tags: Array,        // æ ‡ç­¾æ•°ç»„
        timestamp: string   // æ—¶é—´æˆ³
    },
    
    // é—®ç­”æ•°æ®æ ¼å¼
    qa: {
        title: string,      // é—®é¢˜æ ‡é¢˜
        content: string,    // AIå›ç­”å†…å®¹
        type: 'qa',         // å›ºå®šä¸º 'qa'
        agentId: string,    // æ™ºèƒ½ä½“ID
        tags: Array,        // æ ‡ç­¾æ•°ç»„
        timestamp: string   // æ—¶é—´æˆ³
    }
};
```

### **6. ç½‘ç»œçŠ¶æ€è‡ªé€‚åº”**

```javascript
// ç½‘ç»œçŠ¶æ€ç›‘å¬å’Œè‡ªé€‚åº”
setupNetworkListeners() {
    window.addEventListener('online', () => {
        this.isOnline = true;
        this.log('ğŸŒ ç½‘ç»œå·²è¿æ¥');
        
        // è‡ªåŠ¨åŒæ­¥ç¦»çº¿é˜Ÿåˆ—
        if (this.config.syncStrategy === 'immediate') {
            this.syncOfflineQueue().then(result => {
                if (result.synced > 0) {
                    UIBlock.showMessage(`å·²åŒæ­¥ ${result.synced} é¡¹ç¦»çº¿æ•°æ®`, 'success');
                }
            });
        }
    });
    
    window.addEventListener('offline', () => {
        this.isOnline = false;
        this.log('ğŸ“± ç½‘ç»œå·²æ–­å¼€');
        UIBlock.showMessage('å·²ç¦»çº¿ï¼Œæ•°æ®å°†ä¿å­˜åˆ°æœ¬åœ°', 'info');
    });
}
```

### **7. å·¥å…·åŒ…æ–‡ä»¶ç»“æ„**

```
local-note-saver-toolkit/
â”œâ”€â”€ qa-note-saver.js           # ğŸ†• æ™ºèƒ½é—®ç­”ç³»ç»Ÿä¸“ç”¨å­˜å‚¨å™¨
â”œâ”€â”€ local-note-saver.js        # åŸé€šç”¨æœ¬åœ°å­˜å‚¨å™¨
â”œâ”€â”€ notebook-manager.js        # æµè§ˆå™¨åŸç”Ÿç‰ˆæœ¬
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ web-demo.html          # åŸé€šç”¨æ¼”ç¤º
â”‚   â””â”€â”€ qa-demo.html           # ğŸ†• æ™ºèƒ½é—®ç­”ç³»ç»Ÿæ¼”ç¤º
â””â”€â”€ docs/
    â”œâ”€â”€ README.md              # é€šç”¨ä½¿ç”¨è¯´æ˜
    â””â”€â”€ QA-INTEGRATION.md      # ğŸ†• æ™ºèƒ½é—®ç­”ç³»ç»Ÿé›†æˆæŒ‡å—
```

### **8. é…ç½®å»ºè®®**

#### **å¼€å‘ç¯å¢ƒé…ç½®**
```javascript
// å¼€å‘ç¯å¢ƒ - ä½¿ç”¨è°ƒè¯•æ¨¡å¼
const qaSaver = new QANoteSaver({
    mode: 'hybrid',
    apiUrl: 'http://localhost:8000/api/v1',
    debugMode: true,
    syncStrategy: 'immediate'
});
```

#### **ç”Ÿäº§ç¯å¢ƒé…ç½®**
```javascript
// ç”Ÿäº§ç¯å¢ƒ - ä¼˜åŒ–æ€§èƒ½
const qaSaver = new QANoteSaver({
    mode: 'hybrid',
    apiUrl: 'https://your-domain.com/api/v1',
    debugMode: false,
    syncStrategy: 'batch',
    maxCacheSize: 200
});
```

#### **ä¼ä¸šç¯å¢ƒé…ç½®**
```javascript
// ä¼ä¸šç¯å¢ƒ - ä»…æœåŠ¡å™¨å­˜å‚¨
const qaSaver = new QANoteSaver({
    mode: 'server',
    apiUrl: 'https://enterprise-server.com/api/v1',
    offlineMode: 'disabled',
    localCacheEnabled: false
});
```

---

## ğŸ“Š **å·¥å…·åŒ…é›†æˆæ•ˆæœè¯„ä¼°**

### **æŠ€æœ¯ä¼˜åŠ¿**

| ç‰¹æ€§ | åŸæœ‰æ–¹æ¡ˆ | é›†æˆQANoteSaverå | æ”¹è¿›æ•ˆæœ |
|------|----------|-------------------|----------|
| **å­˜å‚¨æ¨¡å¼** | å•ä¸€æœ¬åœ°å­˜å‚¨ | ä¸‰ç§æ¨¡å¼å¯é€‰ | ğŸ”¥ **çµæ´»æ€§å¤§å¹…æå‡** |
| **ç¦»çº¿æ”¯æŒ** | åŸºç¡€æ–‡ä»¶ä¿å­˜ | æ™ºèƒ½ç¦»çº¿é˜Ÿåˆ— | ğŸ”¥ **ç¦»çº¿ä½“éªŒä¼˜åŒ–** |
| **æ•°æ®åŒæ­¥** | æ— åŒæ­¥æœºåˆ¶ | è‡ªåŠ¨/æ‰‹åŠ¨åŒæ­¥ | ğŸ”¥ **æ•°æ®ä¸€è‡´æ€§ä¿éšœ** |
| **é”™è¯¯æ¢å¤** | ä¿å­˜å¤±è´¥å³å¤±è´¥ | å¤šé‡å¤‡é€‰æ–¹æ¡ˆ | ğŸ”¥ **å¯é æ€§æå‡** |
| **ç”¨æˆ·ä½“éªŒ** | åŸºç¡€ä¿å­˜æç¤º | è¯¦ç»†çŠ¶æ€åé¦ˆ | ğŸ”¥ **é€æ˜åº¦æå‡** |

### **é›†æˆæ”¶ç›Š**

1. **æŠ€æœ¯æ”¶ç›Š**ï¼š
   - ä»£ç å¤ç”¨ï¼šç›´æ¥é›†æˆç°æœ‰çš„æœ¬åœ°å­˜å‚¨èƒ½åŠ›
   - æ ‡å‡†åŒ–ï¼šç»Ÿä¸€çš„æ•°æ®æ ¼å¼å’ŒAPIæ¥å£
   - å¯ç»´æŠ¤æ€§ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºåç»­æ‰©å±•

2. **ç”¨æˆ·æ”¶ç›Š**ï¼š
   - æ•°æ®å®‰å…¨ï¼šå¤šé‡ä¿éšœç¡®ä¿æ•°æ®ä¸ä¸¢å¤±
   - çµæ´»é€‰æ‹©ï¼šå¯æ ¹æ®éœ€æ±‚é€‰æ‹©å­˜å‚¨æ¨¡å¼
   - ç¦»çº¿å¯ç”¨ï¼šæ–­ç½‘æ—¶ä»å¯æ­£å¸¸ä½¿ç”¨

3. **éƒ¨ç½²æ”¶ç›Š**ï¼š
   - æ¸è¿›å¼ï¼šå¯ä»æœ¬åœ°æ¨¡å¼é€æ­¥å‡çº§åˆ°æ··åˆæ¨¡å¼
   - å…¼å®¹æ€§ï¼šæ”¯æŒå„ç§æµè§ˆå™¨å’Œéƒ¨ç½²ç¯å¢ƒ
   - æ˜“é›†æˆï¼šæœ€å°åŒ–ä»£ç ä¿®æ”¹é‡

---

## ğŸ¯ **æ”¹è¿›æ•ˆæœè¯„ä¼°**

### **ç”¨æˆ·ä½“éªŒæå‡**

| æ”¹è¿›é¡¹ | æ”¹è¿›å‰ | æ”¹è¿›å | æ•ˆæœ |
|--------|--------|--------|------|
| **å­˜å‚¨æ§åˆ¶** | æ— æ³•é€‰æ‹©å­˜å‚¨æ–¹å¼ | ç”¨æˆ·å¯è‡ªä¸»é€‰æ‹©åŒè½¨/å•è½¨ | ğŸ”¥ **å¤§å¹…æå‡** |
| **çŠ¶æ€é€æ˜** | ä¸çŸ¥é“æ•°æ®å­˜å‚¨ä½ç½® | æ¸…æ™°æ˜¾ç¤ºå­˜å‚¨çŠ¶æ€å’Œä½ç½® | ğŸ”¥ **å¤§å¹…æå‡** |
| **ç¦»çº¿ä½“éªŒ** | æ— ç¦»çº¿æ”¯æŒ | æœ¬åœ°ç¼“å­˜æ”¯æŒç¦»çº¿æŸ¥çœ‹ | ğŸ”¥ **å¤§å¹…æå‡** |
| **å›¢é˜Ÿåä½œ** | å¼ºåˆ¶æœ¬åœ°å­˜å‚¨ | å¯å…³é—­æœ¬åœ°å­˜å‚¨ï¼Œçº¯æœåŠ¡å™¨æ¨¡å¼ | ğŸ”¥ **å¤§å¹…æå‡** |

### **æŠ€æœ¯æŒ‡æ ‡æ”¹è¿›**

| æŒ‡æ ‡ | åŒè½¨æ¨¡å¼ | æœåŠ¡å™¨æ¨¡å¼ | è¯´æ˜ |
|------|----------|------------|------|
| **ä¿å­˜é€Ÿåº¦** | å¹¶è¡Œæ‰§è¡Œï¼Œå¿«é€Ÿåé¦ˆ | å•ä¸€è¯·æ±‚ï¼Œç¨³å®šå¯æ§ | æ ¹æ®éœ€æ±‚é€‰æ‹© |
| **æ•°æ®å®‰å…¨** | åŒé‡ä¿éšœ | æœåŠ¡å™¨å•ç‚¹ä¿éšœ | ä¸¤ç§éƒ½å®‰å…¨ |
| **å­˜å‚¨æ¶ˆè€—** | æœ¬åœ°+æœåŠ¡å™¨ | ä»…æœåŠ¡å™¨ | ç”¨æˆ·å¯æ§ |
| **ç½‘ç»œä¾èµ–** | é™çº§æ”¯æŒ | å¼ºä¾èµ– | çµæ´»æ€§æ›´é«˜ |

---

## ğŸ“‚ **æ–‡ä»¶ç»“æ„æ›´æ–°**

### **æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶**

```
qa-system-v3/
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ storage-settings.js    # ğŸ†• å­˜å‚¨è®¾ç½®ç®¡ç†
â”‚   â””â”€â”€ storage-utils.js       # ğŸ†• å­˜å‚¨å·¥å…·å‡½æ•°
â”œâ”€â”€ ui-block/
â”‚   â”œâ”€â”€ settings.html          # ğŸ†• è®¾ç½®ç•Œé¢
â”‚   â”œâ”€â”€ settings.css           # ğŸ†• è®¾ç½®æ ·å¼
â”‚   â””â”€â”€ main.js               # ğŸ”„ ä¿®æ”¹ï¼šå¢åŠ è®¾ç½®å¤„ç†
â”œâ”€â”€ qa-note-block/
â”‚   â””â”€â”€ qa-note.js            # ğŸ”„ ä¿®æ”¹ï¼šå­˜å‚¨ç­–ç•¥ä¼˜åŒ–
â””â”€â”€ README_storage.md         # ğŸ†• å­˜å‚¨ç­–ç•¥è¯´æ˜æ–‡æ¡£
```

---

## ğŸš€ **å®æ–½å»ºè®®**

### **å®æ–½ä¼˜å…ˆçº§**

1. **P0 - æ ¸å¿ƒé€»è¾‘**ï¼ˆ1å¤©ï¼‰ï¼š
   - å®ç°åŒè½¨å­˜å‚¨é€»è¾‘
   - æ›´æ–°saveNoteå’ŒaskQuestionæ–¹æ³•

2. **P1 - ç”¨æˆ·ç•Œé¢**ï¼ˆ1å¤©ï¼‰ï¼š
   - åˆ›å»ºè®¾ç½®ç•Œé¢
   - å®ç°å­˜å‚¨å¼€å…³

3. **P2 - ä½“éªŒä¼˜åŒ–**ï¼ˆ0.5å¤©ï¼‰ï¼š
   - ä¼˜åŒ–çŠ¶æ€æç¤º
   - å®Œå–„ç¦»çº¿ä½“éªŒ

### **æµ‹è¯•éªŒè¯**

1. **åŠŸèƒ½æµ‹è¯•**ï¼š
   - åŒè½¨æ¨¡å¼ä¿å­˜/åŠ è½½æµ‹è¯•
   - æœåŠ¡å™¨æ¨¡å¼ä¿å­˜/åŠ è½½æµ‹è¯•
   - è®¾ç½®å¼€å…³åˆ‡æ¢æµ‹è¯•

2. **å¼‚å¸¸æµ‹è¯•**ï¼š
   - ç½‘ç»œæ–­å¼€æƒ…å†µæµ‹è¯•
   - æœåŠ¡å™¨æ•…éšœé™çº§æµ‹è¯•
   - æœ¬åœ°å­˜å‚¨æ»¡/å¤±è´¥æµ‹è¯•

3. **æ€§èƒ½æµ‹è¯•**ï¼š
   - å¹¶è¡Œä¿å­˜æ€§èƒ½æµ‹è¯•
   - å¤§é‡æ•°æ®åŠ è½½æ€§èƒ½æµ‹è¯•

---

## âœ… **æ”¹è¿›æ€»ç»“**

### **è§£å†³çš„æ ¸å¿ƒé—®é¢˜**

1. âœ… **äº‘åŒæ­¥æ¦‚å¿µæ¾„æ¸…**ï¼šæ˜ç¡®äº†æœåŠ¡å™¨å­˜å‚¨çš„å¿…è¦æ€§
2. âœ… **å­˜å‚¨ç­–ç•¥ä¼˜åŒ–**ï¼šæä¾›åŒè½¨å’Œå•è½¨ä¸¤ç§æ¨¡å¼
3. âœ… **ç”¨æˆ·æ§åˆ¶æƒ**ï¼šé€šè¿‡è®¾ç½®å¼€å…³è®©ç”¨æˆ·è‡ªä¸»é€‰æ‹©
4. âœ… **ä½“éªŒæå‡**ï¼šæ›´å¥½çš„çŠ¶æ€åé¦ˆå’Œç¦»çº¿æ”¯æŒ

### **å®ç°çš„æ ¸å¿ƒä»·å€¼**

- **çµæ´»æ€§**ï¼šæ»¡è¶³ä¸ªäººç”¨æˆ·å’Œä¼ä¸šç”¨æˆ·çš„ä¸åŒéœ€æ±‚
- **å¯é æ€§**ï¼šåŒé‡ä¿éšœç¡®ä¿æ•°æ®å®‰å…¨
- **é€æ˜æ€§**ï¼šç”¨æˆ·æ¸…æ¥šäº†è§£æ•°æ®å­˜å‚¨ä½ç½®å’ŒçŠ¶æ€
- **å¯æ§æ€§**ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´å­˜å‚¨è¡Œä¸º

**è¿™ä¸ªæ”¹è¿›æ–¹æ¡ˆå®Œç¾è§£å†³äº†v3.0æ–‡æ¡£ä¸­å­˜å‚¨ç­–ç•¥æ¨¡ç³Šçš„é—®é¢˜ï¼Œä¸ºç”¨æˆ·æä¾›äº†çµæ´»ã€å¯æ§çš„å­˜å‚¨é€‰æ‹©ï¼** ğŸ¯ 