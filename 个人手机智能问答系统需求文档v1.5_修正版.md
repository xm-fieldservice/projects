# ä¸ªäººæ‰‹æœºæ™ºèƒ½é—®ç­”ç³»ç»Ÿéœ€æ±‚æ–‡æ¡£ v1.5ï¼ˆä¿®æ­£ç‰ˆï¼‰

## ğŸ—ï¸ æ¨¡å—è§£è€¦æ¥å£è®¾è®¡è§„èŒƒ

### æ¨¡å—æ¶æ„å›¾
```mermaid
graph TB
    A[é—®ç­”ç•Œé¢æ¨¡å—] --> B[ç”¨æˆ·ç®¡ç†æ¨¡å—]
    A --> C[ä¿¡æ¯ç®¡ç†æ¨¡å—]
    A --> D[å‘½ä»¤æ³¨å…¥æ¨¡å—]
    B --> C
    B --> E[Dockeréƒ¨ç½²æ¨¡å—]
    C --> E
    D --> C
    D --> E
```

### 1. ç”¨æˆ·ç®¡ç†æ¨¡å—æ¥å£ (UserModule)
```python
class UserModuleInterface(ABC):
    """ç”¨æˆ·ç®¡ç†æ¨¡å—æ ‡å‡†æ¥å£"""
    
    # å¯¹é—®ç­”ç•Œé¢æ¨¡å—æš´éœ²
    @abstractmethod
    async def authenticate_user(self, credentials: Dict) -> UserSessionInfo:
        """ç”¨æˆ·è®¤è¯ - è¿”å›ä¼šè¯ä¿¡æ¯"""
        pass
    
    @abstractmethod
    async def get_user_permissions(self, user_id: str) -> List[str]:
        """è·å–ç”¨æˆ·æƒé™åˆ—è¡¨"""
        pass
    
    @abstractmethod
    async def get_user_profile(self, user_id: str) -> UserProfile:
        """è·å–ç”¨æˆ·æ¡£æ¡ˆä¿¡æ¯"""
        pass
    
    # å¯¹ä¿¡æ¯ç®¡ç†æ¨¡å—æš´éœ²
    @abstractmethod
    async def validate_user_access(self, user_id: str, resource_id: str) -> bool:
        """éªŒè¯ç”¨æˆ·èµ„æºè®¿é—®æƒé™"""
        pass
    
    @abstractmethod
    async def get_user_data_scope(self, user_id: str) -> DataScope:
        """è·å–ç”¨æˆ·æ•°æ®è®¿é—®èŒƒå›´"""
        pass
    
    # å¯¹éƒ¨ç½²æ¨¡å—æš´éœ²
    @abstractmethod
    def get_user_config_schema(self) -> Dict:
        """è·å–ç”¨æˆ·æ¨¡å—é…ç½®æ¶æ„"""
        pass

class UserSessionInfo:
    """ç”¨æˆ·ä¼šè¯ä¿¡æ¯"""
    def __init__(self, user_id: str, username: str, role: str, permissions: List[str]):
        self.user_id = user_id
        self.username = username
        self.role = role
        self.permissions = permissions
        self.session_token = None
        self.expires_at = None
```

### 2. ä¿¡æ¯ç®¡ç†æ¨¡å—æ¥å£ (DataModule)
```python
class DataModuleInterface(ABC):
    """ä¿¡æ¯ç®¡ç†æ¨¡å—æ ‡å‡†æ¥å£"""
    
    # å¯¹é—®ç­”ç•Œé¢æ¨¡å—æš´éœ²
    @abstractmethod
    async def search_knowledge(self, query: str, user_context: UserSessionInfo) -> SearchResult:
        """çŸ¥è¯†æœç´¢"""
        pass
    
    @abstractmethod
    async def save_conversation(self, conversation: ConversationData) -> str:
        """ä¿å­˜å¯¹è¯è®°å½•"""
        pass
    
    @abstractmethod
    async def get_conversation_history(self, user_id: str, limit: int = 50) -> List[ConversationData]:
        """è·å–å¯¹è¯å†å²"""
        pass
    
    # å¯¹å‘½ä»¤æ³¨å…¥æ¨¡å—æš´éœ²
    @abstractmethod
    async def execute_data_operation(self, operation: DataOperation, user_context: UserSessionInfo) -> OperationResult:
        """æ‰§è¡Œæ•°æ®æ“ä½œ"""
        pass
    
    @abstractmethod
    async def get_data_source_info(self, source_id: str) -> DataSourceInfo:
        """è·å–æ•°æ®æºä¿¡æ¯"""
        pass
    
    # å¯¹ç”¨æˆ·ç®¡ç†æ¨¡å—æš´éœ²
    @abstractmethod
    async def get_user_data_usage(self, user_id: str) -> DataUsageInfo:
        """è·å–ç”¨æˆ·æ•°æ®ä½¿ç”¨æƒ…å†µ"""
        pass
    
    # å¯¹éƒ¨ç½²æ¨¡å—æš´éœ²
    @abstractmethod
    def get_data_config_schema(self) -> Dict:
        """è·å–æ•°æ®æ¨¡å—é…ç½®æ¶æ„"""
        pass
    
    @abstractmethod
    async def health_check(self) -> ModuleHealthStatus:
        """æ¨¡å—å¥åº·æ£€æŸ¥"""
        pass

class SearchResult:
    """æœç´¢ç»“æœ"""
    def __init__(self, results: List[Dict], total: int, took_ms: int):
        self.results = results
        self.total = total
        self.took_ms = took_ms
        self.suggestions = []
```

### 3. é—®ç­”ç•Œé¢æ¨¡å—æ¥å£ (UIModule)
```python
class UIModuleInterface(ABC):
    """é—®ç­”ç•Œé¢æ¨¡å—æ ‡å‡†æ¥å£"""
    
    # å¯¹ç”¨æˆ·ç®¡ç†æ¨¡å—æš´éœ²
    @abstractmethod
    async def handle_user_login(self, session_info: UserSessionInfo):
        """å¤„ç†ç”¨æˆ·ç™»å½•äº‹ä»¶"""
        pass
    
    @abstractmethod
    async def handle_permission_change(self, user_id: str, new_permissions: List[str]):
        """å¤„ç†æƒé™å˜æ›´äº‹ä»¶"""
        pass
    
    # å¯¹ä¿¡æ¯ç®¡ç†æ¨¡å—æš´éœ²
    @abstractmethod
    async def display_search_results(self, results: SearchResult) -> UIResponse:
        """æ˜¾ç¤ºæœç´¢ç»“æœ"""
        pass
    
    @abstractmethod
    async def handle_data_update(self, update_event: DataUpdateEvent):
        """å¤„ç†æ•°æ®æ›´æ–°äº‹ä»¶"""
        pass
    
    # å¯¹å‘½ä»¤æ³¨å…¥æ¨¡å—æš´éœ²
    @abstractmethod
    async def execute_ui_command(self, command: UICommand, context: UIContext) -> UIResponse:
        """æ‰§è¡ŒUIå‘½ä»¤"""
        pass
    
    @abstractmethod
    async def register_command_handler(self, command_type: str, handler: Callable):
        """æ³¨å†Œå‘½ä»¤å¤„ç†å™¨"""
        pass
    
    # å¯¹éƒ¨ç½²æ¨¡å—æš´éœ²
    @abstractmethod
    def get_ui_config_schema(self) -> Dict:
        """è·å–UIæ¨¡å—é…ç½®æ¶æ„"""
        pass
    
    @abstractmethod
    async def get_frontend_assets(self) -> AssetManifest:
        """è·å–å‰ç«¯èµ„æºæ¸…å•"""
        pass

class UICommand:
    """UIå‘½ä»¤"""
    def __init__(self, command_type: str, parameters: Dict, user_context: UserSessionInfo):
        self.command_type = command_type
        self.parameters = parameters
        self.user_context = user_context
        self.timestamp = datetime.utcnow()
```

### 4. å‘½ä»¤æ³¨å…¥æ¨¡å—æ¥å£ (CommandModule)
```python
class CommandModuleInterface(ABC):
    """å‘½ä»¤æ³¨å…¥æ¨¡å—æ ‡å‡†æ¥å£"""
    
    # å¯¹é—®ç­”ç•Œé¢æ¨¡å—æš´éœ²
    @abstractmethod
    async def parse_user_input(self, input_text: str, context: UIContext) -> ParsedCommand:
        """è§£æç”¨æˆ·è¾“å…¥ä¸ºå‘½ä»¤"""
        pass
    
    @abstractmethod
    async def execute_command(self, command: ParsedCommand, user_context: UserSessionInfo) -> CommandResult:
        """æ‰§è¡Œè§£æåçš„å‘½ä»¤"""
        pass
    
    @abstractmethod
    async def get_available_commands(self, user_context: UserSessionInfo) -> List[CommandInfo]:
        """è·å–ç”¨æˆ·å¯ç”¨å‘½ä»¤åˆ—è¡¨"""
        pass
    
    # å¯¹ä¿¡æ¯ç®¡ç†æ¨¡å—æš´éœ²
    @abstractmethod
    async def register_data_command(self, command_name: str, handler: Callable):
        """æ³¨å†Œæ•°æ®æ“ä½œå‘½ä»¤"""
        pass
    
    @abstractmethod
    async def validate_command_permissions(self, command: ParsedCommand, user_context: UserSessionInfo) -> bool:
        """éªŒè¯å‘½ä»¤æ‰§è¡Œæƒé™"""
        pass
    
    # å¯¹ç”¨æˆ·ç®¡ç†æ¨¡å—æš´éœ²
    @abstractmethod
    async def register_user_command(self, command_name: str, handler: Callable):
        """æ³¨å†Œç”¨æˆ·ç®¡ç†å‘½ä»¤"""
        pass
    
    # å¯¹éƒ¨ç½²æ¨¡å—æš´éœ²
    @abstractmethod
    def get_command_config_schema(self) -> Dict:
        """è·å–å‘½ä»¤æ¨¡å—é…ç½®æ¶æ„"""
        pass

class ParsedCommand:
    """è§£æåçš„å‘½ä»¤"""
    def __init__(self, command_type: str, action: str, parameters: Dict, confidence: float):
        self.command_type = command_type  # user, data, system
        self.action = action
        self.parameters = parameters
        self.confidence = confidence
        self.requires_confirmation = False
```

### 5. Dockeréƒ¨ç½²æ¨¡å—æ¥å£ (DeployModule)
```python
class DeployModuleInterface(ABC):
    """Dockeréƒ¨ç½²æ¨¡å—æ ‡å‡†æ¥å£"""
    
    # å¯¹æ‰€æœ‰æ¨¡å—æš´éœ²
    @abstractmethod
    async def get_module_status(self, module_name: str) -> ModuleStatus:
        """è·å–æ¨¡å—è¿è¡ŒçŠ¶æ€"""
        pass
    
    @abstractmethod
    async def restart_module(self, module_name: str) -> bool:
        """é‡å¯æŒ‡å®šæ¨¡å—"""
        pass
    
    @abstractmethod
    async def get_system_metrics(self) -> SystemMetrics:
        """è·å–ç³»ç»Ÿè¿è¡ŒæŒ‡æ ‡"""
        pass
    
    @abstractmethod
    async def update_module_config(self, module_name: str, config: Dict) -> bool:
        """æ›´æ–°æ¨¡å—é…ç½®"""
        pass
    
    @abstractmethod
    async def scale_module(self, module_name: str, replicas: int) -> bool:
        """æ‰©ç¼©å®¹æ¨¡å—å®ä¾‹"""
        pass
    
    @abstractmethod
    def get_deployment_manifest(self) -> DeploymentManifest:
        """è·å–éƒ¨ç½²æ¸…å•"""
        pass

class ModuleStatus:
    """æ¨¡å—çŠ¶æ€"""
    def __init__(self, name: str, status: str, health: str, uptime: int):
        self.name = name
        self.status = status  # running, stopped, error
        self.health = health  # healthy, unhealthy, unknown
        self.uptime = uptime
        self.resources = {}
        self.dependencies = []
```

## ğŸ”— æ¨¡å—é—´é€šä¿¡åè®®

### äº‹ä»¶æ€»çº¿è®¾è®¡
```python
class ModuleEventBus:
    """æ¨¡å—é—´äº‹ä»¶æ€»çº¿"""
    
    def __init__(self):
        self.subscribers = {}
    
    async def publish(self, event_type: str, event_data: Dict, source_module: str):
        """å‘å¸ƒäº‹ä»¶"""
        event = ModuleEvent(event_type, event_data, source_module)
        
        if event_type in self.subscribers:
            for subscriber in self.subscribers[event_type]:
                await subscriber.handle_event(event)
    
    def subscribe(self, event_type: str, handler: 'ModuleEventHandler'):
        """è®¢é˜…äº‹ä»¶"""
        if event_type not in self.subscribers:
            self.subscribers[event_type] = []
        self.subscribers[event_type].append(handler)

class ModuleEvent:
    """æ¨¡å—äº‹ä»¶"""
    def __init__(self, event_type: str, data: Dict, source: str):
        self.event_type = event_type
        self.data = data
        self.source = source
        self.timestamp = datetime.utcnow()
        self.event_id = str(uuid.uuid4())
```

### æ ‡å‡†é”™è¯¯å¤„ç†
```python
class ModuleError(Exception):
    """æ¨¡å—æ ‡å‡†é”™è¯¯"""
    def __init__(self, module_name: str, error_code: str, message: str, details: Dict = None):
        self.module_name = module_name
        self.error_code = error_code
        self.message = message
        self.details = details or {}
        self.timestamp = datetime.utcnow()
        super().__init__(f"[{module_name}] {error_code}: {message}")

# æ ‡å‡†é”™è¯¯ä»£ç 
class ErrorCodes:
    # ç”¨æˆ·ç®¡ç†æ¨¡å—
    USER_NOT_FOUND = "USER_001"
    PERMISSION_DENIED = "USER_002"
    AUTHENTICATION_FAILED = "USER_003"
    
    # ä¿¡æ¯ç®¡ç†æ¨¡å—
    DATA_NOT_FOUND = "DATA_001"
    SEARCH_TIMEOUT = "DATA_002"
    STORAGE_ERROR = "DATA_003"
    
    # é—®ç­”ç•Œé¢æ¨¡å—
    UI_RENDER_ERROR = "UI_001"
    ASSET_NOT_FOUND = "UI_002"
    
    # å‘½ä»¤æ³¨å…¥æ¨¡å—
    COMMAND_PARSE_ERROR = "CMD_001"
    COMMAND_NOT_FOUND = "CMD_002"
    EXECUTION_FAILED = "CMD_003"
    
    # éƒ¨ç½²æ¨¡å—
    MODULE_START_FAILED = "DEPLOY_001"
    CONFIG_INVALID = "DEPLOY_002"
    HEALTH_CHECK_FAILED = "DEPLOY_003"
```

## ğŸ¯ ç‰ˆæœ¬ç†å¿µä¿®æ­£
**æ ¸å¿ƒå®šä½**ï¼šä¸ªäººç”¨æˆ·ä¼˜å…ˆï¼Œæ”¯æŒå¹³é¢æ‰©å¼ åˆ°ä¸­å‹ç»„ç»‡
- âœ… **ä¸ªäººå‹å¥½**ï¼šç®€å•æ˜“ç”¨ï¼Œä¸€é”®éƒ¨ç½²
- ğŸ”„ **æ‰©å¤§å¹³é¢æ‰©å¼ **ï¼šæ”¯æŒä¸ªäººâ†’å°å›¢é˜Ÿâ†’å¤§å›¢é˜Ÿâ†’ä¸­å‹ç»„ç»‡ï¼ˆæœ€å¤§500äººï¼‰
- ğŸ‘¥ **ç®¡ç†å‘˜æœºåˆ¶**ï¼šå¼•å…¥è½»é‡çº§ç®¡ç†å‘˜è§’è‰²
- ğŸ“± **å®Œæ•´æ‰‹æœºé€šçŸ¥**ï¼šæ”¯æŒç³»ç»Ÿæ¨é€ã€çŸ­ä¿¡ã€é‚®ä»¶å¤šæ¸ é“

## ğŸ“ˆ ä¿®æ­£åå¹³é¢æ‰©å¼ è·¯å¾„
```mermaid
graph LR
A[ä¸ªäººç”¨æˆ·<br/>1äºº] --> B[å®¶åº­ä½¿ç”¨<br/>2-5äºº] 
B --> C[å°å›¢é˜Ÿ<br/>6-20äºº]
C --> D[å¤§å›¢é˜Ÿ<br/>21-100äºº]
D --> E[ä¸­å‹ç»„ç»‡<br/>101-500äºº]
```

## 1. æ ¸å¿ƒåŠŸèƒ½è®¾è®¡ä¿®æ­£

### 1.1 ç”¨æˆ·æœåŠ¡ï¼ˆå¢åŠ ç®¡ç†å‘˜æ”¯æŒï¼‰

#### 1.1.1 æ ¸å¿ƒæ¥å£æ‰©å±•
```python
from abc import ABC, abstractmethod
from typing import List, Optional, Dict, Any
from enum import Enum

class UserRole(str, Enum):
    OWNER = "owner"        # ç³»ç»Ÿæ‹¥æœ‰è€…ï¼ˆç¬¬ä¸€ä¸ªç”¨æˆ·ï¼‰
    ADMIN = "admin"        # ç®¡ç†å‘˜ï¼ˆå¯ç®¡ç†ç”¨æˆ·ï¼‰
    MEMBER = "member"      # æ™®é€šæˆå‘˜

class UserServiceInterface(ABC):
    """ç”¨æˆ·æœåŠ¡æ¥å£ - æ”¯æŒç®¡ç†å‘˜å’Œå¤§è§„æ¨¡æ‰©å¼ """
    
    @abstractmethod
    async def authenticate(self, credentials: Dict[str, Any]) -> Optional['UserInfo']:
        """èº«ä»½è®¤è¯"""
        pass
    
    @abstractmethod
    async def get_user_by_username(self, username: str) -> Optional['UserInfo']:
        """æ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ·ä¿¡æ¯"""
        pass
    
    @abstractmethod
    async def get_users_by_usernames(self, usernames: List[str]) -> List['UserInfo']:
        """æ‰¹é‡è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆæ”¯æŒ@æåŠï¼‰"""
        pass
    
    @abstractmethod
    async def get_user_count(self) -> int:
        """è·å–ç”¨æˆ·æ€»æ•°ï¼ˆç”¨äºæ‰©å¼ æ£€æµ‹ï¼‰"""
        pass
    
    # æ–°å¢ï¼šç®¡ç†å‘˜ç›¸å…³æ¥å£
    @abstractmethod
    async def create_user(self, user_data: Dict[str, Any], creator_id: str) -> 'UserInfo':
        """åˆ›å»ºç”¨æˆ·ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰"""
        pass
    
    @abstractmethod
    async def get_users_by_role(self, role: UserRole) -> List['UserInfo']:
        """æ ¹æ®è§’è‰²è·å–ç”¨æˆ·åˆ—è¡¨"""
        pass
    
    @abstractmethod
    async def update_user_role(self, user_id: str, new_role: UserRole, admin_id: str) -> bool:
        """æ›´æ–°ç”¨æˆ·è§’è‰²ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰"""
        pass

class UserInfo:
    """ç”¨æˆ·ä¿¡æ¯æ¨¡å‹ï¼ˆå¢åŠ è§’è‰²æ”¯æŒï¼‰"""
    def __init__(
        self, 
        id: str, 
        username: str, 
        display_name: str, 
        email: str = None,
        phone: str = None,      # æ–°å¢ï¼šæ‰‹æœºå·ï¼ˆç”¨äºçŸ­ä¿¡é€šçŸ¥ï¼‰
        role: UserRole = UserRole.MEMBER,  # æ–°å¢ï¼šç”¨æˆ·è§’è‰²
        push_token: str = None  # æ–°å¢ï¼šæ¨é€ä»¤ç‰Œ
    ):
        self.id = id
        self.username = username
        self.display_name = display_name
        self.email = email
        self.phone = phone
        self.role = role
        self.push_token = push_token
```

### 1.2 æ™ºèƒ½æ‰©å¼ æ£€æµ‹ï¼ˆæ‰©å¤§è§„æ¨¡ï¼‰
```python
class ScaleDetector:
    """æ‰©å¼ è§„æ¨¡æ£€æµ‹å™¨ - æ”¯æŒæ›´å¤§è§„æ¨¡"""
    
    def __init__(self, user_service: UserServiceInterface):
        self.user_service = user_service
    
    async def get_current_scale(self) -> str:
        """æ£€æµ‹å½“å‰è§„æ¨¡"""
        user_count = await self.user_service.get_user_count()
        
        if user_count <= 1:
            return "ä¸ªäºº"
        elif user_count <= 5:
            return "å®¶åº­"
        elif user_count <= 20:
            return "å°å›¢é˜Ÿ"
        elif user_count <= 100:
            return "å¤§å›¢é˜Ÿ"
        elif user_count <= 500:
            return "ä¸­å‹ç»„ç»‡"
        else:
            return "å¤§å‹ç»„ç»‡"  # è¶…è¿‡500äººå»ºè®®è¿ç§»ä¼ä¸šç‰ˆ
    
    async def suggest_optimization(self) -> List[str]:
        """æ ¹æ®è§„æ¨¡å»ºè®®ä¼˜åŒ–"""
        scale = await self.get_current_scale()
        
        suggestions = {
            "ä¸ªäºº": ["è€ƒè™‘é‚€è¯·å®¶äººæœ‹å‹ä¸€èµ·ä½¿ç”¨"],
            "å®¶åº­": ["å¯ä»¥åˆ›å»ºå®¶åº­åˆ†ç»„", "è®¾ç½®å®¶åº­å…±äº«ç¬”è®°"],
            "å°å›¢é˜Ÿ": ["å»ºè®®è®¾ç½®ç®¡ç†å‘˜", "è€ƒè™‘æŒ‰é¡¹ç›®åˆ†ç»„"],
            "å¤§å›¢é˜Ÿ": ["å»ºè®®å¯ç”¨ç¼“å­˜ä¼˜åŒ–", "è€ƒè™‘æƒé™åˆ†çº§", "å¯ç”¨æ¨é€é€šçŸ¥"],
            "ä¸­å‹ç»„ç»‡": ["å»ºè®®å¯ç”¨å¤–éƒ¨é›†æˆ", "è€ƒè™‘æ€§èƒ½ä¼˜åŒ–", "å¯ç”¨çŸ­ä¿¡é€šçŸ¥"],
            "å¤§å‹ç»„ç»‡": ["å»ºè®®è¿ç§»åˆ°ä¼ä¸šç‰ˆ", "è”ç³»æŠ€æœ¯æ”¯æŒ"]
        }
        
        return suggestions.get(scale, [])
    
    async def get_recommended_admin_count(self) -> int:
        """æ¨èçš„ç®¡ç†å‘˜æ•°é‡"""
        user_count = await self.user_service.get_user_count()
        
        if user_count <= 5:
            return 1  # åªéœ€è¦owner
        elif user_count <= 20:
            return 2  # owner + 1ä¸ªadmin
        elif user_count <= 100:
            return 3  # owner + 2ä¸ªadmin
        else:
            return max(3, user_count // 50)  # æ¯50äºº1ä¸ªç®¡ç†å‘˜
```

## 2. æ•°æ®åº“è®¾è®¡ä¿®æ­£

### 2.1 ç”¨æˆ·è¡¨æ‰©å±•
```sql
-- ç”¨æˆ·è¡¨ï¼ˆå¢åŠ ç®¡ç†å‘˜æ”¯æŒå’Œé€šçŸ¥å­—æ®µï¼‰
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100),
    phone VARCHAR(20),              -- æ‰‹æœºå·ï¼ˆçŸ­ä¿¡é€šçŸ¥ï¼‰
    display_name VARCHAR(100),
    password_hash VARCHAR(255),
    
    -- è§’è‰²ç®¡ç†
    role ENUM('owner', 'admin', 'member') DEFAULT 'member',
    
    -- é€šçŸ¥è®¾ç½®
    push_token VARCHAR(500),        -- æ¨é€ä»¤ç‰Œ
    notification_preferences JSON,  -- é€šçŸ¥åå¥½è®¾ç½®
    
    -- æ‰©å¼ æ”¯æŒå­—æ®µ
    user_source ENUM('local', 'external') DEFAULT 'local',
    external_user_id VARCHAR(100),
    
    -- çŠ¶æ€å­—æ®µ
    is_active BOOLEAN DEFAULT TRUE,
    last_login_at TIMESTAMP NULL,
    
    -- åŸºç¡€æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    -- ç´¢å¼•ä¼˜åŒ–
    INDEX idx_role (role),
    INDEX idx_phone (phone),
    INDEX idx_push_token (push_token(100)),
    INDEX idx_external_user_id (external_user_id),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- ç”¨æˆ·é‚€è¯·è¡¨ï¼ˆç®¡ç†å‘˜å¼€é€šç”¨æˆ·æœºåˆ¶ï¼‰
CREATE TABLE user_invitations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    invite_code VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100),
    phone VARCHAR(20),
    invited_by BIGINT NOT NULL,     -- é‚€è¯·äººï¼ˆç®¡ç†å‘˜ï¼‰
    
    -- é‚€è¯·ä¿¡æ¯
    message TEXT,                   -- é‚€è¯·æ¶ˆæ¯
    role ENUM('admin', 'member') DEFAULT 'member',  -- é¢„è®¾è§’è‰²
    
    -- çŠ¶æ€ç®¡ç†
    status ENUM('pending', 'accepted', 'expired') DEFAULT 'pending',
    expires_at TIMESTAMP NOT NULL,
    accepted_at TIMESTAMP NULL,
    accepted_by BIGINT NULL,        -- æ¥å—é‚€è¯·çš„ç”¨æˆ·ID
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (invited_by) REFERENCES users(id),
    FOREIGN KEY (accepted_by) REFERENCES users(id),
    INDEX idx_invite_code (invite_code),
    INDEX idx_status_expires (status, expires_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

## 3. é€šçŸ¥ç³»ç»Ÿè®¾è®¡ï¼ˆå®Œæ•´æ‰‹æœºæ”¯æŒï¼‰

### 3.1 å¤šæ¸ é“é€šçŸ¥æœåŠ¡
```python
from abc import ABC, abstractmethod
from enum import Enum
import asyncio

class NotificationChannel(str, Enum):
    PUSH = "push"      # æ‰‹æœºæ¨é€é€šçŸ¥
    EMAIL = "email"    # é‚®ä»¶é€šçŸ¥
    SMS = "sms"        # çŸ­ä¿¡é€šçŸ¥
    WEBSOCKET = "websocket"  # å®æ—¶é€šçŸ¥

class NotificationPriority(str, Enum):
    LOW = "low"        # ä½ä¼˜å…ˆçº§ï¼ˆé‚®ä»¶ï¼‰
    NORMAL = "normal"  # æ™®é€šä¼˜å…ˆçº§ï¼ˆæ¨é€ï¼‰
    HIGH = "high"      # é«˜ä¼˜å…ˆçº§ï¼ˆæ¨é€+çŸ­ä¿¡ï¼‰
    URGENT = "urgent"  # ç´§æ€¥ï¼ˆæ¨é€+çŸ­ä¿¡+é‚®ä»¶ï¼‰

class NotificationService:
    """å¤šæ¸ é“é€šçŸ¥æœåŠ¡"""
    
    def __init__(self):
        self.push_service = PushNotificationService()
        self.email_service = EmailNotificationService()
        self.sms_service = SMSNotificationService()
    
    async def send_notification(
        self,
        user: UserInfo,
        title: str,
        content: str,
        priority: NotificationPriority = NotificationPriority.NORMAL,
        channels: List[NotificationChannel] = None
    ):
        """å‘é€å¤šæ¸ é“é€šçŸ¥"""
        
        # æ ¹æ®ä¼˜å…ˆçº§ç¡®å®šæ¸ é“
        if channels is None:
            channels = self._get_channels_by_priority(priority)
        
        # æ£€æŸ¥ç”¨æˆ·é€šçŸ¥åå¥½
        user_channels = self._filter_by_user_preferences(user, channels)
        
        # å¹¶å‘å‘é€é€šçŸ¥
        tasks = []
        for channel in user_channels:
            if channel == NotificationChannel.PUSH and user.push_token:
                tasks.append(self.push_service.send_push(user, title, content))
            elif channel == NotificationChannel.EMAIL and user.email:
                tasks.append(self.email_service.send_email(user, title, content))
            elif channel == NotificationChannel.SMS and user.phone:
                tasks.append(self.sms_service.send_sms(user, title, content))
        
        if tasks:
            await asyncio.gather(*tasks, return_exceptions=True)
    
    def _get_channels_by_priority(self, priority: NotificationPriority) -> List[NotificationChannel]:
        """æ ¹æ®ä¼˜å…ˆçº§ç¡®å®šé€šçŸ¥æ¸ é“"""
        channel_map = {
            NotificationPriority.LOW: [NotificationChannel.EMAIL],
            NotificationPriority.NORMAL: [NotificationChannel.PUSH],
            NotificationPriority.HIGH: [NotificationChannel.PUSH, NotificationChannel.SMS],
            NotificationPriority.URGENT: [
                NotificationChannel.PUSH, 
                NotificationChannel.SMS, 
                NotificationChannel.EMAIL
            ]
        }
        return channel_map.get(priority, [NotificationChannel.PUSH])

class PushNotificationService:
    """æ‰‹æœºæ¨é€é€šçŸ¥æœåŠ¡"""
    
    def __init__(self):
        # æ”¯æŒå¤šç§æ¨é€æœåŠ¡
        self.fcm_client = None  # Firebase Cloud Messaging
        self.apns_client = None  # Apple Push Notification Service
        self.unified_push_client = None  # ç»Ÿä¸€æ¨é€æœåŠ¡
    
    async def send_push(self, user: UserInfo, title: str, content: str):
        """å‘é€æ¨é€é€šçŸ¥"""
        if not user.push_token:
            return
        
        notification_data = {
            "title": title,
            "body": content,
            "icon": "/icons/app-icon.png",
            "badge": 1,
            "sound": "default",
            "click_action": "FLUTTER_NOTIFICATION_CLICK",
            "data": {
                "type": "mention",
                "timestamp": str(int(time.time())),
                "user_id": user.id
            }
        }
        
        try:
            # æ ¹æ®è®¾å¤‡ç±»å‹é€‰æ‹©æ¨é€æœåŠ¡
            if user.push_token.startswith("fk"):  # FCM token
                await self._send_fcm_push(user.push_token, notification_data)
            elif user.push_token.startswith("ap"):  # APNS token
                await self._send_apns_push(user.push_token, notification_data)
            else:
                # ä½¿ç”¨ç»Ÿä¸€æ¨é€æœåŠ¡
                await self._send_unified_push(user.push_token, notification_data)
                
        except Exception as e:
            logger.error(f"æ¨é€é€šçŸ¥å‘é€å¤±è´¥: {e}")

class SMSNotificationService:
    """çŸ­ä¿¡é€šçŸ¥æœåŠ¡"""
    
    def __init__(self):
        self.sms_providers = {
            "twilio": TwilioSMSProvider(),
            "aliyun": AliyunSMSProvider(),
            "tencent": TencentSMSProvider()
        }
    
    async def send_sms(self, user: UserInfo, title: str, content: str):
        """å‘é€çŸ­ä¿¡é€šçŸ¥"""
        if not user.phone:
            return
        
        # çŸ­ä¿¡å†…å®¹ç²¾ç®€åŒ–
        sms_content = f"ã€æ™ºèƒ½é—®ç­”ã€‘{title[:20]}{'...' if len(title) > 20 else ''}"
        
        # æ ¹æ®æ‰‹æœºå·é€‰æ‹©æœåŠ¡å•†
        provider = self._select_provider(user.phone)
        
        try:
            await provider.send_sms(user.phone, sms_content)
        except Exception as e:
            logger.error(f"çŸ­ä¿¡å‘é€å¤±è´¥: {e}")
```

## 4. ç®¡ç†å‘˜åŠŸèƒ½API

### 4.1 ç”¨æˆ·ç®¡ç†API
```python
@router.post("/api/v1/admin/users/invite")
async def invite_user(
    invitation_data: UserInvitationRequest,
    current_user: UserInfo = Depends(get_current_admin_user)
):
    """é‚€è¯·æ–°ç”¨æˆ·ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰"""
    
    # ç”Ÿæˆé‚€è¯·ç 
    invite_code = generate_invite_code()
    
    # åˆ›å»ºé‚€è¯·è®°å½•
    invitation = UserInvitation(
        invite_code=invite_code,
        email=invitation_data.email,
        phone=invitation_data.phone,
        invited_by=int(current_user.id),
        message=invitation_data.message,
        role=invitation_data.role,
        expires_at=datetime.utcnow() + timedelta(days=7)
    )
    
    db.add(invitation)
    db.commit()
    
    # å‘é€é‚€è¯·é€šçŸ¥
    invite_link = f"http://localhost:3000/register?code={invite_code}"
    
    if invitation_data.email:
        await send_email_invitation(invitation_data.email, invite_link, invitation_data.message)
    
    if invitation_data.phone:
        await send_sms_invitation(invitation_data.phone, invite_link)
    
    return {
        "invite_code": invite_code,
        "invite_link": invite_link,
        "expires_at": invitation.expires_at
    }

@router.post("/api/v1/users/register")
async def register_with_invitation(registration_data: UserRegistrationRequest):
    """é€šè¿‡é‚€è¯·ç æ³¨å†Œ"""
    
    # éªŒè¯é‚€è¯·ç 
    invitation = db.query(UserInvitation).filter(
        UserInvitation.invite_code == registration_data.invite_code,
        UserInvitation.status == 'pending',
        UserInvitation.expires_at > datetime.utcnow()
    ).first()
    
    if not invitation:
        raise HTTPException(status_code=400, detail="é‚€è¯·ç æ— æ•ˆæˆ–å·²è¿‡æœŸ")
    
    # åˆ›å»ºç”¨æˆ·
    user = User(
        username=registration_data.username,
        email=registration_data.email,
        phone=registration_data.phone,
        display_name=registration_data.display_name,
        password_hash=hash_password(registration_data.password),
        role=invitation.role,
        push_token=registration_data.push_token
    )
    
    db.add(user)
    
    # æ›´æ–°é‚€è¯·çŠ¶æ€
    invitation.status = 'accepted'
    invitation.accepted_at = datetime.utcnow()
    invitation.accepted_by = user.id
    
    db.commit()
    
    return {"message": "æ³¨å†ŒæˆåŠŸ", "user_id": user.id}

@router.get("/api/v1/admin/users")
async def get_all_users(
    page: int = 1,
    size: int = 20,
    role: Optional[UserRole] = None,
    current_user: UserInfo = Depends(get_current_admin_user)
):
    """è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰"""
    
    query = db.query(User)
    
    if role:
        query = query.filter(User.role == role)
    
    users = query.offset((page - 1) * size).limit(size).all()
    total = query.count()
    
    return {
        "users": [
            {
                "id": user.id,
                "username": user.username,
                "display_name": user.display_name,
                "email": user.email,
                "phone": user.phone,
                "role": user.role,
                "is_active": user.is_active,
                "last_login_at": user.last_login_at,
                "created_at": user.created_at
            }
            for user in users
        ],
        "total": total,
        "page": page,
        "size": size
    }
```

## 5. å‰ç«¯ç•Œé¢å¢å¼º

### 5.0 ç»Ÿä¸€å†…å®¹å½•å…¥é¡µé¢ - UIç»„ä»¶è®¾è®¡è§„èŒƒ

#### 5.0.1 å®Œæ•´UIç»„ä»¶æ¸…å•

åŸºäº"ä¸‡ç‰©çš†ç¬”è®°"ç†å¿µï¼Œç¬”è®°å’Œé—®ç­”åŠŸèƒ½ç»Ÿä¸€åœ¨åŒä¸€ä¸ªé¡µé¢å†…ï¼Œé€šè¿‡åŠŸèƒ½åˆ‡æ¢å¼€å…³åŒºåˆ«å½•å…¥æ ·å¼ã€‚

##### **ğŸ›ï¸ é¡¶éƒ¨å·¥å…·æ åŒºåŸŸ**
1. **å·¦ä¸Šè§’æ±‰å ¡èœå•æŒ‰é’®ï¼ˆâ˜°ï¼‰** - å±•å¼€/æ”¶èµ·å·¦ä¾§æ 
2. **æ¨¡å¼åˆ‡æ¢å™¨** - ç‹¬ç«‹æ¨¡å¼/é›†æˆæ¨¡å¼å•é€‰æŒ‰é’®ç»„
3. **ğŸ“/ğŸ’¬ åŠŸèƒ½åˆ‡æ¢å¼€å…³** - ä¸€ä¸ªå¼€å…³çš„å·¦å³ä¸¤è¾¹ï¼š
   - å·¦è¾¹ï¼šğŸ“ ç¬”è®°æ¨¡å¼
   - å³è¾¹ï¼šğŸ’¬ é—®ç­”æ¨¡å¼
4. **å³ä¸Šè§’äººå‘˜é€‰æ‹©æŒ‰é’®ï¼ˆğŸ‘¥ï¼‰** - å±•å¼€/æ”¶èµ·å³ä¾§äººå‘˜æ 
5. **ğŸ”” é€šçŸ¥æŒ‰é’®** - æ¶ˆæ¯é€šçŸ¥å…¥å£ï¼ˆå¸¦çº¢ç‚¹badgeï¼‰

##### **ğŸ“ ä¸»å†…å®¹å½•å…¥åŒºåŸŸ**
6. **æ ‡é¢˜è¾“å…¥æ¡†** - åŠ¨æ€æç¤ºæ–‡å­—ï¼š
   - é—®ç­”æ¨¡å¼ï¼š`"è¯·è¾“å…¥ä½ çš„é—®é¢˜..."`
   - ç¬”è®°æ¨¡å¼ï¼š`"è¯·è¾“å…¥ç¬”è®°æ ‡é¢˜..."`
7. **å†…å®¹ç¼–è¾‘å™¨** - å¤šè¡Œæ–‡æœ¬æ¡†ï¼š
   - é—®ç­”æ¨¡å¼ï¼šé—®é¢˜è¯¦ç»†æè¿°åŒºåŸŸ
   - ç¬”è®°æ¨¡å¼ï¼šç¬”è®°æ­£æ–‡ç¼–è¾‘å™¨ï¼ˆæ”¯æŒMarkdownï¼‰
8. **@æåŠè¾“å…¥æ”¯æŒ** - åœ¨å†…å®¹ä¸­å¯ä»¥@ç”¨æˆ·ï¼Œå¼¹å‡ºç”¨æˆ·é€‰æ‹©å™¨
9. **æ ‡ç­¾è¾“å…¥å™¨** - æ·»åŠ åˆ†ç±»æ ‡ç­¾ï¼Œæ”¯æŒå¤šæ ‡ç­¾é€‰æ‹©
10. **é™„ä»¶ä¸Šä¼ åŒºåŸŸ** - æ”¯æŒæ–‡ä»¶ã€å›¾ç‰‡æ‹–æ‹½ä¸Šä¼ 

##### **ğŸ¤– æ™ºèƒ½ä½“é€‰æ‹©åŒºåŸŸï¼ˆä¸ç¬”è®°-é—®ç­”å¼€å…³è”åŠ¨ï¼‰**
11. **æ™ºèƒ½ä½“é€‰æ‹©å™¨** - ä¸‹æ‹‰é€‰æ‹©å¯ç”¨çš„AIæ™ºèƒ½ä½“ï¼š
    - é—®ç­”æ¨¡å¼ï¼šæ­£å¸¸çŠ¶æ€ï¼Œå¯é€‰æ‹©
    - ç¬”è®°æ¨¡å¼ï¼šè™šåŒ–çŠ¶æ€ï¼Œä¸å¯é€‰æ‹©
12. **é—®ç­”æ¨¡å¼é€‰æ‹©å™¨** - å•é€‰æŒ‰é’®ï¼šå®æ—¶æ¨¡å¼/æ·±åº¦æ€è€ƒæ¨¡å¼

##### **ğŸ’¬ å¯¹è¯æ˜¾ç¤ºåŒºåŸŸï¼ˆé—®ç­”æ¨¡å¼ä¸“ç”¨ï¼‰**
13. **å¯¹è¯å†å²çª—å£** - æ»šåŠ¨å®¹å™¨æ˜¾ç¤ºé—®ç­”è®°å½•
14. **ç”¨æˆ·æ¶ˆæ¯æ°”æ³¡** - å³ä¾§å¯¹é½ï¼Œè“è‰²èƒŒæ™¯
15. **AIæ¶ˆæ¯æ°”æ³¡** - å·¦ä¾§å¯¹é½ï¼Œç°è‰²èƒŒæ™¯ï¼Œæ”¯æŒMarkdownæ¸²æŸ“
16. **åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨** - AIæ€è€ƒæ—¶çš„åŠ¨ç”»æ•ˆæœ
17. **é‡æ–°ç”ŸæˆæŒ‰é’®** - å¯¹AIå›ç­”ä¸æ»¡æ„æ—¶é‡æ–°ç”Ÿæˆ

##### **ğŸ‘¥ å³ä¾§äººå‘˜é€‰æ‹©æ **
18. **æ æ ‡é¢˜å’Œå…³é—­æŒ‰é’®** - "é€‰æ‹©äººå‘˜" + Xå…³é—­æŒ‰é’®
19. **ä½¿ç”¨è¯´æ˜** - æç¤º"ç‚¹å‡»äººå‘˜æˆ–åˆ†ç»„åç§°ï¼Œè‡ªåŠ¨æ·»åŠ @æåŠ"
20. **äººå‘˜æœç´¢æ¡†** - å¿«é€ŸæŸ¥æ‰¾ç”¨æˆ·
21. **äººå‘˜åˆ†ç»„åˆ—è¡¨** - å¯å±•å¼€/æ”¶èµ·çš„åˆ†ç»„ï¼š
    - åˆ†ç»„åç§° + æˆå‘˜æ•°é‡badge + @å…¨ç»„æŒ‰é’®
22. **ç”¨æˆ·åå•** - æ¯ä¸ªç”¨æˆ·åŒ…å«ï¼š
    - å¤´åƒ + å§“å + @ç”¨æˆ·å + åœ¨çº¿çŠ¶æ€æ ‡ç­¾
23. **é€‰ä¸­çŠ¶æ€æ ‡è®°** - æ˜¾ç¤ºå·²é€‰ä¸­çš„ç”¨æˆ·/åˆ†ç»„

##### **âš™ï¸ åº•éƒ¨æ“ä½œåŒºåŸŸ**
24. **æ™ºèƒ½æ“ä½œæŒ‰é’®** - æ ¹æ®æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢ï¼š
    - **ç¬”è®°æ¨¡å¼**ï¼š`"ğŸ’¾ ä¿å­˜ç¬”è®°"` æŒ‰é’®
    - **é—®ç­”æ¨¡å¼**ï¼š`"ğŸš€ å‘é€é—®é¢˜"` æŒ‰é’®
25. **å†…å®¹ç»Ÿè®¡ä¿¡æ¯** - æ˜¾ç¤ºï¼š
    - å­—æ•°ç»Ÿè®¡ï¼š`"å­—æ•°: 156"`
    - åˆ›å»ºæ—¶é—´ï¼š`"åˆ›å»º: 2025-01-31 14:30"`
    - ä¿®æ”¹æ—¶é—´ï¼š`"æ›´æ–°: 2025-01-31 14:35"`
26. **è¾…åŠ©æ“ä½œæŒ‰é’®ç»„**ï¼š
    - `"ğŸ“„ é¢„è§ˆ"` - é¢„è§ˆMarkdownæ¸²æŸ“æ•ˆæœ
    - `"ğŸ—‘ï¸ æ¸…ç©º"` - æ¸…ç©ºæ‰€æœ‰å†…å®¹
    - `"ğŸ“¤ å¯¼å‡º"` - å¯¼å‡ºä¸ºæ–‡ä»¶

##### **ğŸ”„ çŠ¶æ€è”åŠ¨é€»è¾‘**
27. **æ¨¡å¼åˆ‡æ¢è”åŠ¨**ï¼š
    - åˆ‡æ¢åˆ°é—®ç­”æ¨¡å¼ â†’ æ™ºèƒ½ä½“é€‰æ‹©å™¨æ¿€æ´» + æ˜¾ç¤ºå¯¹è¯åŒºåŸŸ
    - åˆ‡æ¢åˆ°ç¬”è®°æ¨¡å¼ â†’ æ™ºèƒ½ä½“é€‰æ‹©å™¨è™šåŒ– + éšè—å¯¹è¯åŒºåŸŸ
28. **å®æ—¶ä¿å­˜è”åŠ¨**ï¼š
    - å†…å®¹å˜åŒ– â†’ è‡ªåŠ¨ä¿å­˜è‰ç¨¿ â†’ æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨

#### 5.0.2 å…³é”®è”åŠ¨è®¾è®¡è¯´æ˜

- **ğŸ“/ğŸ’¬ åŠŸèƒ½åˆ‡æ¢å¼€å…³**ï¼šä¸€ä¸ªå¼€å…³æ§åˆ¶ï¼Œå·¦è¾¹ç¬”è®°/å³è¾¹é—®ç­”
- **æ™ºèƒ½ä½“é€‰æ‹©å™¨è”åŠ¨**ï¼š
  - é—®ç­”æ¨¡å¼ï¼šæ­£å¸¸é¢œè‰²ï¼Œå¯ç‚¹å‡»æ“ä½œ
  - ç¬”è®°æ¨¡å¼ï¼šç°è‰²è™šåŒ–ï¼Œä¸å¯ç‚¹å‡»
- **æ“ä½œæŒ‰é’®è”åŠ¨**ï¼š
  - ç¬”è®°æ¨¡å¼ï¼šç»¿è‰²"ä¿å­˜ç¬”è®°"æŒ‰é’®
  - é—®ç­”æ¨¡å¼ï¼šè“è‰²"å‘é€é—®é¢˜"æŒ‰é’®
- **å½•å…¥æ ·å¼åŒºåˆ«**ï¼š
  - é—®ç­”æ¨¡å¼ï¼šé—®é¢˜æ˜¯æ ‡é¢˜ï¼Œå›ç­”æ˜¯å†…å®¹
  - ç¬”è®°æ¨¡å¼ï¼šæ ‡é¢˜å•ç‹¬è®¾ç½®ï¼Œæˆ–è€…æ˜¯å†…å®¹çš„å‰20ä¸ªå­—

#### 5.0.3 å“åº”å¼é€‚é…è¦æ±‚

- **PCç«¯**ï¼šå®Œæ•´æ˜¾ç¤ºæ‰€æœ‰ç»„ä»¶
- **ç§»åŠ¨ç«¯**ï¼šéƒ¨åˆ†ç»„ä»¶æ”¶ç¼©æˆ–éšè—ï¼Œä¼˜å…ˆæ˜¾ç¤ºæ ¸å¿ƒåŠŸèƒ½

### 5.1 ç®¡ç†å‘˜ç•Œé¢
```vue
<!-- ç®¡ç†å‘˜é¢æ¿ç»„ä»¶ -->
<template>
  <div class="admin-panel">
    <el-tabs v-model="activeTab">
      <!-- ç”¨æˆ·ç®¡ç† -->
      <el-tab-pane label="ç”¨æˆ·ç®¡ç†" name="users">
        <div class="user-management">
          <!-- é‚€è¯·ç”¨æˆ· -->
          <div class="invite-section">
            <el-button type="primary" @click="showInviteDialog">
              <el-icon><Plus /></el-icon>
              é‚€è¯·ç”¨æˆ·
            </el-button>
            
            <el-badge :value="pendingInvitations" class="pending-badge">
              <el-button @click="showInvitations">å¾…å¤„ç†é‚€è¯·</el-button>
            </el-badge>
          </div>
          
          <!-- ç”¨æˆ·åˆ—è¡¨ -->
          <el-table :data="users" style="width: 100%">
            <el-table-column prop="username" label="ç”¨æˆ·å" />
            <el-table-column prop="display_name" label="æ˜¾ç¤ºå" />
            <el-table-column prop="role" label="è§’è‰²">
              <template #default="scope">
                <el-tag :type="getRoleTagType(scope.row.role)">
                  {{ getRoleText(scope.row.role) }}
                </el-tag>
              </template>
            </el-table-column>
            <el-table-column prop="last_login_at" label="æœ€åç™»å½•" />
            <el-table-column label="æ“ä½œ">
              <template #default="scope">
                <el-button size="small" @click="editUser(scope.row)">ç¼–è¾‘</el-button>
                <el-button 
                  size="small" 
                  type="danger" 
                  @click="deactivateUser(scope.row)"
                  v-if="scope.row.role !== 'owner'"
                >
                  åœç”¨
                </el-button>
              </template>
            </el-table-column>
          </el-table>
        </div>
      </el-tab-pane>
      
      <!-- ç³»ç»Ÿç›‘æ§ -->
      <el-tab-pane label="ç³»ç»Ÿç›‘æ§" name="monitor">
        <div class="system-monitor">
          <el-row :gutter="20">
            <el-col :span="6">
              <el-card>
                <div class="stat-item">
                  <h3>{{ userCount }}</h3>
                  <p>æ€»ç”¨æˆ·æ•°</p>
                </div>
              </el-card>
            </el-col>
            <el-col :span="6">
              <el-card>
                <div class="stat-item">
                  <h3>{{ currentScale }}</h3>
                  <p>å½“å‰è§„æ¨¡</p>
                </div>
              </el-card>
            </el-col>
            <el-col :span="6">
              <el-card>
                <div class="stat-item">
                  <h3>{{ dailyActive }}</h3>
                  <p>æ—¥æ´»ç”¨æˆ·</p>
                </div>
              </el-card>
            </el-col>
            <el-col :span="6">
              <el-card>
                <div class="stat-item">
                  <h3>{{ notificationsSent }}</h3>
                  <p>ä»Šæ—¥é€šçŸ¥</p>
                </div>
              </el-card>
            </el-col>
          </el-row>
        </div>
      </el-tab-pane>
    </el-tabs>
    
    <!-- é‚€è¯·ç”¨æˆ·å¯¹è¯æ¡† -->
    <InviteUserDialog 
      v-model="inviteDialogVisible"
      @success="handleInviteSuccess"
    />
  </div>
</template>
```

### 5.2 é€šçŸ¥æƒé™ç”³è¯·ï¼ˆPWAæ”¯æŒï¼‰
```typescript
// é€šçŸ¥æœåŠ¡
class NotificationManager {
  private pushToken: string | null = null;
  
  async requestPermission(): Promise<boolean> {
    // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
    if (!('Notification' in window)) {
      console.warn('æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥');
      return false;
    }
    
    // æ£€æŸ¥Service Workeræ”¯æŒ
    if (!('serviceWorker' in navigator)) {
      console.warn('æµè§ˆå™¨ä¸æ”¯æŒService Worker');
      return false;
    }
    
    // è¯·æ±‚é€šçŸ¥æƒé™
    const permission = await Notification.requestPermission();
    
    if (permission === 'granted') {
      // æ³¨å†ŒService Worker
      await this.registerServiceWorker();
      
      // è·å–æ¨é€è®¢é˜…
      await this.subscribeToPush();
      
      return true;
    }
    
    return false;
  }
  
  private async registerServiceWorker() {
    const registration = await navigator.serviceWorker.register('/sw.js');
    console.log('Service Workeræ³¨å†ŒæˆåŠŸ:', registration);
  }
  
  private async subscribeToPush() {
    const registration = await navigator.serviceWorker.ready;
    
    const subscription = await registration.pushManager.subscribe({
      userVisibleOnly: true,
      applicationServerKey: this.urlBase64ToUint8Array(PUBLIC_VAPID_KEY)
    });
    
    // å‘é€è®¢é˜…ä¿¡æ¯åˆ°æœåŠ¡å™¨
    await this.sendSubscriptionToServer(subscription);
  }
  
  private async sendSubscriptionToServer(subscription: PushSubscription) {
    const response = await fetch('/api/v1/users/push-subscription', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${getAuthToken()}`
      },
      body: JSON.stringify({
        subscription: subscription.toJSON()
      })
    });
    
    if (response.ok) {
      console.log('æ¨é€è®¢é˜…æ³¨å†ŒæˆåŠŸ');
    }
  }
}
```

## 6. éƒ¨ç½²é…ç½®æ›´æ–°

### 6.1 ç¯å¢ƒå˜é‡å¢å¼º
```bash
# .envæ–‡ä»¶å¢å¼º
# æ•°æ®åº“é…ç½®
DATABASE_URL=mysql://qa_user:qa_password@mysql:3306/qa_db

# é€šçŸ¥æœåŠ¡é…ç½®
# æ¨é€é€šçŸ¥
FIREBASE_PROJECT_ID=your_firebase_project
FIREBASE_PRIVATE_KEY=your_firebase_private_key
VAPID_PUBLIC_KEY=your_vapid_public_key
VAPID_PRIVATE_KEY=your_vapid_private_key

# çŸ­ä¿¡æœåŠ¡ï¼ˆé€‰æ‹©ä¸€ä¸ªï¼‰
SMS_PROVIDER=twilio  # twilio, aliyun, tencent
TWILIO_ACCOUNT_SID=your_twilio_sid
TWILIO_AUTH_TOKEN=your_twilio_token
TWILIO_PHONE_NUMBER=your_twilio_phone

# é‚®ä»¶æœåŠ¡
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your_email@gmail.com
SMTP_PASSWORD=your_app_password

# ç®¡ç†å‘˜é…ç½®
INITIAL_ADMIN_EMAIL=admin@example.com
INITIAL_ADMIN_PHONE=+1234567890
```

## ğŸ¯ ä¿®æ­£ç‰ˆæ ¸å¿ƒæ”¹è¿›

### âœ… è§£å†³çš„é—®é¢˜
1. **æ‰©å¤§è§„æ¨¡ä¸Šé™**ï¼šä»50äººæ‰©å±•åˆ°500äººï¼Œæ”¯æŒä¸­å‹ç»„ç»‡
2. **ç®¡ç†å‘˜æœºåˆ¶**ï¼šå®Œæ•´çš„ç”¨æˆ·é‚€è¯·ã€è§’è‰²ç®¡ç†ä½“ç³»
3. **å®Œæ•´æ‰‹æœºé€šçŸ¥**ï¼šæ¨é€ã€çŸ­ä¿¡ã€é‚®ä»¶å¤šæ¸ é“é€šçŸ¥ç³»ç»Ÿ
4. **æ™ºèƒ½ç®¡ç†å‘˜å»ºè®®**ï¼šæ ¹æ®è§„æ¨¡è‡ªåŠ¨æ¨èç®¡ç†å‘˜æ•°é‡
5. **æ¸è¿›å¼æƒé™**ï¼šä»ä¸ªäººåˆ°ä¸­å‹ç»„ç»‡çš„æƒé™å‡çº§è·¯å¾„
6. **å¤šæ¸ é“é€šçŸ¥**ï¼šæ ¹æ®ä¼˜å…ˆçº§è‡ªåŠ¨é€‰æ‹©é€šçŸ¥æ¸ é“
7. **PWAæ¨é€æ”¯æŒ**ï¼šåŸç”Ÿåº”ç”¨çº§çš„æ¨é€é€šçŸ¥ä½“éªŒ

### ğŸš€ æ–°å¢ç‰¹æ€§
1. **æ™ºèƒ½ç®¡ç†å‘˜å»ºè®®**ï¼šæ ¹æ®è§„æ¨¡è‡ªåŠ¨æ¨èç®¡ç†å‘˜æ•°é‡
2. **æ¸è¿›å¼æƒé™**ï¼šä»ä¸ªäººåˆ°ä¸­å‹ç»„ç»‡çš„æƒé™å‡çº§è·¯å¾„
3. **å¤šæ¸ é“é€šçŸ¥**ï¼šæ ¹æ®ä¼˜å…ˆçº§è‡ªåŠ¨é€‰æ‹©é€šçŸ¥æ¸ é“
4. **PWAæ¨é€æ”¯æŒ**ï¼šåŸç”Ÿåº”ç”¨çº§çš„æ¨é€é€šçŸ¥ä½“éªŒ

**ä¿®æ­£ç‰ˆv1.5çœŸæ­£è§£å†³äº†å®é™…ä½¿ç”¨ä¸­çš„å…³é”®é—®é¢˜ï¼** ğŸ‰ 