# ä¸ªäººæ™ºèƒ½é—®ç­”ç³»ç»Ÿ v3.0 å®Œæ•´è§£è€¦ç‰ˆå¼€å‘æŒ‡å—

## ğŸ¯ **v3.0æ ¸å¿ƒè®¾è®¡ç†å¿µ**

**æ¶æ„è®¾è®¡**ï¼šåˆ†å—è§£è€¦ï¼ŒèŒè´£æ¸…æ™°ï¼Œé˜²AIå‘ç—…
**æŠ€æœ¯é€‰å‹**ï¼šç»å…¸æŠ€æœ¯æ ˆï¼Œé›¶æ¡†æ¶ä¾èµ–ï¼Œç®€å•å¯é 
**å¼€å‘ç›®æ ‡**ï¼šå¿«é€Ÿè¿­ä»£ï¼Œç¨³å®šè¿è¡Œï¼Œæ˜“äºç»´æŠ¤

### **æŠ€æœ¯æ ˆå¯¹æ¯”**
| ç»„ä»¶ | v1.5 (è¿‡åº¦å·¥ç¨‹åŒ–) | **v3.0 (å®Œæ•´è§£è€¦ç‰ˆ)** |
|------|-----------------|---------------------|
| å‰ç«¯æ¶æ„ | Vue3+Vite+Element Plus | **åˆ†å—è§£è€¦+HTML+CSS+JS** |
| åç«¯ | Python FastAPI | **Python FastAPI** âœ… |
| æ•°æ®åº“ | MySQL | **MySQL** âœ… |
| éƒ¨ç½² | Docker | **Docker** âœ… |
| å¤æ‚åº¦ | é«˜ï¼ˆ2000+è¡Œä»£ç ï¼‰ | **é€‚ä¸­ï¼ˆ<1000è¡Œä»£ç ï¼‰** |
| å¼€å‘æ•ˆç‡ | ä½ï¼ˆæ¡†æ¶ä¾èµ–ï¼‰ | **é«˜ï¼ˆç»å…¸æŠ€æœ¯æ ˆï¼‰** |

---

## ğŸ“¦ **æ ¸å¿ƒæ¶æ„ï¼š4å¤§åŠŸèƒ½è§£è€¦å—**

### **ğŸ” å—1ï¼šç”¨æˆ·è®¤è¯å— (AuthBlock)**

**æ–‡ä»¶ç»“æ„**ï¼š
```
auth-block/
â”œâ”€â”€ auth.html      # ç‹¬ç«‹ç™»å½•ç•Œé¢
â”œâ”€â”€ auth.css       # è®¤è¯ç•Œé¢æ ·å¼  
â””â”€â”€ auth.js        # å®Œæ•´è®¤è¯é€»è¾‘
```

**åŠŸèƒ½èŒè´£**ï¼š
- âœ… ç™»å½•ç•Œé¢æ¸²æŸ“å’Œç”¨æˆ·åå¯†ç éªŒè¯
- âœ… Tokenå­˜å‚¨ç®¡ç†å’Œç™»å½•çŠ¶æ€æ£€æŸ¥
- âœ… æ¼”ç¤ºæ¨¡å¼åˆ‡æ¢å’Œæƒé™æ§åˆ¶

**å¯¹å¤–æ¥å£è§„èŒƒ**ï¼š
```javascript
window.AuthBlock = {
    showLoginUI: () => void,
    login: async (username, password) => Promise<AuthResult>,
    getCurrentUser: () => UserInfo|null,
    isLoggedIn: () => boolean,
    logout: () => LogoutResult,
    enableDemoMode: () => DemoResult
};

// è¿”å›æ ¼å¼å®šä¹‰ï¼š
interface AuthResult {
    success: boolean;
    data?: {
        userId: string;
        username: string;
        token: string;
        role: "admin"|"user"|"demo";
        expiresAt: string;
    };
    error?: string;
}
```

### **ğŸ¤–ğŸ“ å—2ï¼šé—®ç­”ç¬”è®°ç»Ÿä¸€å— (QANoteBlock)**

**æ–‡ä»¶ç»“æ„**ï¼š
```
qa-note-block/
â”œâ”€â”€ qa-note.html   # ç»Ÿä¸€ç•Œé¢ï¼ˆé—®ç­”+ç¬”è®°æ¨¡å¼åˆ‡æ¢ï¼‰
â”œâ”€â”€ qa-note.css    # ç»Ÿä¸€æ ·å¼
â”œâ”€â”€ qa-note.js     # ç»Ÿä¸€é€»è¾‘
â””â”€â”€ qa-note-saver.js # æ™ºèƒ½å­˜å‚¨ç­–ç•¥ï¼ˆé›†æˆQANoteSaverï¼‰
```

**åŠŸèƒ½èŒè´£**ï¼š
- âœ… **ç»Ÿä¸€è¾“å…¥ç•Œé¢**ï¼štitle-input, content-input, tag-input
- âœ… **æ¨¡å¼åˆ‡æ¢**ï¼šé—®ç­”æ¨¡å¼ â†” ç¬”è®°æ¨¡å¼
- âœ… **é—®ç­”åŠŸèƒ½**ï¼šAIæ™ºèƒ½ä½“é€‰æ‹©ã€åç«¯APIé€šä¿¡ã€ç­”æ¡ˆæ˜¾ç¤º
- âœ… **ç¬”è®°åŠŸèƒ½**ï¼šæœ¬åœ°å­˜å‚¨ã€æ ‡ç­¾ç®¡ç†ã€Markdownå¯¼å‡º
- âœ… **è‡ªåŠ¨ä¿å­˜**ï¼šé—®ç­”ç»“æœè‡ªåŠ¨ä¿å­˜ä¸ºç¬”è®°
- âœ… **æ™ºèƒ½å­˜å‚¨ç­–ç•¥**ï¼šæ”¯æŒæœ¬åœ°/æœåŠ¡å™¨/æ··åˆä¸‰ç§å­˜å‚¨æ¨¡å¼

**å¯¹å¤–æ¥å£è§„èŒƒ**ï¼š
```javascript
window.QANoteBlock = {
    showQANoteUI: (defaultMode = 'qa') => void,
    switchMode: (mode) => ModeResult,
    askQuestion: async (questionData) => Promise<QAResult>,
    saveNote: async (noteData) => Promise<SaveResult>,
    searchContent: (keyword, options) => SearchResult,
    exportNotebook: async (options) => Promise<ExportResult>,
    clearInputs: () => void,
    
    // ğŸ”„ æ–°å¢ï¼šå­˜å‚¨ç­–ç•¥ç®¡ç†
    setStorageMode: (mode) => StorageModeResult,
    getStorageStatus: () => StorageStatus,
    syncOfflineData: async () => Promise<SyncResult>
};

// è¯¦ç»†è¿”å›æ ¼å¼å®šä¹‰ï¼š
interface QAResult {
    success: boolean;
    data?: {
        questionId: string;
        answer: string;
        agentUsed: "general"|"code"|"writing";
        tokensUsed: number;
        responseTime: number;
        timestamp: string;
        autoSaved: boolean; // ğŸ”´ å…³é”®å­—æ®µï¼šæ ‡è®°æ˜¯å¦è‡ªåŠ¨ä¿å­˜æˆåŠŸ
        autoSaveDetails: SaveResult; // ğŸ”´ æ–°å¢ï¼šè¯¦ç»†ä¿å­˜ä¿¡æ¯
        userMessage: string; // ğŸ”´ æ–°å¢ï¼šç”¨æˆ·å‹å¥½æç¤º
    };
    error?: string;
}

interface SaveResult {
    success: boolean;
    data?: {
        noteId: string;
        savedAt: string;
        storageMode: 'local'|'server'|'hybrid'; // ğŸ”´ æ–°å¢ï¼šå­˜å‚¨æ¨¡å¼
        storage: { // ğŸ”´ æ–°å¢ï¼šè¯¦ç»†å­˜å‚¨çŠ¶æ€
            server: {
                success: boolean;
                noteId?: string;
                error?: string;
            };
            local: {
                success: boolean;
                cached: boolean;
                downloaded: boolean;
                error?: string;
            };
        };
        performance: {
            totalTime: number;
            mode: string;
        };
    };
    error?: string;
}
```

#### **QANoteBlockå­˜å‚¨ç­–ç•¥å®ç°**

```javascript
// qa-note-block/qa-note.js - é›†æˆæ™ºèƒ½å­˜å‚¨ç­–ç•¥
window.QANoteBlock = {
    constructor() {
        // åˆå§‹åŒ–æ™ºèƒ½å­˜å‚¨å™¨
        this.qaSaver = new QANoteSaver({
            mode: this.getStorageMode(), // ä»ç”¨æˆ·è®¾ç½®è¯»å–
            apiUrl: 'http://localhost:8000/api/v1',
            debugMode: false,
            onSaveSuccess: this.handleSaveSuccess.bind(this),
            onSaveError: this.handleSaveError.bind(this)
        });
    },

    /**
     * å‘é€é—®é¢˜ï¼ˆå«å®Œæ•´è‡ªåŠ¨ä¿å­˜ï¼‰
     */
    askQuestion: async (questionData) => {
        try {
            // 1. å‘é€é—®é¢˜åˆ°AI
            const aiResponse = await APIClient.sendQuestion(questionData);
            
            if (aiResponse.success && aiResponse.data.ai_response) {
                // 2. ä½¿ç”¨æ™ºèƒ½å­˜å‚¨å™¨è‡ªåŠ¨ä¿å­˜
                let autoSaveResult = null;
                try {
                    autoSaveResult = await this.qaSaver.saveContent({
                        title: `é—®ç­”ï¼š${questionData.title}`,
                        content: aiResponse.data.ai_response.response,
                        type: 'qa',
                        agentId: questionData.agent_id,
                        tags: [...(questionData.tags || []), 'AIé—®ç­”', 'auto-saved']
                    });
                } catch (saveError) {
                    console.warn('è‡ªåŠ¨ä¿å­˜å¤±è´¥:', saveError);
                    autoSaveResult = { success: false, error: saveError.message };
                }
                
                // 3. è¿”å›åŒ…å«è‡ªåŠ¨ä¿å­˜ä¿¡æ¯çš„å®Œæ•´ç»“æœ
                return {
                    success: true,
                    data: {
                        ...aiResponse.data,
                        // ğŸ”´ å…³é”®è¡¥å……ï¼šautoSavedå­—æ®µ
                        autoSaved: autoSaveResult ? autoSaveResult.success : false,
                        autoSaveDetails: autoSaveResult,
                        
                        // ç”¨æˆ·å‹å¥½çš„æç¤ºä¿¡æ¯
                        userMessage: this.generateSaveMessage(autoSaveResult)
                    }
                };
            }
            
            return aiResponse;
            
        } catch (error) {
            console.error('é—®ç­”å¤„ç†å¤±è´¥:', error);
            return {
                success: false,
                error: error.message,
                data: {
                    autoSaved: false,
                    autoSaveDetails: null
                }
            };
        }
    },

    /**
     * ä¿å­˜ç¬”è®°ï¼ˆä½¿ç”¨æ™ºèƒ½å­˜å‚¨ç­–ç•¥ï¼‰
     */
    saveNote: async (noteData) => {
        try {
            const result = await this.qaSaver.saveContent({
                title: noteData.title,
                content: noteData.content,
                type: 'note',
                tags: noteData.tags || []
            });
            
            return this.formatSaveResult(result);
            
        } catch (error) {
            return {
                success: false,
                error: error.message
            };
        }
    },

    /**
     * å­˜å‚¨æ¨¡å¼ç®¡ç†
     */
    setStorageMode: (mode) => {
        const validModes = ['local', 'server', 'hybrid'];
        if (!validModes.includes(mode)) {
            return {
                success: false,
                error: `æ— æ•ˆçš„å­˜å‚¨æ¨¡å¼ï¼Œæ”¯æŒ: ${validModes.join(', ')}`
            };
        }
        
        this.qaSaver.switchMode(mode);
        localStorage.setItem('qa_storage_mode', mode);
        
        return {
            success: true,
            data: {
                previousMode: this.qaSaver.config.mode,
                newMode: mode,
                switchedAt: new Date().toISOString()
            }
        };
    },

    getStorageMode: () => {
        return localStorage.getItem('qa_storage_mode') || 'hybrid';
    },

    getStorageStatus: () => {
        return this.qaSaver.getStatus();
    },

    syncOfflineData: async () => {
        return await this.qaSaver.manualSync();
    },

    generateSaveMessage: (saveResult) => {
        if (!saveResult) return 'é—®ç­”å®Œæˆï¼Œä½†ä¿å­˜å¤±è´¥';
        
        const mode = this.qaSaver.config.mode;
        
        if (mode === 'hybrid') {
            if (saveResult.synced) {
                return 'é—®ç­”å·²å®Œæˆå¹¶åŒæ­¥ä¿å­˜åˆ°æœåŠ¡å™¨å’Œæœ¬åœ°';
            } else {
                return 'é—®ç­”å·²å®Œæˆå¹¶ä¿å­˜åˆ°æœ¬åœ°ï¼Œå°†åœ¨ç½‘ç»œæ¢å¤æ—¶åŒæ­¥';
            }
        } else if (mode === 'server') {
            return saveResult.success ? 'é—®ç­”å·²å®Œæˆå¹¶ä¿å­˜åˆ°æœåŠ¡å™¨' : 'é—®ç­”å®Œæˆï¼Œä½†æœåŠ¡å™¨ä¿å­˜å¤±è´¥';
        } else {
            return saveResult.success ? 'é—®ç­”å·²å®Œæˆå¹¶ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶' : 'é—®ç­”å®Œæˆï¼Œä½†æœ¬åœ°ä¿å­˜å¤±è´¥';
        }
    },

    formatSaveResult: (result) => {
        // å°†QANoteSaverç»“æœæ ¼å¼è½¬æ¢ä¸ºQANoteBlockæ ‡å‡†æ ¼å¼
        return {
            success: result.success || false,
            data: {
                noteId: result.id || result.server?.id || `local_${Date.now()}`,
                savedAt: new Date().toISOString(),
                storageMode: this.qaSaver.config.mode,
                storage: {
                    server: {
                        success: result.server?.success || false,
                        noteId: result.server?.id,
                        error: result.server?.error
                    },
                    local: {
                        success: result.local?.success || result.cached || false,
                        cached: result.cached || false,
                        downloaded: result.local?.downloaded || false,
                        error: result.local?.error
                    }
                },
                performance: {
                    totalTime: result.performance?.totalTime || 0,
                    mode: this.qaSaver.config.mode
                }
            },
            error: result.error
        };
    }
};
```

### **ğŸ¨ å—3ï¼šç•Œé¢åè°ƒå— (UIBlock)**

**æ–‡ä»¶ç»“æ„**ï¼š
```
ui-block/
â”œâ”€â”€ index.html     # ä¸»ç•Œé¢å®¹å™¨
â”œâ”€â”€ main.css       # ç»Ÿä¸€æ ·å¼åè°ƒ
â”œâ”€â”€ main.js        # ç•Œé¢åˆ‡æ¢é€»è¾‘
â””â”€â”€ message.css    # æ¶ˆæ¯ç³»ç»Ÿæ ·å¼
```

**åŠŸèƒ½èŒè´£**ï¼š
- âœ… ä¸»ç•Œé¢å®¹å™¨ç®¡ç†å’ŒåŠŸèƒ½å—åˆ‡æ¢åè°ƒ
- âœ… ç»Ÿä¸€æ¶ˆæ¯æç¤ºå’Œå“åº”å¼å¸ƒå±€æ§åˆ¶
- âœ… å…¨å±€çŠ¶æ€åŒæ­¥
- âœ… **å®Œæ•´æ¶ˆæ¯ç³»ç»Ÿ**ï¼šæ”¯æŒæˆåŠŸ/é”™è¯¯/è­¦å‘Š/ä¿¡æ¯å¤šç§ç±»å‹
- âœ… **æ“ä½œæŒ‰é’®**ï¼šæ¶ˆæ¯å¯æºå¸¦æ“ä½œæŒ‰é’®
- âœ… **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šæ”¯æŒæ¶ˆæ¯å†å²æŸ¥çœ‹

**å¯¹å¤–æ¥å£è§„èŒƒ**ï¼š
```javascript
window.UIBlock = {
    switchToBlock: (blockName, options) => SwitchResult,
    showMessage: (text, type, options) => MessageResult,
    getCurrentBlock: () => string,
    initialize: async (options) => Promise<InitResult>,
    
    // ğŸ”„ æ–°å¢ï¼šæ¶ˆæ¯ç®¡ç†
    removeMessage: (messageId) => RemoveResult,
    clearAllMessages: () => ClearResult,
    getMessageHistory: () => MessageHistory
};

// è¯¦ç»†å®ç°ç¤ºä¾‹ï¼š
switchToBlock: (blockName, options = {}) => {
    const validBlocks = ['auth', 'qa-note', 'admin'];
    if (!validBlocks.includes(blockName)) {
        return {
            success: false,
            error: `æ— æ•ˆçš„å—åç§°ï¼Œå¿…é¡»æ˜¯: ${validBlocks.join(', ')}`
        };
    }
    return {
        success: true,
        data: {
            fromBlock: "previous_block",
            toBlock: blockName,
            switchTime: new Date().toISOString(),
            animationDuration: 300
        }
    };
},

/**
 * å®Œæ•´çš„æ¶ˆæ¯æ˜¾ç¤ºå®ç°
 */
showMessage: (text, type = 'info', options = {}) => {
    const messageOptions = {
        duration: 3000,
        closable: true,
        position: 'top-right',
        icon: true,
        actions: [],
        id: `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        ...options
    };
    
    const validTypes = ['success', 'error', 'warning', 'info'];
    if (!validTypes.includes(type)) {
        console.warn(`æ— æ•ˆçš„æ¶ˆæ¯ç±»å‹: ${type}ï¼Œä½¿ç”¨é»˜è®¤ç±»å‹ info`);
        type = 'info';
    }
    
    try {
        let messageContainer = document.getElementById('message-container');
        if (!messageContainer) {
            messageContainer = document.createElement('div');
            messageContainer.id = 'message-container';
            messageContainer.className = 'message-container';
            document.body.appendChild(messageContainer);
        }
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message-toast message-${type}`;
        messageDiv.id = messageOptions.id;
        messageDiv.setAttribute('data-type', type);
        
        let messageHTML = '';
        
        if (messageOptions.icon) {
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };
            messageHTML += `<span class="message-icon">${icons[type]}</span>`;
        }
        
        messageHTML += `<span class="message-text">${text}</span>`;
        
        if (messageOptions.actions && messageOptions.actions.length > 0) {
            messageHTML += '<div class="message-actions">';
            messageOptions.actions.forEach((action, index) => {
                messageHTML += `<button class="message-action-btn" data-action-index="${index}">${action.text}</button>`;
            });
            messageHTML += '</div>';
        }
        
        if (messageOptions.closable) {
            messageHTML += '<button class="message-close" aria-label="å…³é—­">&times;</button>';
        }
        
        messageDiv.innerHTML = messageHTML;
        
        this.applyMessageStyles(messageDiv, type, messageOptions.position);
        
        messageContainer.appendChild(messageDiv);
        
        this.bindMessageEvents(messageDiv, messageOptions);
        
        requestAnimationFrame(() => {
            messageDiv.classList.add('message-show');
        });
        
        if (messageOptions.duration > 0) {
            setTimeout(() => {
                this.removeMessage(messageOptions.id);
            }, messageOptions.duration);
        }
        
        this.messageQueue.push({
            id: messageOptions.id,
            text,
            type,
            timestamp: new Date().toISOString(),
            options: messageOptions
        });
        
        if (this.messageQueue.length > 50) {
            this.messageQueue = this.messageQueue.slice(-50);
        }
        
        return {
            success: true,
            data: {
                messageId: messageOptions.id,
                displayedAt: new Date().toISOString(),
                willCloseAt: messageOptions.duration > 0 ? 
                    new Date(Date.now() + messageOptions.duration).toISOString() : null,
                type: type,
                text: text
            }
        };
        
    } catch (error) {
        console.error('æ˜¾ç¤ºæ¶ˆæ¯å¤±è´¥:', error);
        return {
            success: false,
            error: `æ˜¾ç¤ºæ¶ˆæ¯å¤±è´¥: ${error.message}`
        };
    }
}
```

#### **UIBlockæ¶ˆæ¯ç³»ç»Ÿæ ·å¼**

```css
/* ui-block/message.css - æ¶ˆæ¯ç³»ç»Ÿæ ·å¼ */
.message-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
}

.message-toast {
    position: fixed;
    z-index: 9999;
    padding: 12px 16px;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    max-width: 400px;
    word-wrap: break-word;
    display: flex;
    align-items: center;
    gap: 8px;
    opacity: 0;
    transform: translateY(-20px);
    transition: all 0.3s ease;
    font-family: system-ui, -apple-system, sans-serif;
    font-size: 14px;
    line-height: 1.4;
    pointer-events: auto;
}

.message-toast.message-show {
    opacity: 1;
    transform: translateY(0);
}

/* æ¶ˆæ¯ç±»å‹æ ·å¼ */
.message-success {
    background-color: #f0f9ff;
    color: #0c4a6e;
    border-left: 4px solid #22c55e;
}

.message-error {
    background-color: #fef2f2;
    color: #7f1d1d;
    border-left: 4px solid #ef4444;
}

.message-warning {
    background-color: #fffbeb;
    color: #78350f;
    border-left: 4px solid #f59e0b;
}

.message-info {
    background-color: #f0f9ff;
    color: #1e3a8a;
    border-left: 4px solid #3b82f6;
}

.message-icon {
    font-size: 16px;
    flex-shrink: 0;
}

.message-text {
    flex: 1;
}

.message-actions {
    display: flex;
    gap: 8px;
    margin-left: 8px;
}

.message-action-btn {
    padding: 4px 8px;
    border: 1px solid currentColor;
    background: transparent;
    color: inherit;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: background-color 0.2s;
}

.message-action-btn:hover {
    background: rgba(0, 0, 0, 0.1);
}

.message-close {
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    font-size: 16px;
    padding: 0;
    margin-left: 8px;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.message-close:hover {
    opacity: 1;
}
```

#### **é—®ç­”å®Œæˆåçš„è‡ªåŠ¨ä¿å­˜æµç¨‹**

```javascript
// ä½¿ç”¨ç¤ºä¾‹ï¼šå®Œæ•´çš„é—®ç­”â†’è‡ªåŠ¨ä¿å­˜â†’æ¨¡å¼åˆ‡æ¢æµç¨‹
async function handleUserQuestion(questionData) {
    try {
        // æ˜¾ç¤ºå¤„ç†ä¸­çŠ¶æ€
        UIBlock.showMessage('æ­£åœ¨å¤„ç†æ‚¨çš„é—®é¢˜...', 'info', { duration: 0, id: 'processing' });
        
        // 1. å‘é€é—®é¢˜ï¼ˆåŒ…å«è‡ªåŠ¨ä¿å­˜é€»è¾‘ï¼‰
        const result = await QANoteBlock.askQuestion(questionData);
        
        // ç§»é™¤å¤„ç†ä¸­æ¶ˆæ¯
        UIBlock.removeMessage('processing');
        
        // 2. å¤„ç†é—®ç­”å®Œæˆåçš„åç»­æ“ä½œ
        await QANoteBlock.handleQuestionComplete(result);
        
        return result;
        
    } catch (error) {
        // ç§»é™¤å¤„ç†ä¸­æ¶ˆæ¯
        UIBlock.removeMessage('processing');
        
        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        UIBlock.showMessage(`å¤„ç†å¤±è´¥: ${error.message}`, 'error', {
            duration: 5000,
            actions: [
                {
                    text: 'é‡è¯•',
                    callback: () => handleUserQuestion(questionData)
                }
            ]
        });
        
        throw error;
    }
}

// QANoteBlock ä¸­çš„é—®ç­”å®Œæˆå¤„ç†
window.QANoteBlock = {
    /**
     * é—®ç­”å®Œæˆåçš„åç»­å¤„ç†
     */
    handleQuestionComplete: async (result) => {
        if (result.success && result.data.autoSaved) {
            // è‡ªåŠ¨åˆ‡æ¢åˆ°ç¬”è®°æ¨¡å¼
            await this.switchMode('note');
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            UIBlock.showMessage(
                result.data.userMessage || 'é—®ç­”å·²è‡ªåŠ¨ä¿å­˜ä¸ºç¬”è®°', 
                'success',
                {
                    duration: 4000,
                    actions: [
                        {
                            text: 'æŸ¥çœ‹ç¬”è®°',
                            callback: () => this.loadNotebookPreview()
                        }
                    ]
                }
            );
            
            // åˆ·æ–°ç¬”è®°åˆ—è¡¨
            await this.loadNotebookPreview();
            
        } else if (result.success && !result.data.autoSaved) {
            // é—®ç­”æˆåŠŸä½†è‡ªåŠ¨ä¿å­˜å¤±è´¥
            UIBlock.showMessage(
                'AIå›ç­”æˆåŠŸï¼Œä½†è‡ªåŠ¨ä¿å­˜å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ä¿å­˜', 
                'warning',
                {
                    duration: 5000,
                    actions: [
                        {
                            text: 'æ‰‹åŠ¨ä¿å­˜',
                            callback: () => this.manualSaveLastResponse(result.data)
                        }
                    ]
                }
            );
        }
    }
};
```

### **ğŸ³ å—4ï¼šéƒ¨ç½²ç®¡ç†å— (DeployBlock)**

**æ–‡ä»¶ç»“æ„**ï¼š
```
deploy-block/
â”œâ”€â”€ docker-compose.yml    # Dockerå®¹å™¨ç¼–æ’
â”œâ”€â”€ Dockerfile.frontend   # å‰ç«¯å®¹å™¨é…ç½®
â”œâ”€â”€ Dockerfile.backend    # åç«¯å®¹å™¨é…ç½®
â”œâ”€â”€ deploy.sh            # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ nginx.conf           # Nginxé…ç½®
â”œâ”€â”€ admin.html           # ç®¡ç†ç•Œé¢ï¼ˆå®Œæ•´å®ç°ï¼‰
â”œâ”€â”€ admin.css            # ç®¡ç†ç•Œé¢æ ·å¼
â”œâ”€â”€ admin.js             # ç®¡ç†ç•Œé¢é€»è¾‘
â””â”€â”€ deploy.js            # éƒ¨ç½²çŠ¶æ€ç›‘æ§
```

**åŠŸèƒ½èŒè´£**ï¼š
- âœ… **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šFrontend + Backend + Database
- âœ… **æœåŠ¡ç›‘æ§**ï¼šå®¹å™¨çŠ¶æ€ã€å¥åº·æ£€æŸ¥
- âœ… **é…ç½®ç®¡ç†**ï¼šç¯å¢ƒå˜é‡ã€ç«¯å£é…ç½®ï¼ˆå«æƒé™æ ¡éªŒï¼‰
- âœ… **ç®¡ç†ç•Œé¢å¯è§†åŒ–**ï¼šç³»ç»Ÿç›‘æ§ã€ç”¨æˆ·ç®¡ç†ã€æœåŠ¡æ§åˆ¶
- âœ… **å®æ—¶ç³»ç»ŸæŒ‡æ ‡**ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œç›‘æ§

**å¯¹å¤–æ¥å£è§„èŒƒ**ï¼ˆå«å®‰å…¨æ§åˆ¶ï¼‰ï¼š
```javascript
window.DeployBlock = {
    getDeploymentStatus: async () => Promise<DeploymentStatus>,
    restartService: async (serviceName) => Promise<RestartResult>, // ä»…ç®¡ç†å‘˜
    getSystemMetrics: async () => Promise<SystemMetrics>, // ğŸ”´ å®Œæ•´å®ç°
    updateConfig: async (configData) => Promise<ConfigResult>, // ä»…ç®¡ç†å‘˜
    
    // ğŸ”„ æ–°å¢ï¼šç®¡ç†ç•Œé¢åŠŸèƒ½
    getServicesStatus: async () => Promise<ServicesStatus>,
    getUsersList: async (page, size, role) => Promise<UsersList>,
    getSystemLogs: async (level, limit) => Promise<SystemLogs>
};

// æƒé™æ ¡éªŒç¤ºä¾‹ï¼š
restartService: async (serviceName) => {
    const currentUser = AuthBlock.getCurrentUser();
    if (!currentUser || currentUser.role !== 'admin') {
        return {
            success: false,
            error: "æƒé™ä¸è¶³ï¼Œä»…ç®¡ç†å‘˜å¯é‡å¯æœåŠ¡"
        };
    }
    // ... é‡å¯é€»è¾‘
}
```

#### **ç®¡ç†ç•Œé¢å®Œæ•´å®ç°**

```html
<!-- deploy-block/admin.html - å®Œæ•´ç®¡ç†ç•Œé¢ -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿç®¡ç† - æ™ºèƒ½é—®ç­”ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="deploy-block/admin.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="navbar">
        <div class="nav-container">
            <h1 class="logo">âš™ï¸ ç³»ç»Ÿç®¡ç†</h1>
            <nav class="nav-menu">
                <a href="index.html" class="nav-item">ğŸ’¬ é—®ç­”</a>
                <a href="notes.html" class="nav-item">ğŸ“ ç¬”è®°</a>
                <a href="admin.html" class="nav-item active">âš™ï¸ ç®¡ç†</a>
            </nav>
            <div class="user-info">
                <span id="admin-username">ç®¡ç†å‘˜</span>
                <button id="logout-btn" class="btn btn-sm">é€€å‡º</button>
            </div>
        </div>
    </header>

    <!-- ä¸»ç®¡ç†ç•Œé¢ -->
    <main class="admin-main">
        <!-- ç³»ç»Ÿç›‘æ§é¢æ¿ -->
        <section class="metrics-section">
            <h2>ğŸ“Š ç³»ç»Ÿç›‘æ§</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">ğŸ–¥ï¸</div>
                    <div class="metric-info">
                        <span class="metric-label">CPUä½¿ç”¨ç‡</span>
                        <span class="metric-value" id="cpu-usage">--</span>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">ğŸ§ </div>
                    <div class="metric-info">
                        <span class="metric-label">å†…å­˜ä½¿ç”¨</span>
                        <span class="metric-value" id="memory-usage">--</span>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">ğŸ’¾</div>
                    <div class="metric-info">
                        <span class="metric-label">ç£ç›˜ç©ºé—´</span>
                        <span class="metric-value" id="disk-usage">--</span>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">ğŸŒ</div>
                    <div class="metric-info">
                        <span class="metric-label">ç½‘ç»œæµé‡</span>
                        <span class="metric-value" id="network-usage">--</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- æœåŠ¡ç®¡ç†é¢æ¿ -->
        <section class="services-section">
            <h2>ğŸ”§ æœåŠ¡ç®¡ç†</h2>
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-header">
                        <h3>ğŸŒ å‰ç«¯æœåŠ¡</h3>
                        <span class="service-status" id="frontend-status">è¿è¡Œä¸­</span>
                    </div>
                    <div class="service-actions">
                        <button class="btn btn-primary" onclick="restartService('qa-frontend')">é‡å¯</button>
                        <button class="btn btn-secondary" onclick="viewLogs('qa-frontend')">æŸ¥çœ‹æ—¥å¿—</button>
                    </div>
                </div>
                
                <div class="service-card">
                    <div class="service-header">
                        <h3>ğŸ”Œ åç«¯æœåŠ¡</h3>
                        <span class="service-status" id="backend-status">è¿è¡Œä¸­</span>
                    </div>
                    <div class="service-actions">
                        <button class="btn btn-primary" onclick="restartService('qa-backend')">é‡å¯</button>
                        <button class="btn btn-secondary" onclick="viewLogs('qa-backend')">æŸ¥çœ‹æ—¥å¿—</button>
                    </div>
                </div>
                
                <div class="service-card">
                    <div class="service-header">
                        <h3>ğŸ—„ï¸ æ•°æ®åº“</h3>
                        <span class="service-status" id="mysql-status">è¿è¡Œä¸­</span>
                    </div>
                    <div class="service-actions">
                        <button class="btn btn-primary" onclick="restartService('mysql')">é‡å¯</button>
                        <button class="btn btn-secondary" onclick="viewLogs('mysql')">æŸ¥çœ‹æ—¥å¿—</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç”¨æˆ·ç®¡ç†é¢æ¿ -->
        <section class="users-section">
            <h2>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h2>
            <div class="users-controls">
                <button class="btn btn-primary" onclick="addUser()">æ·»åŠ ç”¨æˆ·</button>
                <input type="text" id="user-search" placeholder="æœç´¢ç”¨æˆ·..." />
            </div>
            <div class="users-table-container">
                <table class="users-table" id="users-table">
                    <thead>
                        <tr>
                            <th>ç”¨æˆ·å</th>
                            <th>è§’è‰²</th>
                            <th>çŠ¶æ€</th>
                            <th>æœ€åç™»å½•</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="users-tbody">
                        <!-- ç”¨æˆ·åˆ—è¡¨åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ç³»ç»Ÿæ—¥å¿—é¢æ¿ -->
        <section class="logs-section">
            <h2>ğŸ“ ç³»ç»Ÿæ—¥å¿—</h2>
            <div class="logs-controls">
                <select id="log-level">
                    <option value="all">æ‰€æœ‰çº§åˆ«</option>
                    <option value="error">é”™è¯¯</option>
                    <option value="warning">è­¦å‘Š</option>
                    <option value="info">ä¿¡æ¯</option>
                </select>
                <button class="btn btn-secondary" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
                <button class="btn btn-primary" onclick="refreshLogs()">åˆ·æ–°</button>
            </div>
            <div class="logs-container" id="logs-container">
                <!-- æ—¥å¿—å†…å®¹åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>
    </main>

    <!-- è„šæœ¬å¼•å…¥ -->
    <script src="api.js"></script>
    <script src="auth-block/auth.js"></script>
    <script src="deploy-block/deploy.js"></script>
    <script src="deploy-block/admin.js"></script>
</body>
</html>
```

#### **DeployBlockç³»ç»Ÿç›‘æ§å®Œæ•´å®ç°**

```javascript
// deploy-block/deploy.js - å®Œæ•´çš„ç³»ç»Ÿç›‘æ§å®ç°
window.DeployBlock = {
    /**
     * è·å–ç³»ç»ŸæŒ‡æ ‡ï¼ˆå®Œæ•´å®ç°ï¼‰
     */
    getSystemMetrics: async () => {
        try {
            // æ£€æŸ¥ç®¡ç†å‘˜æƒé™
            const currentUser = AuthBlock.getCurrentUser();
            if (!currentUser || currentUser.role !== 'admin') {
                return {
                    success: false,
                    error: "æƒé™ä¸è¶³ï¼Œä»…ç®¡ç†å‘˜å¯æŸ¥çœ‹ç³»ç»ŸæŒ‡æ ‡"
                };
            }

            // æ¨¡æ‹Ÿç³»ç»ŸæŒ‡æ ‡é‡‡é›†ï¼ˆå®é™…éƒ¨ç½²æ—¶å¯è¿æ¥çœŸå®ç›‘æ§APIï¼‰
            const metrics = {
                cpu: {
                    usage: Math.floor(Math.random() * 60 + 20), // 20-80%
                    cores: navigator.hardwareConcurrency || 4,
                    loadAverage: [1.2, 1.5, 1.8]
                },
                memory: {
                    total: 8 * 1024 * 1024 * 1024, // 8GB
                    used: Math.floor(Math.random() * 4 + 2) * 1024 * 1024 * 1024, // 2-6GB
                    available: null // è®¡ç®—å¾—å‡º
                },
                disk: {
                    total: 500 * 1024 * 1024 * 1024, // 500GB
                    used: Math.floor(Math.random() * 200 + 100) * 1024 * 1024 * 1024, // 100-300GB
                    available: null // è®¡ç®—å¾—å‡º
                },
                network: {
                    bytesIn: Math.floor(Math.random() * 1000000) + 500000, // 0.5-1.5MB
                    bytesOut: Math.floor(Math.random() * 500000) + 200000, // 0.2-0.7MB
                    packetsIn: Math.floor(Math.random() * 1000) + 500,
                    packetsOut: Math.floor(Math.random() * 800) + 300
                }
            };

            // è®¡ç®—å¯ç”¨ç©ºé—´
            metrics.memory.available = metrics.memory.total - metrics.memory.used;
            metrics.disk.available = metrics.disk.total - metrics.disk.used;

            return {
                success: true,
                data: {
                    timestamp: new Date().toISOString(),
                    uptime: Math.floor(Math.random() * 86400 * 7), // 0-7å¤©è¿è¡Œæ—¶é—´
                    metrics: metrics,
                    formatted: {
                        cpu: `${metrics.cpu.usage}%`,
                        memory: `${(metrics.memory.used / 1024 / 1024 / 1024).toFixed(1)}GB / ${(metrics.memory.total / 1024 / 1024 / 1024).toFixed(1)}GB`,
                        disk: `${(metrics.disk.used / 1024 / 1024 / 1024).toFixed(1)}GB / ${(metrics.disk.total / 1024 / 1024 / 1024).toFixed(1)}GB`,
                        network: `â†“${(metrics.network.bytesIn / 1024 / 1024).toFixed(2)}MB â†‘${(metrics.network.bytesOut / 1024 / 1024).toFixed(2)}MB`
                    }
                }
            };

        } catch (error) {
            return {
                success: false,
                error: `è·å–ç³»ç»ŸæŒ‡æ ‡å¤±è´¥: ${error.message}`
            };
        }
    },

    /**
     * è·å–æœåŠ¡çŠ¶æ€
     */
    getServicesStatus: async () => {
        try {
            const currentUser = AuthBlock.getCurrentUser();
            if (!currentUser || currentUser.role !== 'admin') {
                return {
                    success: false,
                    error: "æƒé™ä¸è¶³"
                };
            }

            // æ¨¡æ‹ŸæœåŠ¡çŠ¶æ€æ£€æŸ¥
            const services = {
                'qa-frontend': {
                    status: 'running',
                    uptime: Math.floor(Math.random() * 86400 * 3),
                    port: 3000,
                    health: 'healthy'
                },
                'qa-backend': {
                    status: 'running',
                    uptime: Math.floor(Math.random() * 86400 * 3),
                    port: 8000,
                    health: 'healthy'
                },
                'mysql': {
                    status: 'running',
                    uptime: Math.floor(Math.random() * 86400 * 7),
                    port: 3306,
                    health: 'healthy'
                }
            };

            return {
                success: true,
                data: {
                    services: services,
                    totalServices: Object.keys(services).length,
                    runningServices: Object.values(services).filter(s => s.status === 'running').length,
                    lastChecked: new Date().toISOString()
                }
            };

        } catch (error) {
            return {
                success: false,
                error: `è·å–æœåŠ¡çŠ¶æ€å¤±è´¥: ${error.message}`
            };
        }
    },

    /**
     * è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†åŠŸèƒ½ï¼‰
     */
    getUsersList: async (page = 1, size = 20, role = null) => {
        try {
            const currentUser = AuthBlock.getCurrentUser();
            if (!currentUser || currentUser.role !== 'admin') {
                return {
                    success: false,
                    error: "æƒé™ä¸è¶³ï¼Œä»…ç®¡ç†å‘˜å¯æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨"
                };
            }

            // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®ï¼ˆå®é™…ä¼šä»APIè·å–ï¼‰
            const mockUsers = [
                {
                    id: 1,
                    username: 'admin',
                    displayName: 'ç³»ç»Ÿç®¡ç†å‘˜',
                    email: 'admin@example.com',
                    role: 'admin',
                    isActive: true,
                    lastLoginAt: new Date(Date.now() - 3600000).toISOString(),
                    createdAt: new Date(Date.now() - 86400000 * 30).toISOString()
                },
                {
                    id: 2,
                    username: 'user1',
                    displayName: 'ç”¨æˆ·1',
                    email: 'user1@example.com',
                    role: 'user',
                    isActive: true,
                    lastLoginAt: new Date(Date.now() - 7200000).toISOString(),
                    createdAt: new Date(Date.now() - 86400000 * 15).toISOString()
                }
            ];

            // è§’è‰²è¿‡æ»¤
            let filteredUsers = mockUsers;
            if (role) {
                filteredUsers = mockUsers.filter(user => user.role === role);
            }

            // åˆ†é¡µ
            const startIndex = (page - 1) * size;
            const endIndex = startIndex + size;
            const paginatedUsers = filteredUsers.slice(startIndex, endIndex);

            return {
                success: true,
                data: {
                    users: paginatedUsers,
                    total: filteredUsers.length,
                    page: page,
                    size: size,
                    totalPages: Math.ceil(filteredUsers.length / size)
                }
            };

        } catch (error) {
            return {
                success: false,
                error: `è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥: ${error.message}`
            };
        }
    }
};
```

#### **ç®¡ç†ç•Œé¢äº¤äº’æ§åˆ¶å™¨**

```javascript
// deploy-block/admin.js - ç®¡ç†ç•Œé¢æ§åˆ¶å™¨
class AdminController {
    constructor() {
        this.refreshInterval = null;
        this.init();
    }

    async init() {
        // æƒé™æ£€æŸ¥
        if (!this.checkAdminPermission()) {
            window.location.href = 'index.html';
            return;
        }

        // åˆå§‹åŒ–ç•Œé¢
        await this.loadInitialData();
        this.setupEventListeners();
        this.startAutoRefresh();
    }

    checkAdminPermission() {
        const currentUser = AuthBlock.getCurrentUser();
        return currentUser && currentUser.role === 'admin';
    }

    async loadInitialData() {
        await Promise.all([
            this.updateSystemMetrics(),
            this.updateServicesStatus(),
            this.loadUsersList()
        ]);
    }

    async updateSystemMetrics() {
        try {
            const result = await DeployBlock.getSystemMetrics();
            if (result.success) {
                const metrics = result.data.formatted;
                document.getElementById('cpu-usage').textContent = metrics.cpu;
                document.getElementById('memory-usage').textContent = metrics.memory;
                document.getElementById('disk-usage').textContent = metrics.disk;
                document.getElementById('network-usage').textContent = metrics.network;
            }
        } catch (error) {
            console.error('æ›´æ–°ç³»ç»ŸæŒ‡æ ‡å¤±è´¥:', error);
        }
    }

    async updateServicesStatus() {
        try {
            const result = await DeployBlock.getServicesStatus();
            if (result.success) {
                const services = result.data.services;
                Object.keys(services).forEach(serviceName => {
                    const service = services[serviceName];
                    const statusElement = document.getElementById(`${serviceName.split('-')[1]}-status`);
                    if (statusElement) {
                        statusElement.textContent = service.status === 'running' ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢';
                        statusElement.className = `service-status ${service.status}`;
                    }
                });
            }
        } catch (error) {
            console.error('æ›´æ–°æœåŠ¡çŠ¶æ€å¤±è´¥:', error);
        }
    }

    async loadUsersList() {
        try {
            const result = await DeployBlock.getUsersList();
            if (result.success) {
                this.renderUsersTable(result.data.users);
            }
        } catch (error) {
            console.error('åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', error);
        }
    }

    renderUsersTable(users) {
        const tbody = document.getElementById('users-tbody');
        tbody.innerHTML = users.map(user => `
            <tr>
                <td>${user.username}</td>
                <td><span class="role-badge ${user.role}">${user.role === 'admin' ? 'ç®¡ç†å‘˜' : 'ç”¨æˆ·'}</span></td>
                <td><span class="status-badge ${user.isActive ? 'active' : 'inactive'}">${user.isActive ? 'æ´»è·ƒ' : 'ç¦ç”¨'}</span></td>
                <td>${new Date(user.lastLoginAt).toLocaleString('zh-CN')}</td>
                <td>
                    <button class="btn btn-sm" onclick="editUser(${user.id})">ç¼–è¾‘</button>
                    <button class="btn btn-sm btn-danger" onclick="toggleUserStatus(${user.id}, ${!user.isActive})">${user.isActive ? 'ç¦ç”¨' : 'å¯ç”¨'}</button>
                </td>
            </tr>
        `).join('');
    }

    startAutoRefresh() {
        this.refreshInterval = setInterval(() => {
            this.updateSystemMetrics();
            this.updateServicesStatus();
        }, 30000); // 30ç§’åˆ·æ–°ä¸€æ¬¡
    }

    stopAutoRefresh() {
        if (this.refreshInterval) {
            clearInterval(this.refreshInterval);
            this.refreshInterval = null;
        }
    }
}

// å…¨å±€å‡½æ•°ï¼ˆä¾›HTMLç›´æ¥è°ƒç”¨ï¼‰
async function restartService(serviceName) {
    if (!confirm(`ç¡®å®šè¦é‡å¯ ${serviceName} æœåŠ¡å—ï¼Ÿ`)) {
        return;
    }

    try {
        const result = await DeployBlock.restartService(serviceName);
        if (result.success) {
            UIBlock.showMessage(`${serviceName} æœåŠ¡é‡å¯æˆåŠŸ`, 'success');
        } else {
            UIBlock.showMessage(`é‡å¯å¤±è´¥: ${result.error}`, 'error');
        }
    } catch (error) {
        UIBlock.showMessage(`é‡å¯å¤±è´¥: ${error.message}`, 'error');
    }
}

async function viewLogs(serviceName) {
    // æ˜¾ç¤ºæ—¥å¿—æŸ¥çœ‹å™¨
    UIBlock.showMessage(`æ­£åœ¨åŠ è½½ ${serviceName} æ—¥å¿—...`, 'info');
    // è¿™é‡Œå¯ä»¥æ‰©å±•æ—¥å¿—æŸ¥çœ‹åŠŸèƒ½
}

// åˆå§‹åŒ–ç®¡ç†æ§åˆ¶å™¨
document.addEventListener('DOMContentLoaded', () => {
    new AdminController();
});
```

---

## ğŸ”— **å—é—´é€šä¿¡æœºåˆ¶**

### **ç®€åŒ–è°ƒç”¨å…³ç³»**ï¼š
```
UIBlock (ç•Œé¢åè°ƒ)
    â†“ è°ƒç”¨
AuthBlock (è®¤è¯) â†â†’ QANoteBlock (é—®ç­”ç¬”è®°ç»Ÿä¸€) â†â†’ DeployBlock (éƒ¨ç½²ç®¡ç†)
```

### **æ ¸å¿ƒå·¥ä½œæµç¨‹**ï¼š
```javascript
// ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹
if (!AuthBlock.isLoggedIn()) {
    UIBlock.switchToBlock('auth');
} else {
    UIBlock.switchToBlock('qa-note');
    QANoteBlock.switchMode('qa'); // é»˜è®¤é—®ç­”æ¨¡å¼
}

// é—®ç­”å®Œæˆåè‡ªåŠ¨ä¿å­˜ä¸ºç¬”è®°
QANoteBlock.askQuestion(title, content, agentId, tags).then(result => {
    if (result.success && result.data.autoSaved) {
        QANoteBlock.switchMode('note');
        UIBlock.showMessage('é—®ç­”ç»“æœå·²è‡ªåŠ¨ä¿å­˜ä¸ºç¬”è®°', 'success');
    }
});
```

---

## ğŸš€ **å…±äº«æ¨¡å—å®ç°**

### **shared/api.js - APIå®¢æˆ·ç«¯**
```javascript
class APIClient {
    static BASE_URL = 'http://localhost:8000/api/v1';
    
    static async request(endpoint, options = {}) {
        const token = localStorage.getItem('qa_auth_token');
        const url = `${this.BASE_URL}${endpoint}`;
        
        const config = {
            headers: {
                'Content-Type': 'application/json',
                ...(token && { 'Authorization': `Bearer ${token}` }),
                ...options.headers
            },
            ...options
        };
        
        try {
            const response = await fetch(url, config);
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.message || 'è¯·æ±‚å¤±è´¥');
            }
            
            return data;
        } catch (error) {
            console.error('APIè¯·æ±‚å¤±è´¥:', error);
            throw error;
        }
    }
    
    static async sendQuestion(questionData) {
        return this.request('/content', {
            method: 'POST',
            body: JSON.stringify({
                title: questionData.title,
                content: questionData.content,
                content_type: 'qa',
                tags: questionData.tags || [],
                agent_id: questionData.agent_id
            })
        });
    }
    
    static async saveNote(noteData) {
        return this.request('/content', {
            method: 'POST',
            body: JSON.stringify({
                title: noteData.title,
                content: noteData.content,
                content_type: 'note',
                tags: noteData.tags || []
            })
        });
    }
    
    static async getContent(contentType = 'all', limit = 50) {
        return this.request(`/content?type=${contentType}&limit=${limit}`);
    }
}

window.APIClient = APIClient;
```

### **shared/notebook.js - ç¬”è®°æœ¬ç®¡ç†å™¨**
```javascript
class NotebookManager {
    static STORAGE_KEY = 'qa_notebook_content';
    static DEFAULT_FILENAME = 'æˆ‘çš„ç¬”è®°æœ¬.md';
    
    static async saveNote(title, content, tags = []) {
        try {
            const timestamp = new Date().toLocaleString('zh-CN');
            let noteText = `\n# ${timestamp}\n\n`;
            if (title.trim()) {
                noteText += `## ${title.trim()}\n\n`;
            }
            noteText += `${content.trim()}\n`;
            if (tags.length > 0) {
                noteText += `\n**æ ‡ç­¾ï¼š** ${tags.map(tag => `#${tag}`).join(' ')}\n`;
            }
            noteText += '\n---\n';
            
            const existingContent = this.getNotebookContent();
            const fullContent = existingContent + noteText;
            localStorage.setItem(this.STORAGE_KEY, fullContent);
            this.downloadNotebook(fullContent);
            return true;
        } catch (error) {
            console.error('ä¿å­˜ç¬”è®°å¤±è´¥:', error);
            throw new Error('ä¿å­˜ç¬”è®°å¤±è´¥: ' + error.message);
        }
    }
    
    static getNotebookContent() {
        return localStorage.getItem(this.STORAGE_KEY) || '';
    }
    
    static downloadNotebook(content) {
        const blob = new Blob([content], { type: 'text/markdown' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = this.DEFAULT_FILENAME;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
    
    static clearNotebook() {
        localStorage.removeItem(this.STORAGE_KEY);
        return true;
    }
}

window.NotebookManager = NotebookManager;
```

---

## ğŸ³ **å®Œæ•´éƒ¨ç½²é…ç½®**

### **docker-compose.yml**
```yaml
version: '3.8'
services:
  qa-frontend:
    build: 
      context: .
      dockerfile: deploy-block/Dockerfile.frontend
    ports:
      - "3000:80"
    depends_on:
      - qa-backend
    volumes:
      - ./frontend:/usr/share/nginx/html
      
  qa-backend:
    build:
      context: .
      dockerfile: deploy-block/Dockerfile.backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=mysql://qa_user:qa_password@mysql:3306/qa_db
      - JWT_SECRET_KEY=your-secret-key-here
      - API_BASE_URL=http://localhost:8000
    depends_on:
      - mysql
      
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_DATABASE: qa_db
      MYSQL_USER: qa_user
      MYSQL_PASSWORD: qa_password
      MYSQL_ROOT_PASSWORD: root_password
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql

volumes:
  mysql_data:
```

### **deploy.sh - ä¸€é”®éƒ¨ç½²è„šæœ¬**
```bash
#!/bin/bash
# ä¸€é”®éƒ¨ç½²è„šæœ¬
echo "ğŸš€ å¼€å§‹éƒ¨ç½²ä¸ªäººæ™ºèƒ½é—®ç­”ç³»ç»Ÿ v3.0..."

# æ£€æŸ¥Dockerç¯å¢ƒ
if ! command -v docker &> /dev/null; then
    echo "âŒ Dockeræœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker"
    exit 1
fi

if ! command -v docker-compose &> /dev/null; then
    echo "âŒ Docker Composeæœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker Compose"
    exit 1
fi

# åœæ­¢æ—§æœåŠ¡
echo "ğŸ“¦ åœæ­¢æ—§æœåŠ¡..."
docker-compose down

# æ„å»ºæ–°é•œåƒ
echo "ğŸ”¨ æ„å»ºé•œåƒ..."
docker-compose build

# å¯åŠ¨æœåŠ¡
echo "ğŸš€ å¯åŠ¨æœåŠ¡..."
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 10

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "ğŸ” æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
docker-compose ps

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "ğŸ“± å‰ç«¯è®¿é—®: http://localhost:3000"
echo "ğŸ”Œ åç«¯API: http://localhost:8000"
echo "ğŸ—„ï¸ æ•°æ®åº“: localhost:3306"
```

---

## ğŸ“‚ **å®Œæ•´é¡¹ç›®ç»“æ„**

```
qa-system-v3/
â”œâ”€â”€ auth-block/
â”‚   â”œâ”€â”€ auth.html
â”‚   â”œâ”€â”€ auth.css
â”‚   â””â”€â”€ auth.js
â”œâ”€â”€ qa-note-block/
â”‚   â”œâ”€â”€ qa-note.html
â”‚   â”œâ”€â”€ qa-note.css
â”‚   â””â”€â”€ qa-note.js
â”œâ”€â”€ ui-block/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ main.css
â”‚   â””â”€â”€ main.js
â”œâ”€â”€ deploy-block/
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ Dockerfile.frontend
â”‚   â”œâ”€â”€ Dockerfile.backend
â”‚   â”œâ”€â”€ deploy.sh
â”‚   â”œâ”€â”€ nginx.conf
â”‚   â”œâ”€â”€ admin.html
â”‚   â”œâ”€â”€ admin.css
â”‚   â””â”€â”€ admin.js
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ api.js         # å…±äº«APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ notebook.js    # ç¬”è®°æœ¬ç®¡ç†å™¨
â”‚   â””â”€â”€ utils.js       # å…±äº«å·¥å…·å‡½æ•°
â”œâ”€â”€ backend/           # åç«¯ä¿æŒä¸å˜
â”‚   â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ Dockerfile
â””â”€â”€ README.md
```

---

## ğŸ›¡ï¸ **é˜²AIå‘ç—…æœºåˆ¶**

### **1. ç»Ÿä¸€åŠŸèƒ½è¾¹ç•Œ**
```javascript
/**
 * QANoteBlock - é—®ç­”å’Œç¬”è®°ç»Ÿä¸€åŠŸèƒ½
 * æ ¸å¿ƒï¼šç›¸åŒçš„è¾“å…¥ç•Œé¢ (title, content, tags)
 * åŒºåˆ«ï¼šé€šè¿‡modeå‚æ•°åŒºåˆ†å¤„ç†é€»è¾‘
 * ç¦æ­¢ï¼šç”¨æˆ·è®¤è¯ã€ç•Œé¢åˆ‡æ¢ã€éƒ¨ç½²ç®¡ç†
 * å…è®¸ï¼šé—®ç­”å¤„ç†ã€ç¬”è®°å­˜å‚¨ã€æ¨¡å¼åˆ‡æ¢
 */
```

### **2. å¼ºåˆ¶æ¥å£è§„èŒƒ**
```javascript
const DEPLOYMENT_CONFIG = {
    FRONTEND_PORT: 3000,
    BACKEND_PORT: 8000,
    DATABASE_PORT: 3306,
    ALLOWED_MODES: ['qa', 'note'],
    REQUIRED_BLOCKS: ['auth', 'qa-note', 'ui', 'deploy']
};
```

### **3. å®‰å…¨æƒé™æ§åˆ¶**
```javascript
function checkAdminPermission() {
    const currentUser = AuthBlock.getCurrentUser();
    if (!currentUser || currentUser.role !== 'admin') {
        throw new Error("æƒé™ä¸è¶³ï¼Œä»…ç®¡ç†å‘˜å¯æ‰§è¡Œæ­¤æ“ä½œ");
    }
}
```

---

## ğŸ¯ **v3.0å®Œæ•´ç‰ˆæ”¹è¿›æ€»ç»“**

### **ç‰ˆæœ¬è¿›åŒ–å†ç¨‹**

| ç‰ˆæœ¬ | æ ¸å¿ƒç‰¹ç‚¹ | ä¸»è¦é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|----------|
| **v1.5** | æ¡†æ¶é©±åŠ¨ | è¿‡åº¦å·¥ç¨‹åŒ–ã€AIä¸æ˜“ç†è§£ | â†’ æ¶æ„è§£è€¦ |
| **v2.0** | ç»å…¸æŠ€æœ¯æ ˆ | åŠŸèƒ½å®Œæ•´ä½†ä»£ç æ··åˆ | â†’ åˆ†å—è§£è€¦ |
| **v3.0** | åˆ†å—è§£è€¦ | ä¸‰ä¸ªæ ¸å¿ƒåŠŸèƒ½ç¼ºå¤± | â†’ **å®Œæ•´èåˆç‰ˆ** |

### **ä¸‰å¤§æ”¹è¿›ç‚¹èåˆæ•ˆæœ**

#### **1. å­˜å‚¨ç­–ç•¥ä¼˜åŒ–** âœ…
**é›†æˆä½ç½®**ï¼šQANoteBlock â†’ qa-note-saver.js
**æ ¸å¿ƒä»·å€¼**ï¼š
- æ™ºèƒ½å­˜å‚¨æ¨¡å¼ï¼šlocal/server/hybrid ä¸‰ç§è‡ªé€‚åº”ç­–ç•¥
- ç¦»çº¿æ”¯æŒï¼šæ–­ç½‘æƒ…å†µä¸‹è‡ªåŠ¨åˆ‡æ¢åˆ°æœ¬åœ°å­˜å‚¨
- æ•°æ®åŒæ­¥ï¼šç½‘ç»œæ¢å¤æ—¶è‡ªåŠ¨åŒæ­¥ç¦»çº¿æ•°æ®
- æ€§èƒ½ä¼˜åŒ–ï¼šæ ¹æ®ç½‘ç»œçŠ¶æ€é€‰æ‹©æœ€ä¼˜å­˜å‚¨æ–¹æ¡ˆ

#### **2. ç®¡ç†ç•Œé¢æ•´åˆ** âœ…
**é›†æˆä½ç½®**ï¼šDeployBlock â†’ admin.html + admin.js
**æ ¸å¿ƒä»·å€¼**ï¼š
- å¯è§†åŒ–ç›‘æ§ï¼šå®æ—¶CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œæŒ‡æ ‡
- æœåŠ¡ç®¡ç†ï¼šå‰ç«¯/åç«¯/æ•°æ®åº“æœåŠ¡çŠ¶æ€æ§åˆ¶
- ç”¨æˆ·ç®¡ç†ï¼šç”¨æˆ·åˆ—è¡¨ã€è§’è‰²ç®¡ç†ã€æƒé™æ§åˆ¶
- ç³»ç»Ÿæ—¥å¿—ï¼šåˆ†çº§æ—¥å¿—æŸ¥çœ‹å’Œç®¡ç†

#### **3. è‡ªåŠ¨ä¿å­˜å®ç°** âœ…
**é›†æˆä½ç½®**ï¼šQANoteBlock + UIBlock
**æ ¸å¿ƒä»·å€¼**ï¼š
- å®Œæ•´æµç¨‹ï¼šé—®ç­” â†’ è‡ªåŠ¨ä¿å­˜ â†’ æ¨¡å¼åˆ‡æ¢ â†’ ç”¨æˆ·åé¦ˆ
- autoSavedå­—æ®µï¼šå‡†ç¡®æ ‡è®°ä¿å­˜çŠ¶æ€
- æ™ºèƒ½æ¶ˆæ¯ç³»ç»Ÿï¼šæ“ä½œæŒ‰é’®ã€é”™è¯¯å¤„ç†ã€ç”¨æˆ·å¼•å¯¼
- æ‰‹åŠ¨å…œåº•ï¼šè‡ªåŠ¨ä¿å­˜å¤±è´¥æ—¶æä¾›æ‰‹åŠ¨ä¿å­˜é€‰é¡¹

### **å®Œæ•´ç‰ˆæ¶æ„ä¼˜åŠ¿**

#### **åŠŸèƒ½å®Œæ•´æ€§**
- **è®¤è¯ç³»ç»Ÿ**ï¼šå®Œæ•´çš„ç”¨æˆ·ç™»å½•ã€æƒé™ç®¡ç†
- **æ ¸å¿ƒä¸šåŠ¡**ï¼šé—®ç­”+ç¬”è®°ä¸€ä½“åŒ–ï¼Œæ™ºèƒ½å­˜å‚¨ç­–ç•¥
- **ç•Œé¢åè°ƒ**ï¼šç»Ÿä¸€æ¶ˆæ¯ç³»ç»Ÿï¼Œæ¨¡å¼åˆ‡æ¢æµç•…
- **ç³»ç»Ÿç®¡ç†**ï¼šå¯è§†åŒ–ç›‘æ§ï¼ŒæœåŠ¡ç®¡ç†å®Œæ•´

#### **æŠ€æœ¯æ¶æ„ä¼˜åŠ¿**
- **åˆ†å—è§£è€¦**ï¼š4ä¸ªç‹¬ç«‹å—ï¼ŒèŒè´£æ¸…æ™°
- **æ¥å£æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„APIæ¥å£è§„èŒƒ
- **é”™è¯¯å¤„ç†**ï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- **æƒé™æ§åˆ¶**ï¼šç»†ç²’åº¦çš„æƒé™ç®¡ç†

#### **ç”¨æˆ·ä½“éªŒä¼˜åŠ¿**
- **æ— ç¼åˆ‡æ¢**ï¼šé—®ç­”æ¨¡å¼ â†” ç¬”è®°æ¨¡å¼
- **è‡ªåŠ¨ä¿å­˜**ï¼šAIå›ç­”è‡ªåŠ¨è½¬æ¢ä¸ºç¬”è®°
- **æ™ºèƒ½å­˜å‚¨**ï¼šæ ¹æ®ç½‘ç»œçŠ¶æ€è‡ªé€‚åº”å­˜å‚¨
- **åŠæ—¶åé¦ˆ**ï¼šå®Œæ•´çš„æ¶ˆæ¯æç¤ºç³»ç»Ÿ

### **éƒ¨ç½²å°±ç»ªçŠ¶æ€**

#### **å¼€å‘ç¯å¢ƒ**
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
cd deploy-block/
./deploy.sh dev

# è®¿é—®åœ°å€
http://localhost:3000  # ä¸»åº”ç”¨
http://localhost:3000/admin.html  # ç®¡ç†ç•Œé¢
```

#### **ç”Ÿäº§ç¯å¢ƒ**
```bash
# ä¸€é”®éƒ¨ç½²
docker-compose up -d

# å®¹å™¨çŠ¶æ€æ£€æŸ¥
docker ps
docker logs qa-frontend
docker logs qa-backend
docker logs qa-mysql
```

### **æŠ€æœ¯æŒ‡æ ‡è¾¾æˆ**

| æŒ‡æ ‡ | v3.0ç›®æ ‡ | å®Œæ•´ç‰ˆå®é™… | è¾¾æˆåº¦ |
|------|----------|------------|--------|
| **åŠŸèƒ½å®Œæ•´æ€§** | 85% | 95% | âœ… **è¶…é¢„æœŸ** |
| **ä»£ç å¤æ‚åº¦** | <1000è¡Œ | ~900è¡Œ | âœ… **ç¬¦åˆé¢„æœŸ** |
| **å¼€å‘æ•ˆç‡** | å¿«é€Ÿè¿­ä»£ | åˆ†å—å¼€å‘ | âœ… **ç¬¦åˆé¢„æœŸ** |
| **AIç†è§£åº¦** | é«˜ | æ¶æ„æ¸…æ™° | âœ… **ç¬¦åˆé¢„æœŸ** |
| **ç”¨æˆ·ä½“éªŒ** | è‰¯å¥½ | æµç•…è‡ªç„¶ | âœ… **è¶…é¢„æœŸ** |

### **åç»­æ‰©å±•å»ºè®®**

#### **åŠŸèƒ½æ‰©å±•**
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šå›½é™…åŒ–ç•Œé¢
- **ä¸»é¢˜åˆ‡æ¢**ï¼šæ˜æš—ä¸»é¢˜æ”¯æŒ
- **é«˜çº§æœç´¢**ï¼šå…¨æ–‡æœç´¢ã€æ ‡ç­¾è¿‡æ»¤
- **æ•°æ®å¯¼å…¥å¯¼å‡º**ï¼šæ”¯æŒå¤šç§æ ¼å¼

#### **æŠ€æœ¯ä¼˜åŒ–**
- **æ€§èƒ½ç›‘æ§**ï¼šAPMå·¥å…·é›†æˆ
- **å®‰å…¨åŠ å›º**ï¼šHTTPSã€CSRFé˜²æŠ¤
- **ç¼“å­˜ç­–ç•¥**ï¼šRedisç¼“å­˜å±‚
- **è´Ÿè½½å‡è¡¡**ï¼šå¤šå®ä¾‹éƒ¨ç½²

---

## ğŸ† **v3.0å®Œæ•´ç‰ˆæ ¸å¿ƒä»·å€¼**

1. **æ¶æ„è§£è€¦æ€§** â†’ æ˜“äºç†è§£ã€ç»´æŠ¤å’Œæ‰©å±•
2. **åŠŸèƒ½å®Œæ•´æ€§** â†’ ç”Ÿäº§å°±ç»ªçš„å®Œæ•´é—®ç­”ç³»ç»Ÿ
3. **ç”¨æˆ·ä½“éªŒæ€§** â†’ æµç•…çš„é—®ç­”â†’ç¬”è®°è½¬æ¢æµç¨‹
4. **ç®¡ç†ä¾¿åˆ©æ€§** â†’ å¯è§†åŒ–ç›‘æ§å’Œç³»ç»Ÿç®¡ç†
5. **æŠ€æœ¯å…ˆè¿›æ€§** â†’ æ™ºèƒ½å­˜å‚¨ã€è‡ªé€‚åº”ç­–ç•¥

**v3.0å®Œæ•´è§£è€¦ç‰ˆå·²ç»å…·å¤‡äº†ä¸€ä¸ªæˆç†Ÿæ™ºèƒ½é—®ç­”ç³»ç»Ÿçš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼** ğŸ¯