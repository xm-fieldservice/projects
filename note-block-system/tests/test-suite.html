<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬”è®°å—ç³»ç»Ÿ - æµ‹è¯•å¥—ä»¶</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f2f5;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .test-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-header {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #34495e;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }
        
        .test-case {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid #3498db;
            background: #f8f9fa;
        }
        
        .test-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .test-result {
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
        }
        
        .test-pass {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-fail {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-summary {
            background: #e9ecef;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.2em;
        }
        
        .btn {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ç¬”è®°å—ç³»ç»Ÿæµ‹è¯•å¥—ä»¶</h1>
    
    <div class="test-summary">
        <div>æµ‹è¯•è¿›åº¦: <span id="progress-text">0/0</span></div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
        <div>
            <button class="btn btn-success" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="btn" onclick="runQuickTests()">å¿«é€Ÿæµ‹è¯•</button>
            <button class="btn btn-danger" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>
    </div>
    
    <!-- åŸºç¡€åŠŸèƒ½æµ‹è¯• -->
    <div class="test-container">
        <div class="test-header">ğŸ”§ åŸºç¡€åŠŸèƒ½æµ‹è¯•</div>
        
        <div class="test-case">
            <div class="test-name">1. ç³»ç»Ÿåˆå§‹åŒ–æµ‹è¯•</div>
            <div id="test-1-result" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-name">2. å·¥å…·åŒ…åˆ›å»ºæµ‹è¯•</div>
            <div id="test-2-result" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-name">3. å‡½æ•°æ¥å£æµ‹è¯•</div>
            <div id="test-3-result" class="test-result"></div>
        </div>
    </div>
    
    <!-- ç­–ç•¥ç”Ÿæˆæµ‹è¯• -->
    <div class="test-container">
        <div class="test-header">ğŸ¤– ç­–ç•¥ç”Ÿæˆæµ‹è¯•</div>
        
        <div class="test-case">
            <div class="test-name">4. æ ·ä¾‹åˆ†ææµ‹è¯•</div>
            <div id="test-4-result" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-name">5. ç­–ç•¥ç”Ÿæˆæµ‹è¯•</div>
            <div id="test-5-result" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-name">6. ç­–ç•¥éªŒè¯æµ‹è¯•</div>
            <div id="test-6-result" class="test-result"></div>
        </div>
    </div>
    
    <!-- ç¬”è®°ç”Ÿæˆæµ‹è¯• -->
    <div class="test-container">
        <div class="test-header">ğŸ“ ç¬”è®°ç”Ÿæˆæµ‹è¯•</div>
        
        <div class="test-case">
            <div class="test-name">7. åŸºç¡€ç¬”è®°ç”Ÿæˆæµ‹è¯•</div>
            <div id="test-7-result" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-name">8. å¤æ‚ç»“æ„ç”Ÿæˆæµ‹è¯•</div>
            <div id="test-8-result" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-name">9. ç­–ç•¥åˆ‡æ¢æµ‹è¯•</div>
            <div id="test-9-result" class="test-result"></div>
        </div>
    </div>
    
    <!-- é«˜çº§åŠŸèƒ½æµ‹è¯• -->
    <div class="test-container">
        <div class="test-header">ğŸš€ é«˜çº§åŠŸèƒ½æµ‹è¯•</div>
        
        <div class="test-case">
            <div class="test-name">10. å¿«é€ŸåŸå‹æµ‹è¯•</div>
            <div id="test-10-result" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-name">11. æ‰¹é‡å¤„ç†æµ‹è¯•</div>
            <div id="test-11-result" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-name">12. ç­–ç•¥å¯¹æ¯”æµ‹è¯•</div>
            <div id="test-12-result" class="test-result"></div>
        </div>
    </div>
    
    <!-- å…¼å®¹æ€§æµ‹è¯• -->
    <div class="test-container">
        <div class="test-header">ğŸ”„ å…¼å®¹æ€§æµ‹è¯•</div>
        
        <div class="test-case">
            <div class="test-name">13. ç‰ˆæœ¬æ£€æµ‹æµ‹è¯•</div>
            <div id="test-13-result" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-name">14. æ ¼å¼è½¬æ¢æµ‹è¯•</div>
            <div id="test-14-result" class="test-result"></div>
        </div>
        
        <div class="test-case">
            <div class="test-name">15. é”™è¯¯å¤„ç†æµ‹è¯•</div>
            <div id="test-15-result" class="test-result"></div>
        </div>
    </div>

    <!-- å¼•å…¥æ ¸å¿ƒç»„ä»¶ -->
    <script src="../core/pluggable-note-generator.js"></script>
    <script src="../core/auto-strategy-generator.js"></script>
    <script src="../core/note-compatibility-adapter.js"></script>
    <script src="../tools/note-toolkit.js"></script>
    
    <script>
        // æµ‹è¯•ç»“æœè·Ÿè¸ª
        let testResults = [];
        let totalTests = 15;
        
        // æµ‹è¯•ç”¨ä¾‹å®šä¹‰
        const testCases = [
            // åŸºç¡€åŠŸèƒ½æµ‹è¯•
            {
                id: 1,
                name: "ç³»ç»Ÿåˆå§‹åŒ–æµ‹è¯•",
                test: function() {
                    if (typeof NoteToolkit === 'undefined') {
                        throw new Error('NoteToolkitæœªå®šä¹‰');
                    }
                    if (typeof PluggableNoteGenerator === 'undefined') {
                        throw new Error('PluggableNoteGeneratoræœªå®šä¹‰');
                    }
                    if (typeof AutoStrategyGenerator === 'undefined') {
                        throw new Error('AutoStrategyGeneratoræœªå®šä¹‰');
                    }
                    return "âœ… æ‰€æœ‰æ ¸å¿ƒç»„ä»¶å·²æ­£ç¡®åŠ è½½";
                }
            },
            {
                id: 2,
                name: "å·¥å…·åŒ…åˆ›å»ºæµ‹è¯•",
                test: function() {
                    const toolkit = new NoteToolkit();
                    if (!toolkit.version) {
                        throw new Error('å·¥å…·åŒ…ç‰ˆæœ¬ä¿¡æ¯ç¼ºå¤±');
                    }
                    if (typeof toolkit.generate !== 'function') {
                        throw new Error('generateæ–¹æ³•ä¸å­˜åœ¨');
                    }
                    return `âœ… å·¥å…·åŒ…åˆ›å»ºæˆåŠŸï¼Œç‰ˆæœ¬: ${toolkit.version}`;
                }
            },
            {
                id: 3,
                name: "å‡½æ•°æ¥å£æµ‹è¯•",
                test: function() {
                    if (typeof useNoteStrategy !== 'function') {
                        throw new Error('useNoteStrategyå‡½æ•°ä¸å­˜åœ¨');
                    }
                    if (typeof generateNote !== 'function') {
                        throw new Error('generateNoteå‡½æ•°ä¸å­˜åœ¨');
                    }
                    if (typeof quickPrototype !== 'function') {
                        throw new Error('quickPrototypeå‡½æ•°ä¸å­˜åœ¨');
                    }
                    return "âœ… æ‰€æœ‰å‡½æ•°æ¥å£æ­£å¸¸";
                }
            },
            
            // ç­–ç•¥ç”Ÿæˆæµ‹è¯•
            {
                id: 4,
                name: "æ ·ä¾‹åˆ†ææµ‹è¯•",
                test: function() {
                    const sample = `
                    ã€é—®é¢˜ã€‘æµ‹è¯•é—®é¢˜
                    â””â”€ã€ç­”æ¡ˆã€‘æµ‹è¯•ç­”æ¡ˆ
                      â”œâ”€è¦ç‚¹1ï¼šå†…å®¹1
                      â””â”€è¦ç‚¹2ï¼šå†…å®¹2
                    `;
                    
                    const toolkit = new NoteToolkit();
                    const result = toolkit.autoGenerator.analyzeSample(sample);
                    
                    if (!result.patterns || result.patterns.length === 0) {
                        throw new Error('æ ·ä¾‹åˆ†æå¤±è´¥ï¼Œæœªæ£€æµ‹åˆ°æ¨¡å¼');
                    }
                    
                    return `âœ… æ ·ä¾‹åˆ†ææˆåŠŸï¼Œæ£€æµ‹åˆ° ${result.patterns.length} ä¸ªæ¨¡å¼`;
                }
            },
            {
                id: 5,
                name: "ç­–ç•¥ç”Ÿæˆæµ‹è¯•",
                test: function() {
                    const sample = `
                    é—®ï¼šä»€ä¹ˆæ˜¯æµ‹è¯•ï¼Ÿ
                    ç­”ï¼šéªŒè¯åŠŸèƒ½æ­£ç¡®æ€§
                      - å•å…ƒæµ‹è¯•
                      - é›†æˆæµ‹è¯•
                    `;
                    
                    const result = generateStrategyFromSample(sample, 'test_strategy');
                    
                    if (!result.success) {
                        throw new Error(`ç­–ç•¥ç”Ÿæˆå¤±è´¥: ${result.error}`);
                    }
                    
                    return "âœ… ç­–ç•¥ç”ŸæˆæˆåŠŸ";
                }
            },
            {
                id: 6,
                name: "ç­–ç•¥éªŒè¯æµ‹è¯•",
                test: function() {
                    const sample = `
                    [Q] æµ‹è¯•é—®é¢˜
                    [A] æµ‹è¯•ç­”æ¡ˆ
                        â€¢ è¦ç‚¹1
                        â€¢ è¦ç‚¹2
                    `;
                    
                    generateStrategyFromSample(sample, 'validation_test');
                    const result = validateSample(sample, 'validation_test');
                    
                    if (!result.valid) {
                        throw new Error(`ç­–ç•¥éªŒè¯å¤±è´¥: ${result.errors.join(', ')}`);
                    }
                    
                    return "âœ… ç­–ç•¥éªŒè¯é€šè¿‡";
                }
            },
            
            // ç¬”è®°ç”Ÿæˆæµ‹è¯•
            {
                id: 7,
                name: "åŸºç¡€ç¬”è®°ç”Ÿæˆæµ‹è¯•",
                test: function() {
                    useNoteStrategy(`
                    é—®ï¼šæµ‹è¯•
                    ç­”ï¼šæˆåŠŸ
                    `, 'basic_test');
                    
                    const note = generateNote({
                        question: "ä»€ä¹ˆæ˜¯JavaScriptï¼Ÿ",
                        answer: "ç¼–ç¨‹è¯­è¨€"
                    });
                    
                    if (!note || note.length === 0) {
                        throw new Error('ç¬”è®°ç”Ÿæˆå¤±è´¥');
                    }
                    
                    return `âœ… ç¬”è®°ç”ŸæˆæˆåŠŸï¼Œé•¿åº¦: ${note.length} å­—ç¬¦`;
                }
            },
            {
                id: 8,
                name: "å¤æ‚ç»“æ„ç”Ÿæˆæµ‹è¯•",
                test: function() {
                    const complexSample = `
                    ã€ä¸»é¢˜ã€‘ç¼–ç¨‹å­¦ä¹ è·¯å¾„
                    â””â”€ã€æ ¸å¿ƒã€‘åˆ†é˜¶æ®µå­¦ä¹ 
                      â”œâ”€ã€åŸºç¡€é˜¶æ®µã€‘è¯­æ³•æŒæ¡
                      â”‚  â”œâ”€å˜é‡å’Œæ•°æ®ç±»å‹
                      â”‚  â””â”€æ§åˆ¶ç»“æ„
                      â””â”€ã€è¿›é˜¶é˜¶æ®µã€‘é¡¹ç›®å®è·µ
                         â”œâ”€å°é¡¹ç›®ç»ƒä¹ 
                         â””â”€å¼€æºè´¡çŒ®
                    `;
                    
                    useNoteStrategy(complexSample, 'complex_test');
                    
                    const note = generateNote({
                        question: "å¦‚ä½•å­¦ä¹ æ•°æ®ç§‘å­¦ï¼Ÿ",
                        answer: "ç³»ç»Ÿæ€§å­¦ä¹ ",
                        stages: [
                            {
                                name: "æ•°å­¦åŸºç¡€",
                                items: ["çº¿æ€§ä»£æ•°", "ç»Ÿè®¡å­¦"]
                            },
                            {
                                name: "ç¼–ç¨‹æŠ€èƒ½",
                                items: ["Python", "Rè¯­è¨€"]
                            }
                        ]
                    });
                    
                    if (!note.includes('æ•°æ®ç§‘å­¦')) {
                        throw new Error('å¤æ‚ç»“æ„ç”Ÿæˆå¤±è´¥');
                    }
                    
                    return "âœ… å¤æ‚ç»“æ„ç”ŸæˆæˆåŠŸ";
                }
            },
            {
                id: 9,
                name: "ç­–ç•¥åˆ‡æ¢æµ‹è¯•",
                test: function() {
                    // åˆ›å»ºä¸¤ä¸ªä¸åŒçš„ç­–ç•¥
                    useNoteStrategy('é—®ï¼šA\nç­”ï¼šB', 'strategy_a');
                    useNoteStrategy('[Q] A\n[A] B', 'strategy_b');
                    
                    // æµ‹è¯•åˆ‡æ¢
                    switchToStrategy('strategy_a');
                    const noteA = generateNote({ question: "æµ‹è¯•", answer: "Aæ ¼å¼" });
                    
                    switchToStrategy('strategy_b');
                    const noteB = generateNote({ question: "æµ‹è¯•", answer: "Bæ ¼å¼" });
                    
                    if (noteA === noteB) {
                        throw new Error('ç­–ç•¥åˆ‡æ¢æ— æ•ˆï¼Œç”Ÿæˆå†…å®¹ç›¸åŒ');
                    }
                    
                    return "âœ… ç­–ç•¥åˆ‡æ¢æˆåŠŸ";
                }
            },
            
            // é«˜çº§åŠŸèƒ½æµ‹è¯•
            {
                id: 10,
                name: "å¿«é€ŸåŸå‹æµ‹è¯•",
                test: function() {
                    const sample = `
                    ## é—®é¢˜
                    ä»€ä¹ˆæ˜¯åŸå‹ï¼Ÿ
                    
                    ## ç­”æ¡ˆ
                    å¿«é€ŸéªŒè¯æ¦‚å¿µ
                    - ä¼˜ç‚¹ï¼šå¿«é€Ÿ
                    - ç¼ºç‚¹ï¼šç²—ç³™
                    `;
                    
                    const testData = {
                        question: "ä»€ä¹ˆæ˜¯MVPï¼Ÿ",
                        answer: "æœ€å°å¯è¡Œäº§å“",
                        details: ["æ ¸å¿ƒåŠŸèƒ½", "ç”¨æˆ·åé¦ˆ"]
                    };
                    
                    const result = quickPrototype(sample, testData);
                    
                    if (!result.success) {
                        throw new Error(`å¿«é€ŸåŸå‹å¤±è´¥: ${result.error}`);
                    }
                    
                    return `âœ… å¿«é€ŸåŸå‹æˆåŠŸï¼Œç­–ç•¥: ${result.strategyName}`;
                }
            },
            {
                id: 11,
                name: "æ‰¹é‡å¤„ç†æµ‹è¯•",
                test: function() {
                    const samples = [
                        { name: 'æ ¼å¼1', content: 'Q: æµ‹è¯•\nA: æˆåŠŸ' },
                        { name: 'æ ¼å¼2', content: 'é—®ï¼šæµ‹è¯•\nç­”ï¼šæˆåŠŸ' },
                        { name: 'æ ¼å¼3', content: 'ã€é—®ã€‘æµ‹è¯•\nã€ç­”ã€‘æˆåŠŸ' }
                    ];
                    
                    const results = batchProcessSamples(samples);
                    
                    if (results.length !== samples.length) {
                        throw new Error('æ‰¹é‡å¤„ç†æ•°é‡ä¸åŒ¹é…');
                    }
                    
                    const successCount = results.filter(r => r.success).length;
                    return `âœ… æ‰¹é‡å¤„ç†å®Œæˆï¼ŒæˆåŠŸ: ${successCount}/${samples.length}`;
                }
            },
            {
                id: 12,
                name: "ç­–ç•¥å¯¹æ¯”æµ‹è¯•",
                test: function() {
                    // ç¡®ä¿æœ‰å¤šä¸ªç­–ç•¥å¯ä¾›å¯¹æ¯”
                    useNoteStrategy('é—®ï¼šA\nç­”ï¼šB', 'compare_1');
                    useNoteStrategy('[Q] A\n[A] B', 'compare_2');
                    
                    const data = { question: "å¯¹æ¯”æµ‹è¯•", answer: "æˆåŠŸ" };
                    const comparison = compareStrategies(data, ['compare_1', 'compare_2']);
                    
                    if (!comparison || Object.keys(comparison).length < 2) {
                        throw new Error('ç­–ç•¥å¯¹æ¯”å¤±è´¥');
                    }
                    
                    return `âœ… ç­–ç•¥å¯¹æ¯”æˆåŠŸï¼Œå¯¹æ¯”äº† ${Object.keys(comparison).length} ä¸ªç­–ç•¥`;
                }
            },
            
            // å…¼å®¹æ€§æµ‹è¯•
            {
                id: 13,
                name: "ç‰ˆæœ¬æ£€æµ‹æµ‹è¯•",
                test: function() {
                    const toolkit = new NoteToolkit();
                    const adapter = toolkit.pluggableGenerator.adapter;
                    
                    const sampleV1 = 'é—®ï¼šæµ‹è¯•\nç­”ï¼šæˆåŠŸ';
                    const sampleV2 = 'ã€é—®é¢˜ã€‘æµ‹è¯•\nâ””â”€ã€ç­”æ¡ˆã€‘æˆåŠŸ';
                    
                    const versionV1 = adapter.detectVersion(sampleV1);
                    const versionV2 = adapter.detectVersion(sampleV2);
                    
                    if (versionV1 === versionV2) {
                        throw new Error('ç‰ˆæœ¬æ£€æµ‹æ— æ•ˆï¼Œä¸åŒæ ¼å¼è¢«è¯†åˆ«ä¸ºç›¸åŒç‰ˆæœ¬');
                    }
                    
                    return `âœ… ç‰ˆæœ¬æ£€æµ‹æˆåŠŸ: v${versionV1} vs v${versionV2}`;
                }
            },
            {
                id: 14,
                name: "æ ¼å¼è½¬æ¢æµ‹è¯•",
                test: function() {
                    const toolkit = new NoteToolkit();
                    const adapter = toolkit.pluggableGenerator.adapter;
                    
                    const oldFormat = 'é—®ï¼šä»€ä¹ˆæ˜¯è½¬æ¢ï¼Ÿ\nç­”ï¼šæ ¼å¼æ”¹å˜';
                    const converted = adapter.convert(oldFormat, '1.0', '2.0');
                    
                    if (converted === oldFormat) {
                        throw new Error('æ ¼å¼è½¬æ¢å¤±è´¥ï¼Œå†…å®¹æœªæ”¹å˜');
                    }
                    
                    return "âœ… æ ¼å¼è½¬æ¢æˆåŠŸ";
                }
            },
            {
                id: 15,
                name: "é”™è¯¯å¤„ç†æµ‹è¯•",
                test: function() {
                    // æµ‹è¯•æ— æ•ˆæ ·ä¾‹
                    try {
                        useNoteStrategy('', 'invalid_empty');
                        throw new Error('åº”è¯¥æ‹’ç»ç©ºæ ·ä¾‹');
                    } catch (error) {
                        if (error.message === 'åº”è¯¥æ‹’ç»ç©ºæ ·ä¾‹') {
                            throw error;
                        }
                    }
                    
                    // æµ‹è¯•æ— æ•ˆç­–ç•¥åˆ‡æ¢
                    try {
                        switchToStrategy('non_existent_strategy');
                        throw new Error('åº”è¯¥æ‹’ç»ä¸å­˜åœ¨çš„ç­–ç•¥');
                    } catch (error) {
                        if (error.message === 'åº”è¯¥æ‹’ç»ä¸å­˜åœ¨çš„ç­–ç•¥') {
                            throw error;
                        }
                    }
                    
                    return "âœ… é”™è¯¯å¤„ç†æ­£å¸¸";
                }
            }
        ];
        
        // è¿è¡Œå•ä¸ªæµ‹è¯•
        function runTest(testCase) {
            const resultDiv = document.getElementById(`test-${testCase.id}-result`);
            
            try {
                const result = testCase.test();
                resultDiv.className = 'test-result test-pass';
                resultDiv.textContent = result;
                testResults[testCase.id - 1] = true;
            } catch (error) {
                resultDiv.className = 'test-result test-fail';
                resultDiv.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
                testResults[testCase.id - 1] = false;
            }
            
            updateProgress();
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            testResults = new Array(totalTests).fill(null);
            
            testCases.forEach((testCase, index) => {
                setTimeout(() => {
                    runTest(testCase);
                }, index * 100); // å»¶è¿Ÿæ‰§è¡Œï¼Œé¿å…ç•Œé¢å¡é¡¿
            });
        }
        
        // è¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼ˆåªæµ‹è¯•æ ¸å¿ƒåŠŸèƒ½ï¼‰
        function runQuickTests() {
            testResults = new Array(totalTests).fill(null);
            
            // åªè¿è¡Œå‰6ä¸ªæµ‹è¯•
            testCases.slice(0, 6).forEach((testCase, index) => {
                setTimeout(() => {
                    runTest(testCase);
                }, index * 100);
            });
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const completed = testResults.filter(r => r !== null).length;
            const passed = testResults.filter(r => r === true).length;
            
            document.getElementById('progress-text').textContent = 
                `${completed}/${totalTests} (é€šè¿‡: ${passed})`;
            
            const percentage = (completed / totalTests) * 100;
            document.getElementById('progress-fill').style.width = percentage + '%';
            
            // å¦‚æœå…¨éƒ¨å®Œæˆï¼Œæ˜¾ç¤ºæ€»ç»“
            if (completed === totalTests) {
                setTimeout(showSummary, 500);
            }
        }
        
        // æ˜¾ç¤ºæµ‹è¯•æ€»ç»“
        function showSummary() {
            const passed = testResults.filter(r => r === true).length;
            const failed = testResults.filter(r => r === false).length;
            
            const summaryDiv = document.querySelector('.test-summary');
            const originalContent = summaryDiv.innerHTML;
            
            summaryDiv.innerHTML = `
                <h2>ğŸ¯ æµ‹è¯•å®Œæˆï¼</h2>
                <div style="font-size: 1.5em; margin: 20px 0;">
                    <span style="color: #27ae60;">âœ… é€šè¿‡: ${passed}</span> |
                    <span style="color: #e74c3c;">âŒ å¤±è´¥: ${failed}</span>
                </div>
                <div style="margin: 20px 0;">
                    æµ‹è¯•è¦†ç›–ç‡: ${((passed / totalTests) * 100).toFixed(1)}%
                </div>
                ${originalContent}
            `;
        }
        
        // æ¸…ç©ºç»“æœ
        function clearResults() {
            testResults = [];
            for (let i = 1; i <= totalTests; i++) {
                const resultDiv = document.getElementById(`test-${i}-result`);
                resultDiv.className = 'test-result';
                resultDiv.textContent = '';
            }
            
            document.getElementById('progress-text').textContent = '0/0';
            document.getElementById('progress-fill').style.width = '0%';
            
            // æ¢å¤åŸå§‹æ‘˜è¦å†…å®¹
            location.reload();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æ­£ç¡®åŠ è½½
            if (typeof NoteToolkit === 'undefined') {
                document.querySelector('.test-summary').innerHTML = 
                    '<div style="color: #e74c3c;">âŒ ç³»ç»Ÿæœªæ­£ç¡®åŠ è½½ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„</div>';
            } else {
                document.querySelector('.test-summary').innerHTML += 
                    '<div style="color: #27ae60; margin-top: 10px;">âœ… ç³»ç»ŸåŠ è½½æ­£å¸¸ï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•</div>';
            }
        });
    </script>
</body>
</html> 