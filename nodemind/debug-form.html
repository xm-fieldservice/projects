<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•è¡¨å•æ˜¾ç¤ºé—®é¢˜</title>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsmind@0.8.7/style/jsmind.css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jsmind@0.8.7/es6/jsmind.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jsmind@0.8.7/es6/jsmind.draggable-node.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            min-height: 100vh; /* ç¡®ä¿é¡µé¢é«˜åº¦ */
        }
        
        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            position: relative;
            z-index: 1000; /* ç¡®ä¿æ˜¾ç¤ºåœ¨æœ€å‰é¢ */
        }
        
        .container {
            display: flex;
            height: 600px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .mindmap-section {
            flex: 1;
            border-right: 2px solid #ddd;
        }
        
        #jsmind_container {
            width: 100%;
            height: 100%;
        }
        
        .details-section {
            width: 400px;
            background: #f9f9f9;
            padding: 20px;
            overflow-y: auto;
            border: 2px solid red; /* çº¢è‰²è¾¹æ¡†ä¾¿äºè°ƒè¯• */
        }
        
        .node-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid green; /* ç»¿è‰²è¾¹æ¡†ä¾¿äºè°ƒè¯• */
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .form-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .form-textarea {
            min-height: 60px;
            resize: vertical;
        }
        
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        #debugLog {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            position: relative;
            z-index: 1000;
            display: block !important; /* å¼ºåˆ¶æ˜¾ç¤º */
            width: 100%;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="debug-info">
        <h3>ğŸ” è°ƒè¯•ä¿¡æ¯</h3>
        <p>çŠ¶æ€: <span id="status">æ­£åœ¨åˆå§‹åŒ–...</span></p>
        <p>å½“å‰é€‰ä¸­èŠ‚ç‚¹: <span id="currentNode">æ— </span></p>
        <p>è¯¦æƒ…é¡µçŠ¶æ€: <span id="detailsStatus">æœªæ˜¾ç¤º</span></p>
        <button class="test-btn" onclick="testShowForm()">å¼ºåˆ¶æ˜¾ç¤ºè¡¨å•</button>
        <button class="test-btn" onclick="testSelectNode()">æµ‹è¯•é€‰ä¸­èŠ‚ç‚¹</button>
        <button class="test-btn" onclick="testSelectChild()">æµ‹è¯•å­èŠ‚ç‚¹</button>
        <button class="test-btn" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div class="container">
        <div class="mindmap-section">
            <div id="jsmind_container"></div>
        </div>
        
        <div class="details-section">
            <h3>ğŸ“‹ èŠ‚ç‚¹è¯¦æƒ…é¡µ</h3>
            <div id="placeholder" style="text-align: center; color: #666; margin: 20px 0;">
                è¯·ç‚¹å‡»æ€ç»´å¯¼å›¾ä¸­çš„ä»»æ„èŠ‚ç‚¹<br>æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
            </div>
            <div id="nodeDetails" style="display: none; border: 2px solid blue;"></div>
        </div>
    </div>
    
    <div id="debugLog"></div>

    <script type="text/javascript">
        var debugLog = document.getElementById('debugLog');
        var status = document.getElementById('status');
        var currentNodeSpan = document.getElementById('currentNode');
        var detailsStatusSpan = document.getElementById('detailsStatus');
        
        // åŸºç¡€æµ‹è¯• - ç¡®è®¤JavaScriptæ­£åœ¨è¿è¡Œ
        console.log('ğŸš€ JavaScriptå¼€å§‹æ‰§è¡Œ');
        // alert('ğŸš€ JavaScriptæ­£åœ¨è¿è¡Œ!'); // å¼ºåˆ¶å¼¹çª—ç¡®è®¤
        
        // ç«‹å³å‘é¡µé¢å†™å…¥æµ‹è¯•å†…å®¹
        setTimeout(function() {
            var testDiv = document.getElementById('debugLog');
            if (testDiv) {
                testDiv.innerHTML = 'ğŸš€ JavaScriptæ­£åœ¨è¿è¡Œï¼Œæ—¥å¿—ç³»ç»Ÿå·²å¯åŠ¨<br>';
                testDiv.style.display = 'block';
                testDiv.style.background = 'yellow';
                testDiv.style.color = 'black';
                console.log('âœ… æ—¥å¿—åŒºåŸŸå·²æ‰¾åˆ°å¹¶è®¾ç½®');
            } else {
                console.log('âŒ æ‰¾ä¸åˆ°debugLogå…ƒç´ ');
                // å¼ºåˆ¶åˆ›å»ºæ—¥å¿—åŒºåŸŸ
                var newLog = document.createElement('div');
                newLog.id = 'emergency-log';
                newLog.style.cssText = 'position:fixed; top:10px; right:10px; width:300px; height:200px; background:yellow; border:2px solid red; padding:10px; font-size:12px; z-index:9999; overflow-y:auto;';
                newLog.innerHTML = 'ğŸš¨ ç´§æ€¥æ—¥å¿—åŒºåŸŸ<br>JavaScriptæ­£åœ¨è¿è¡Œ<br>';
                document.body.appendChild(newLog);
            }
        }, 100);
        
        function log(message) {
            console.log(message);
            var time = new Date().toLocaleTimeString();
            if (debugLog) {
                debugLog.innerHTML += `[${time}] ${message}<br>`;
                debugLog.scrollTop = debugLog.scrollHeight;
            }
        }
        
        function clearLog() {
            debugLog.innerHTML = '';
        }
        
        function updateStatus(msg) {
            status.textContent = msg;
            log('çŠ¶æ€æ›´æ–°: ' + msg);
        }
        
        log('é¡µé¢å¼€å§‹åŠ è½½...');
        updateStatus('æ­£åœ¨åˆå§‹åŒ–jsMind...');
        
        // èŠ‚ç‚¹æ•°æ®åº“
        var nodeDatabase = {
            "root": {
                id: "root",
                title: "æµ‹è¯•æ ¹èŠ‚ç‚¹",
                content: "è¿™æ˜¯æ ¹èŠ‚ç‚¹çš„å†…å®¹",
                relations: { parent: null, children: ["test1", "test2"] },
                tags: { categories: ["æµ‹è¯•"], technical: ["JavaScript"], status: ["æ´»è·ƒ"] },
                time: "åˆ›å»ºæ—¶é—´: 2024-01-20 | ä¿®æ”¹æ—¶é—´: 2024-01-20",
                author: "æµ‹è¯•ç”¨æˆ·"
            },
            "test1": {
                id: "test1", 
                title: "æµ‹è¯•å­èŠ‚ç‚¹1",
                content: "è¿™æ˜¯ç¬¬ä¸€ä¸ªæµ‹è¯•å­èŠ‚ç‚¹",
                relations: { parent: "root", children: [] },
                tags: { categories: ["å­èŠ‚ç‚¹"], technical: ["Test"], status: ["å®Œæˆ"] },
                time: "åˆ›å»ºæ—¶é—´: 2024-01-20",
                author: "æµ‹è¯•ç”¨æˆ·"
            },
            "test2": {
                id: "test2", 
                title: "æµ‹è¯•å­èŠ‚ç‚¹2",
                content: "è¿™æ˜¯ç¬¬äºŒä¸ªæµ‹è¯•å­èŠ‚ç‚¹",
                relations: { parent: "root", children: [] },
                tags: { categories: ["å­èŠ‚ç‚¹"], technical: ["Test"], status: ["å®Œæˆ"] },
                time: "åˆ›å»ºæ—¶é—´: 2024-01-20",
                author: "æµ‹è¯•ç”¨æˆ·"
            }
        };

        // æ€ç»´å¯¼å›¾æ•°æ®
        var mindData = {
            meta: { name: "æµ‹è¯•", author: "Test", version: "1.0.0" },
            format: "node_tree",
            data: {
                id: "root",
                topic: "ğŸ§  æµ‹è¯•æ ¹èŠ‚ç‚¹",
                children: [
                    { id: "test1", topic: "æµ‹è¯•å­èŠ‚ç‚¹1", direction: "right" },
                    { id: "test2", topic: "æµ‹è¯•å­èŠ‚ç‚¹2", direction: "right" }
                ]
            }
        };

        // é…ç½®é€‰é¡¹
        var options = {
            container: 'jsmind_container',
            editable: true,
            theme: 'primary'
        };

        log('å¼€å§‹åˆ›å»ºjsMindå®ä¾‹...');
        
        // åˆ›å»ºjsMindå®ä¾‹
        var jm = new jsMind(options);
        log('jsMindå®ä¾‹åˆ›å»ºæˆåŠŸ: ' + (jm ? 'YES' : 'NO'));
        
        jm.show(mindData);
        log('æ€ç»´å¯¼å›¾æ•°æ®åŠ è½½å®Œæˆ');
        
        jm.enable_draggable_node();
        log('æ‹–æ‹½åŠŸèƒ½å·²å¯ç”¨');
        
        log('jsMindå®ä¾‹åˆ›å»ºå®Œæˆ');
        updateStatus('jsMindå·²åˆå§‹åŒ–');

        // æ˜¾ç¤ºèŠ‚ç‚¹è¯¦æƒ…å‡½æ•°
        function showNodeDetails(nodeId) {
            log(`ğŸ¯ showNodeDetailsè¢«è°ƒç”¨ï¼ŒnodeId: ${nodeId}`);
            
            var nodeInfo = nodeDatabase[nodeId];
            var placeholder = document.getElementById('placeholder');
            var detailsDiv = document.getElementById('nodeDetails');
            
            log(`æ‰¾åˆ°çš„èŠ‚ç‚¹ä¿¡æ¯: ${nodeInfo ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
            
            if (!nodeInfo) {
                log('âŒ æ²¡æœ‰æ‰¾åˆ°èŠ‚ç‚¹ä¿¡æ¯ï¼Œåˆ›å»ºé»˜è®¤ä¿¡æ¯');
                var node = jm.get_node(nodeId);
                nodeInfo = {
                    id: nodeId,
                    title: node ? node.topic : 'æœªçŸ¥èŠ‚ç‚¹',
                    content: "æš‚æ— è¯¦ç»†å†…å®¹",
                    relations: { parent: null, children: [] },
                    tags: { categories: [], technical: [], status: [] },
                    time: "åˆ›å»ºæ—¶é—´: " + new Date().toLocaleDateString(),
                    author: "ç”¨æˆ·"
                };
                nodeDatabase[nodeId] = nodeInfo;
                log('âœ… é»˜è®¤èŠ‚ç‚¹ä¿¡æ¯å·²åˆ›å»º');
            }
            
            try {
                log('å¼€å§‹æ›´æ–°UI...');
                placeholder.style.display = 'none';
                detailsDiv.style.display = 'block';
                
                var formHTML = `
                    <div class="node-form">
                        <h4 style="color: red;">âœ… è¡¨å•å·²æˆåŠŸåŠ è½½ï¼</h4>
                        <p style="background: #e7f3ff; padding: 5px; border-radius: 3px;">
                            ğŸ¯ å½“å‰èŠ‚ç‚¹: <strong>${nodeInfo.id}</strong>
                        </p>
                        
                        <div class="form-group">
                            <label class="form-label">ğŸ·ï¸ èŠ‚ç‚¹ID</label>
                            <input type="text" class="form-input" value="${nodeInfo.id}" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ğŸ“ èŠ‚ç‚¹æ ‡é¢˜</label>
                            <input type="text" class="form-input" value="${nodeInfo.title}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ğŸ“„ èŠ‚ç‚¹å†…å®¹</label>
                            <textarea class="form-input form-textarea">${nodeInfo.content}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ğŸ‘¤ ä½œè€…</label>
                            <input type="text" class="form-input" value="${nodeInfo.author}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">â° æ—¶é—´</label>
                            <input type="text" class="form-input" value="${nodeInfo.time}" readonly>
                        </div>
                        
                        <div style="background: #d4edda; padding: 10px; border-radius: 4px; margin-top: 10px;">
                            ğŸ‰ è¡¨å•æ˜¾ç¤ºæˆåŠŸï¼<br>
                            æ—¶é—´: ${new Date().toLocaleTimeString()}<br>
                            èŠ‚ç‚¹: ${nodeInfo.title}
                        </div>
                    </div>
                `;
                
                detailsDiv.innerHTML = formHTML;
                currentNodeSpan.textContent = nodeInfo.title;
                detailsStatusSpan.textContent = `å·²æ˜¾ç¤º: ${nodeInfo.id}`;
                updateStatus(`âœ… è¡¨å•æ˜¾ç¤ºæˆåŠŸ: ${nodeInfo.title}`);
                
            } catch (error) {
                log('âŒ é”™è¯¯: ' + error.message);
                updateStatus('è¡¨å•æ˜¾ç¤ºå¤±è´¥: ' + error.message);
            }
        }

        // æµ‹è¯•å‡½æ•°
        function testShowForm() {
            log('ğŸ§ª å¼ºåˆ¶æµ‹è¯•æ˜¾ç¤ºè¡¨å•');
            showNodeDetails('root');
        }
        
        function testSelectNode() {
            log('ğŸ§ª æµ‹è¯•é€‰ä¸­èŠ‚ç‚¹');
            var rootNode = jm.get_root();
            log('æ ¹èŠ‚ç‚¹: ' + (rootNode ? rootNode.id : 'æ— '));
            if (rootNode) {
                jm.select_node(rootNode.id);
                showNodeDetails(rootNode.id);
            }
        }
        
        function testSelectChild() {
            log('ğŸ§ª æµ‹è¯•é€‰ä¸­å­èŠ‚ç‚¹');
            var test1Node = jm.get_node('test1');
            var test2Node = jm.get_node('test2');
            
            log('test1èŠ‚ç‚¹: ' + (test1Node ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'));
            log('test2èŠ‚ç‚¹: ' + (test2Node ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'));
            
            if (test1Node) {
                log('é€‰ä¸­test1èŠ‚ç‚¹...');
                jm.select_node('test1');
                showNodeDetails('test1');
            } else if (test2Node) {
                log('é€‰ä¸­test2èŠ‚ç‚¹...');
                jm.select_node('test2');
                showNodeDetails('test2');
            } else {
                log('âŒ æ²¡æœ‰æ‰¾åˆ°å­èŠ‚ç‚¹');
            }
        }

        // å¤šé‡äº‹ä»¶ç›‘å¬ç­–ç•¥
        setTimeout(function() {
            log('ğŸ”§ å¼€å§‹ç»‘å®šäº‹ä»¶ç›‘å¬å™¨...');
            
            // åŸºç¡€æµ‹è¯•: ç¡®è®¤äº‹ä»¶ç›‘å¬å™¨æ˜¯å¦èƒ½å·¥ä½œ
            log('jsMindå®ä¾‹çŠ¶æ€: ' + (jm ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'));
            log('add_event_listeneræ–¹æ³•: ' + (typeof jm.add_event_listener));
            
            // è°ƒè¯•: ç›‘å¬æ‰€æœ‰jsMindäº‹ä»¶
            try {
                jm.add_event_listener(function(type, data) {
                    // è®°å½•æ‰€æœ‰äº‹ä»¶ï¼Œä¸ç®¡ä»€ä¹ˆç±»å‹
                    log(`ğŸ¯ jsMindäº‹ä»¶: "${type}"`);
                    log(`ğŸ¯ äº‹ä»¶æ•°æ®: ${JSON.stringify(data)}`);
                    
                    // å¦‚æœæ˜¯é€‰ä¸­ç›¸å…³äº‹ä»¶ï¼Œç«‹å³è°ƒç”¨æ›´æ–°
                    if (type === 'select_node' || type === 'click_node' || type.includes('select') || type.includes('click')) {
                        if (data && data.node) {
                            log(`âœ… æ£€æµ‹åˆ°é€‰ä¸­äº‹ä»¶ï¼Œæ›´æ–°è¯¦æƒ…é¡µ: ${data.node.id}`);
                            showNodeDetails(data.node.id);
                        }
                    }
                });
                log('âœ… jsMindäº‹ä»¶ç›‘å¬å™¨ç»‘å®šæˆåŠŸ');
                
                // æµ‹è¯•äº‹ä»¶ç›‘å¬å™¨æ˜¯å¦å·¥ä½œ - ç¨‹åºåŒ–è§¦å‘
                setTimeout(function() {
                    log('ğŸ§ª æµ‹è¯•äº‹ä»¶ç›‘å¬å™¨ - ç¨‹åºåŒ–é€‰ä¸­test1');
                    jm.select_node('test1');
                }, 2000);
                
            } catch (error) {
                log('âŒ jsMindäº‹ä»¶ç›‘å¬å™¨ç»‘å®šå¤±è´¥: ' + error.message);
            }
            
            // å¤‡ç”¨æ–¹æ¡ˆ: ç›´æ¥ç›‘å¬DOMä¸Šçš„æ‰€æœ‰ç‚¹å‡»äº‹ä»¶
            document.addEventListener('click', function(e) {
                log(`ğŸ–±ï¸ å…¨å±€ç‚¹å‡»äº‹ä»¶: ${e.target.tagName} - ${e.target.className}`);
                
                // æ£€æŸ¥æ˜¯å¦åœ¨æ€ç»´å¯¼å›¾åŒºåŸŸ
                var mindmapContainer = document.getElementById('jsmind_container');
                if (mindmapContainer && mindmapContainer.contains(e.target)) {
                    log('ğŸ¯ ç‚¹å‡»äº†æ€ç»´å¯¼å›¾åŒºåŸŸ');
                    
                    // å»¶è¿Ÿæ£€æŸ¥å½“å‰é€‰ä¸­çš„èŠ‚ç‚¹
                    setTimeout(function() {
                        var selected = jm.get_selected_node();
                        if (selected) {
                            log(`âœ… DOMç‚¹å‡»åæ£€æµ‹åˆ°é€‰ä¸­èŠ‚ç‚¹: ${selected.id}`);
                            showNodeDetails(selected.id);
                        } else {
                            log('âŒ DOMç‚¹å‡»åæ²¡æœ‰é€‰ä¸­èŠ‚ç‚¹');
                        }
                    }, 100);
                }
            });
            log('âœ… å…¨å±€DOMç‚¹å‡»ç›‘å¬å™¨å·²ç»‘å®š');
            
        }, 1000);

        // é¡µé¢åŠ è½½å®Œæˆè‡ªåŠ¨æµ‹è¯•
        window.addEventListener('load', function() {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            
            setTimeout(function() {
                log('è‡ªåŠ¨æ‰§è¡Œæµ‹è¯•...');
                testShowForm();
            }, 2000);
        });
        
        log('è„šæœ¬åŠ è½½å®Œæˆ');
    </script>
</body>
</html> 