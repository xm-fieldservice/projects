<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NodeMindæ–‡æ¡£æ ¼å¼åŒ–å·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .input-section, .output-section {
            margin-bottom: 30px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #34495e;
        }
        textarea {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
        }
        button {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #2980b9;
        }
        .success {
            background: #27ae60;
        }
        .success:hover {
            background: #229954;
        }
        .stats {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .stats h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ NodeMindæ–‡æ¡£æ ¼å¼åŒ–å·¥å…·</h1>
        
        <div class="input-section">
            <label for="inputText">ğŸ“ è¾“å…¥åŸå§‹MDæ–‡æ¡£å†…å®¹ï¼š</label>
            <textarea id="inputText" placeholder="è¯·ç²˜è´´nodemind_jsmind.mdçš„å†…å®¹..."></textarea>
            <button onclick="loadSampleData()">ğŸ“‹ åŠ è½½ç¤ºä¾‹æ•°æ®</button>
            <button onclick="formatDocument()">ğŸ”„ å¼€å§‹æ ¼å¼åŒ–</button>
        </div>
        
        <div class="stats" id="stats" style="display: none;">
            <h3>ğŸ“Š å¤„ç†ç»Ÿè®¡</h3>
            <div id="statsContent"></div>
        </div>
        
        <div class="output-section">
            <label for="outputText">âœ… æ ¼å¼åŒ–åçš„æ–‡æ¡£ï¼š</label>
            <textarea id="outputText" placeholder="æ ¼å¼åŒ–ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
            <button onclick="copyOutput()" class="success">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
            <button onclick="downloadOutput()" class="success">ğŸ’¾ ä¸‹è½½æ–‡ä»¶</button>
        </div>
        
        <div>
            <label>ğŸ“‹ å¤„ç†æ—¥å¿—ï¼š</label>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script>
        // çŠ¶æ€æ˜ å°„è¡¨
        const statusMapping = {
            'å±•å¼€': 'active',
            'æŠ˜å ': 'collapsed',
            'å®Œæˆ': 'done',
            'è¿›è¡Œä¸­': 'in-progress',
            'å¾…å¤„ç†': 'pending',
            'å·²å®Œæˆ': 'done'
        };

        // ä¼˜å…ˆçº§æ¨æ–­è§„åˆ™
        const priorityRules = {
            high: ['ç´§æ€¥', 'é‡è¦', 'å¿…é¡»', 'ç«‹åˆ»', 'é©¬ä¸Š', 'æ ¸å¿ƒ', 'å…³é”®', 'ä¸­å¿ƒ', 'é‡æ„', 'ä¿®å¤', 'PROJECT'],
            medium: ['éœ€è¦', 'åº”è¯¥', 'è€ƒè™‘', 'å»ºè®®', 'ä¼˜åŒ–', 'æ”¹è¿›', 'å¢åŠ ', 'å®ç°', 'è¯¦æƒ…', 'åŠŸèƒ½'],
            low: ['å¯ä»¥', 'æˆ–è®¸', 'å°†æ¥', 'æœªæ¥', 'å¤‡ç”¨', 'ä¸´æ—¶', 'æµ‹è¯•', 'ç¬”è®°', 'ç»éªŒ']
        };

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function inferPriority(title, content = '') {
            const text = (title + ' ' + content).toLowerCase();
            
            for (const [priority, keywords] of Object.entries(priorityRules)) {
                if (keywords.some(keyword => text.includes(keyword))) {
                    return priority;
                }
            }
            
            return 'medium'; // é»˜è®¤ä¼˜å…ˆçº§
        }

        function generateTimestamp(baseTime, offset = 0) {
            const date = new Date(baseTime.getTime() + offset);
            return date.toISOString();
        }

        function formatDocument() {
            log('ğŸ”„ å¼€å§‹æ ¼å¼åŒ–æ–‡æ¡£...');
            
            const inputText = document.getElementById('inputText').value;
            if (!inputText.trim()) {
                alert('è¯·å…ˆè¾“å…¥MDæ–‡æ¡£å†…å®¹ï¼');
                return;
            }

            const lines = inputText.split('\n');
            const processedLines = [];
            
            let nodeCount = 0;
            let statusConversions = 0;
            let baseTime = new Date('2025-06-15T14:00:00.000Z');
            
            log(`ğŸ“– å¼€å§‹å¤„ç†ï¼Œæ€»è¡Œæ•°: ${lines.length}`);

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                // æ£€æµ‹èŠ‚ç‚¹æ ‡é¢˜
                const titleMatch = line.match(/^(#{2,6})\s+(.+)$/);
                if (titleMatch) {
                    nodeCount++;
                    const title = titleMatch[2].trim();
                    const priority = inferPriority(title);
                    
                    log(`ğŸ“ å¤„ç†èŠ‚ç‚¹ ${nodeCount}: ${title} (ä¼˜å…ˆçº§: ${priority})`);
                    
                    processedLines.push(line); // ä¿æŒæ ‡é¢˜ä¸å˜
                    
                    // æŸ¥æ‰¾åç»­çš„èŠ‚ç‚¹ä¿¡æ¯è¡Œ
                    let j = i + 1;
                    let addedTimestamp = false;
                    
                    while (j < lines.length) {
                        const nextLine = lines[j];
                        
                        // é‡åˆ°ç©ºè¡Œ
                        if (!nextLine.trim()) {
                            processedLines.push(nextLine);
                            j++;
                            continue;
                        }
                        
                        // é‡åˆ°ä¸‹ä¸€ä¸ªæ ‡é¢˜
                        if (nextLine.match(/^#{2,6}\s+/)) {
                            break;
                        }
                        
                        // å¤„ç†èŠ‚ç‚¹ä¿¡æ¯è¡Œ
                        if (nextLine.includes('**')) {
                            // è½¬æ¢å±•å¼€çŠ¶æ€ä¸ºçŠ¶æ€
                            if (nextLine.includes('**å±•å¼€çŠ¶æ€**:')) {
                                const statusMatch = nextLine.match(/\*\*å±•å¼€çŠ¶æ€\*\*:\s*(.+)/);
                                if (statusMatch) {
                                    const originalStatus = statusMatch[1].trim();
                                    const mappedStatus = statusMapping[originalStatus] || 'pending';
                                    const newLine = nextLine.replace('**å±•å¼€çŠ¶æ€**:', '**çŠ¶æ€**:').replace(originalStatus, mappedStatus);
                                    processedLines.push(newLine);
                                    statusConversions++;
                                    
                                    // æ·»åŠ æ—¶é—´æˆ³å’Œä¼˜å…ˆçº§ï¼ˆåªæ·»åŠ ä¸€æ¬¡ï¼‰
                                    if (!addedTimestamp) {
                                        const createdTime = generateTimestamp(baseTime, nodeCount * 300000); // æ¯ä¸ªèŠ‚ç‚¹é—´éš”5åˆ†é’Ÿ
                                        const modifiedTime = generateTimestamp(new Date(), nodeCount * 1000); // ä¿®æ”¹æ—¶é—´ç¨æœ‰å·®å¼‚
                                        
                                        processedLines.push(`**åˆ›å»ºæ—¶é—´**: ${createdTime}  `);
                                        processedLines.push(`**ä¿®æ”¹æ—¶é—´**: ${modifiedTime}  `);
                                        processedLines.push(`**ä¼˜å…ˆçº§**: ${priority}  `);
                                        addedTimestamp = true;
                                    }
                                } else {
                                    processedLines.push(nextLine);
                                }
                            } else {
                                processedLines.push(nextLine);
                            }
                        } else {
                            processedLines.push(nextLine);
                        }
                        
                        j++;
                    }
                    
                    i = j - 1; // è°ƒæ•´ä¸»å¾ªç¯çš„ç´¢å¼•
                } else {
                    processedLines.push(line);
                }
            }

            const formattedContent = processedLines.join('\n');
            document.getElementById('outputText').value = formattedContent;
            
            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            const statsElement = document.getElementById('stats');
            const statsContent = document.getElementById('statsContent');
            
            statsContent.innerHTML = `
                <p><strong>å¤„ç†èŠ‚ç‚¹æ•°:</strong> ${nodeCount}</p>
                <p><strong>çŠ¶æ€è½¬æ¢æ•°:</strong> ${statusConversions}</p>
                <p><strong>è¾“å…¥è¡Œæ•°:</strong> ${lines.length}</p>
                <p><strong>è¾“å‡ºè¡Œæ•°:</strong> ${processedLines.length}</p>
                <p><strong>æ–°å¢è¡Œæ•°:</strong> ${processedLines.length - lines.length}</p>
            `;
            
            statsElement.style.display = 'block';
            
            log(`âœ… æ ¼å¼åŒ–å®Œæˆï¼å¤„ç†äº† ${nodeCount} ä¸ªèŠ‚ç‚¹ï¼Œè½¬æ¢äº† ${statusConversions} ä¸ªçŠ¶æ€`);
        }

        function copyOutput() {
            const outputText = document.getElementById('outputText');
            outputText.select();
            document.execCommand('copy');
            alert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            log('ğŸ“‹ å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }

        function downloadOutput() {
            const content = document.getElementById('outputText').value;
            if (!content.trim()) {
                alert('æ²¡æœ‰å†…å®¹å¯ä¸‹è½½ï¼');
                return;
            }
            
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'nodemind_jsmind_formatted.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('ğŸ’¾ æ–‡ä»¶å·²ä¸‹è½½: nodemind_jsmind_formatted.md');
        }

        function loadSampleData() {
            // è¿™é‡Œå¯ä»¥åŠ è½½ç¤ºä¾‹æ•°æ®
            const sampleText = `#### ç¤ºä¾‹èŠ‚ç‚¹

**èŠ‚ç‚¹ID**: \`sample_123\`  
**èŠ‚ç‚¹è·¯å¾„**: ç¤ºä¾‹è·¯å¾„  
**ä½œè€…**: ç”¨æˆ·  
**å±•å¼€çŠ¶æ€**: å±•å¼€  

**å­èŠ‚ç‚¹ (2ä¸ª)**:

##### å­èŠ‚ç‚¹1

**èŠ‚ç‚¹ID**: \`child_1\`  
**èŠ‚ç‚¹è·¯å¾„**: ç¤ºä¾‹è·¯å¾„ > å­èŠ‚ç‚¹1  
**ä½œè€…**: ç”¨æˆ·  
**å±•å¼€çŠ¶æ€**: æŠ˜å   `;

            document.getElementById('inputText').value = sampleText;
            log('ğŸ“‹ å·²åŠ è½½ç¤ºä¾‹æ•°æ®');
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ NodeMindæ–‡æ¡£æ ¼å¼åŒ–å·¥å…·å·²å°±ç»ª');
            log('ğŸ“– è¯·ç²˜è´´æ‚¨çš„MDæ–‡æ¡£å†…å®¹ï¼Œç„¶åç‚¹å‡»"å¼€å§‹æ ¼å¼åŒ–"');
        });
    </script>
</body>
</html> 