<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·Ÿè¿›æ ‡ç­¾åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        .mock-node {
            display: inline-block;
            padding: 10px 15px;
            margin: 10px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            text-align: center;
        }
        .mock-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .mock-node.selected {
            border-color: #007bff;
            box-shadow: 0 0 10px rgba(0,123,255,0.3);
        }
        .tag-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .tag-group {
            margin-bottom: 15px;
        }
        .tag-group-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #495057;
        }
        .tag-item {
            display: inline-block;
            padding: 6px 12px;
            margin: 4px;
            background: #e9ecef;
            border: 1px solid #ddd;
            border-radius: 16px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }
        .tag-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .tag-item.selected {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        .tag-blue {
            background: #e6f4ff;
            color: #1677ff;
        }
        .tag-blue:hover {
            background: #91caff;
        }
        .tag-blue.selected {
            background: #1677ff;
            color: #ffffff;
        }
        .follow-up-style {
            background-color: #e3f2fd !important;
            border-color: #2196f3 !important;
            color: #1565c0 !important;
        }
        .status-display {
            margin-top: 15px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            font-size: 14px;
        }
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-test {
            background: #28a745;
            color: white;
        }
        .btn-reset {
            background: #6c757d;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ·ï¸ NodeMind è·Ÿè¿›æ ‡ç­¾åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <div class="test-title">ğŸ“‹ åŠŸèƒ½è¯´æ˜</div>
            <p>å½“æŸä¸ªèŠ‚ç‚¹è·å¾—ç„¦ç‚¹åï¼Œç‚¹å‡»"è·Ÿè¿›"æ ‡ç­¾ï¼Œè¯¥èŠ‚ç‚¹çš„åº•è‰²ä¼šæŸ“æˆæµ…è“è‰² (#e3f2fd)ã€‚</p>
            <p>å–æ¶ˆ"è·Ÿè¿›"æ ‡ç­¾æ—¶ï¼ŒèŠ‚ç‚¹èƒŒæ™¯è‰²ä¼šæ¢å¤é»˜è®¤çŠ¶æ€ã€‚</p>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ¯ æµ‹è¯•èŠ‚ç‚¹</div>
            <div class="mock-node" id="node1" onclick="selectNode('node1')">
                ğŸ“ æµ‹è¯•èŠ‚ç‚¹ 1
            </div>
            <div class="mock-node" id="node2" onclick="selectNode('node2')">
                ğŸ’¡ æµ‹è¯•èŠ‚ç‚¹ 2
            </div>
            <div class="mock-node" id="node3" onclick="selectNode('node3')">
                ğŸš€ æµ‹è¯•èŠ‚ç‚¹ 3
            </div>
            
            <div class="status-display" id="nodeStatus">
                è¯·ç‚¹å‡»ä¸Šæ–¹èŠ‚ç‚¹è¿›è¡Œé€‰æ‹©
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ·ï¸ æ ‡ç­¾é¢æ¿</div>
            <div id="tagPanel" style="display: none;">
                <div class="tag-section">
                    <div class="tag-group">
                        <div class="tag-group-title">ç¬”è®°</div>
                        <div class="tag-group-items">
                            <div class="tag-item tag-blue" data-tag="è·Ÿè¿›" data-group="ç¬”è®°" onclick="toggleTag(this)">è·Ÿè¿›</div>
                            <div class="tag-item tag-blue" data-tag="è®®é¢˜" data-group="ç¬”è®°" onclick="toggleTag(this)">è®®é¢˜</div>
                        </div>
                    </div>
                    
                    <div class="tag-group">
                        <div class="tag-group-title">å¸¸è§„</div>
                        <div class="tag-group-items">
                            <div class="tag-item" data-tag="é¡¹ç›®" data-group="å¸¸è§„" onclick="toggleTag(this)">é¡¹ç›®</div>
                            <div class="tag-item" data-tag="å®Œæˆ" data-group="å¸¸è§„" onclick="toggleTag(this)">å®Œæˆ</div>
                            <div class="tag-item" data-tag="è¿›è¡Œä¸­" data-group="å¸¸è§„" onclick="toggleTag(this)">è¿›è¡Œä¸­</div>
                        </div>
                    </div>
                </div>
                
                <div class="status-display" id="tagStatus">
                    æœªé€‰æ‹©ä»»ä½•æ ‡ç­¾
                </div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ§ª æµ‹è¯•æ§åˆ¶</div>
            <button class="btn btn-test" onclick="runAutoTest()">ğŸš€ è‡ªåŠ¨æµ‹è¯•</button>
            <button class="btn btn-reset" onclick="resetTest()">ğŸ”„ é‡ç½®æµ‹è¯•</button>
            <button class="btn btn-test" onclick="showTestResults()">ğŸ“Š æŸ¥çœ‹ç»“æœ</button>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ•°æ®
        let selectedNodeId = null;
        let nodeData = {
            'node1': { tags: { categories: [], status: [], technical: [] } },
            'node2': { tags: { categories: [], status: [], technical: [] } },
            'node3': { tags: { categories: [], status: [], technical: [] } }
        };

        // é€‰æ‹©èŠ‚ç‚¹
        function selectNode(nodeId) {
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.mock-node').forEach(node => {
                node.classList.remove('selected');
            });
            
            // é€‰æ‹©æ–°èŠ‚ç‚¹
            const nodeElement = document.getElementById(nodeId);
            nodeElement.classList.add('selected');
            selectedNodeId = nodeId;
            
            // æ˜¾ç¤ºæ ‡ç­¾é¢æ¿
            document.getElementById('tagPanel').style.display = 'block';
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            document.getElementById('nodeStatus').innerHTML = 
                `âœ… å·²é€‰æ‹©èŠ‚ç‚¹: <strong>${nodeId}</strong><br>` +
                `å½“å‰æ ‡ç­¾: ${getNodeTags(nodeId).join(', ') || 'æ— '}`;
                
            // æ¢å¤æ ‡ç­¾çŠ¶æ€
            restoreTagStates(nodeId);
            
            console.log(`ğŸ¯ é€‰æ‹©èŠ‚ç‚¹: ${nodeId}`);
        }

        // åˆ‡æ¢æ ‡ç­¾
        function toggleTag(tagElement) {
            if (!selectedNodeId) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            
            const tagName = tagElement.dataset.tag;
            const tagGroup = tagElement.dataset.group;
            
            // åˆ‡æ¢é€‰ä¸­çŠ¶æ€
            if (tagElement.classList.contains('selected')) {
                // å–æ¶ˆé€‰ä¸­
                tagElement.classList.remove('selected');
                removeTagFromNode(selectedNodeId, tagName, tagGroup);
                
                // å¦‚æœæ˜¯è·Ÿè¿›æ ‡ç­¾ï¼Œç§»é™¤èŠ‚ç‚¹èƒŒæ™¯è‰²
                if (tagName === 'è·Ÿè¿›') {
                    removeNodeBackgroundColor(selectedNodeId);
                }
                
                console.log(`âŒ ç§»é™¤æ ‡ç­¾: ${tagName}`);
            } else {
                // é€‰ä¸­
                tagElement.classList.add('selected');
                addTagToNode(selectedNodeId, tagName, tagGroup);
                
                // å¦‚æœæ˜¯è·Ÿè¿›æ ‡ç­¾ï¼Œè®¾ç½®èŠ‚ç‚¹èƒŒæ™¯è‰²ä¸ºæµ…è“è‰²
                if (tagName === 'è·Ÿè¿›') {
                    setNodeBackgroundColor(selectedNodeId, '#e3f2fd');
                }
                
                console.log(`âœ… æ·»åŠ æ ‡ç­¾: ${tagName}`);
            }
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updateStatusDisplay();
        }

        // æ·»åŠ æ ‡ç­¾åˆ°èŠ‚ç‚¹
        function addTagToNode(nodeId, tagName, tagGroup) {
            let targetArray;
            switch(tagGroup) {
                case 'å¸¸è§„':
                    targetArray = nodeData[nodeId].tags.status;
                    break;
                case 'AI':
                    targetArray = nodeData[nodeId].tags.technical;
                    break;
                case 'ç¬”è®°':
                    targetArray = nodeData[nodeId].tags.categories;
                    break;
                default:
                    targetArray = nodeData[nodeId].tags.categories;
            }
            
            if (!targetArray.includes(tagName)) {
                targetArray.push(tagName);
            }
        }

        // ä»èŠ‚ç‚¹ç§»é™¤æ ‡ç­¾
        function removeTagFromNode(nodeId, tagName, tagGroup) {
            let targetArray;
            switch(tagGroup) {
                case 'å¸¸è§„':
                    targetArray = nodeData[nodeId].tags.status;
                    break;
                case 'AI':
                    targetArray = nodeData[nodeId].tags.technical;
                    break;
                case 'ç¬”è®°':
                    targetArray = nodeData[nodeId].tags.categories;
                    break;
                default:
                    targetArray = nodeData[nodeId].tags.categories;
            }
            
            const index = targetArray.indexOf(tagName);
            if (index > -1) {
                targetArray.splice(index, 1);
            }
        }

        // è·å–èŠ‚ç‚¹æ ‡ç­¾
        function getNodeTags(nodeId) {
            const tags = nodeData[nodeId].tags;
            return [
                ...tags.status,
                ...tags.technical,
                ...tags.categories
            ];
        }

        // æ¢å¤æ ‡ç­¾çŠ¶æ€
        function restoreTagStates(nodeId) {
            const allSelectedTags = getNodeTags(nodeId);
            
            // æ¸…é™¤æ‰€æœ‰æ ‡ç­¾é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.tag-item').forEach(tagItem => {
                tagItem.classList.remove('selected');
            });
            
            // æ¢å¤é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.tag-item').forEach(tagItem => {
                const tagName = tagItem.dataset.tag;
                if (allSelectedTags.includes(tagName)) {
                    tagItem.classList.add('selected');
                }
            });
            
            // æ¢å¤è·Ÿè¿›æ ‡ç­¾çš„èƒŒæ™¯è‰²
            if (allSelectedTags.includes('è·Ÿè¿›')) {
                setNodeBackgroundColor(nodeId, '#e3f2fd');
            }
        }

        // è®¾ç½®èŠ‚ç‚¹èƒŒæ™¯è‰²
        function setNodeBackgroundColor(nodeId, color) {
            const nodeElement = document.getElementById(nodeId);
            if (nodeElement) {
                nodeElement.classList.add('follow-up-style');
                console.log(`ğŸ¨ èŠ‚ç‚¹ ${nodeId} èƒŒæ™¯è‰²å·²è®¾ç½®ä¸º: ${color}`);
                return true;
            }
            return false;
        }

        // ç§»é™¤èŠ‚ç‚¹èƒŒæ™¯è‰²
        function removeNodeBackgroundColor(nodeId) {
            const nodeElement = document.getElementById(nodeId);
            if (nodeElement) {
                nodeElement.classList.remove('follow-up-style');
                console.log(`ğŸ§¹ èŠ‚ç‚¹ ${nodeId} èƒŒæ™¯è‰²å·²ç§»é™¤`);
                return true;
            }
            return false;
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay() {
            if (!selectedNodeId) return;
            
            const tags = getNodeTags(selectedNodeId);
            document.getElementById('nodeStatus').innerHTML = 
                `âœ… å·²é€‰æ‹©èŠ‚ç‚¹: <strong>${selectedNodeId}</strong><br>` +
                `å½“å‰æ ‡ç­¾: ${tags.join(', ') || 'æ— '}`;
                
            document.getElementById('tagStatus').innerHTML = 
                `å½“å‰èŠ‚ç‚¹æ ‡ç­¾: ${tags.join(', ') || 'æ— '}`;
        }

        // è‡ªåŠ¨æµ‹è¯•
        function runAutoTest() {
            console.log('ğŸ§ª å¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
            
            // æµ‹è¯•æ­¥éª¤1: é€‰æ‹©èŠ‚ç‚¹1
            setTimeout(() => {
                selectNode('node1');
                console.log('âœ… æ­¥éª¤1: é€‰æ‹©èŠ‚ç‚¹1');
            }, 500);
            
            // æµ‹è¯•æ­¥éª¤2: ç‚¹å‡»è·Ÿè¿›æ ‡ç­¾
            setTimeout(() => {
                const followUpTag = document.querySelector('[data-tag="è·Ÿè¿›"]');
                toggleTag(followUpTag);
                console.log('âœ… æ­¥éª¤2: ç‚¹å‡»è·Ÿè¿›æ ‡ç­¾');
            }, 1000);
            
            // æµ‹è¯•æ­¥éª¤3: é€‰æ‹©èŠ‚ç‚¹2
            setTimeout(() => {
                selectNode('node2');
                console.log('âœ… æ­¥éª¤3: é€‰æ‹©èŠ‚ç‚¹2');
            }, 1500);
            
            // æµ‹è¯•æ­¥éª¤4: ç‚¹å‡»è·Ÿè¿›æ ‡ç­¾
            setTimeout(() => {
                const followUpTag = document.querySelector('[data-tag="è·Ÿè¿›"]');
                toggleTag(followUpTag);
                console.log('âœ… æ­¥éª¤4: ä¸ºèŠ‚ç‚¹2æ·»åŠ è·Ÿè¿›æ ‡ç­¾');
            }, 2000);
            
            // æµ‹è¯•æ­¥éª¤5: å›åˆ°èŠ‚ç‚¹1ï¼Œå–æ¶ˆè·Ÿè¿›æ ‡ç­¾
            setTimeout(() => {
                selectNode('node1');
                console.log('âœ… æ­¥éª¤5: å›åˆ°èŠ‚ç‚¹1');
            }, 2500);
            
            setTimeout(() => {
                const followUpTag = document.querySelector('[data-tag="è·Ÿè¿›"]');
                toggleTag(followUpTag);
                console.log('âœ… æ­¥éª¤6: å–æ¶ˆèŠ‚ç‚¹1çš„è·Ÿè¿›æ ‡ç­¾');
            }, 3000);
            
            setTimeout(() => {
                alert('ğŸ‰ è‡ªåŠ¨æµ‹è¯•å®Œæˆï¼è¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—å’ŒèŠ‚ç‚¹é¢œè‰²å˜åŒ–ã€‚');
            }, 3500);
        }

        // é‡ç½®æµ‹è¯•
        function resetTest() {
            // é‡ç½®æ•°æ®
            nodeData = {
                'node1': { tags: { categories: [], status: [], technical: [] } },
                'node2': { tags: { categories: [], status: [], technical: [] } },
                'node3': { tags: { categories: [], status: [], technical: [] } }
            };
            
            // æ¸…é™¤é€‰æ‹©
            selectedNodeId = null;
            document.querySelectorAll('.mock-node').forEach(node => {
                node.classList.remove('selected', 'follow-up-style');
            });
            
            // æ¸…é™¤æ ‡ç­¾é€‰æ‹©
            document.querySelectorAll('.tag-item').forEach(tag => {
                tag.classList.remove('selected');
            });
            
            // éšè—æ ‡ç­¾é¢æ¿
            document.getElementById('tagPanel').style.display = 'none';
            
            // é‡ç½®çŠ¶æ€æ˜¾ç¤º
            document.getElementById('nodeStatus').innerHTML = 'è¯·ç‚¹å‡»ä¸Šæ–¹èŠ‚ç‚¹è¿›è¡Œé€‰æ‹©';
            document.getElementById('tagStatus').innerHTML = 'æœªé€‰æ‹©ä»»ä½•æ ‡ç­¾';
            
            console.log('ğŸ”„ æµ‹è¯•å·²é‡ç½®');
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showTestResults() {
            const results = [];
            
            ['node1', 'node2', 'node3'].forEach(nodeId => {
                const tags = getNodeTags(nodeId);
                const hasFollowUp = tags.includes('è·Ÿè¿›');
                const element = document.getElementById(nodeId);
                const hasStyle = element.classList.contains('follow-up-style');
                
                results.push({
                    nodeId,
                    tags: tags.join(', ') || 'æ— ',
                    hasFollowUp,
                    hasStyle,
                    consistent: hasFollowUp === hasStyle
                });
            });
            
            let report = 'ğŸ“Š æµ‹è¯•ç»“æœæŠ¥å‘Š:\n\n';
            results.forEach(result => {
                report += `èŠ‚ç‚¹ ${result.nodeId}:\n`;
                report += `  - æ ‡ç­¾: ${result.tags}\n`;
                report += `  - æœ‰è·Ÿè¿›æ ‡ç­¾: ${result.hasFollowUp ? 'æ˜¯' : 'å¦'}\n`;
                report += `  - æœ‰èƒŒæ™¯æ ·å¼: ${result.hasStyle ? 'æ˜¯' : 'å¦'}\n`;
                report += `  - çŠ¶æ€ä¸€è‡´: ${result.consistent ? 'âœ…' : 'âŒ'}\n\n`;
            });
            
            const allConsistent = results.every(r => r.consistent);
            report += `æ€»ä½“çŠ¶æ€: ${allConsistent ? 'âœ… æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ä¸€è‡´' : 'âŒ å­˜åœ¨ä¸ä¸€è‡´çš„èŠ‚ç‚¹'}`;
            
            alert(report);
            console.log('ğŸ“Š æµ‹è¯•ç»“æœ:', results);
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ è·Ÿè¿›æ ‡ç­¾åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html> 