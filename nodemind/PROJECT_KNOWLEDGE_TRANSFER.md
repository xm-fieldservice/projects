# NodeMind V4 项目知识迁移文档

**文档版本**: v1.0  
**创建时间**: 2025-01-20  
**来源项目**: NodeMind (D:\AI-Projects\nodemind)  
**目标项目**: NodeMind V4 (D:\AI-Projects\nodemind-v4)  

---

## 🎯 **项目核心理念**

### **1. 万能节点数据底座**
这是NodeMind最核心的设计理念，在V4中必须继承和发扬：

```javascript
// 核心数据结构
const UniversalNodeData = {
    mindmapData: Map,      // 脑图数据
    nodeDatabase: Map,     // 节点数据库  
    sessionData: Map,      // 会话数据
    componentData: Map,    // 组件数据
    metaData: Map         // 元数据
};
```

**设计原则**：
- **统一数据接口** - 所有组件都通过统一接口访问数据
- **响应式更新** - 数据变化自动通知相关组件
- **类型安全** - 严格的数据类型验证
- **版本兼容** - 支持数据格式的向后兼容

### **2. 模块化架构**
V4必须实现真正的模块化，避免V1-V3的单文件问题：

```javascript
// 模块化原则
- 单一职责：每个模块只负责一个功能
- 清晰接口：明确的输入输出定义
- 松耦合：模块间通过事件通信
- 高内聚：相关功能组织在同一模块
```

## 📋 **核心功能需求**

### **1. 脑图功能**
基于jsMind的核心脑图功能：

```javascript
// 必须实现的核心功能
- 节点创建/编辑/删除
- 节点拖拽和重组
- 多级节点关系
- 节点样式和主题
- 脑图导入/导出
```

### **2. 四组件布局**
NodeMind的标志性四面板布局：

```
┌─────────────┬─────────────┐
│   脑图区域   │  节点详情   │
│  (MindMap)  │ (NodePanel) │
├─────────────┼─────────────┤
│  模板面板   │  项目信息   │
│(TemplatePanel)│(ProjectPanel)│
└─────────────┴─────────────┘
```

### **3. 节点数据结构**
标准的节点数据格式：

```javascript
// NodeMind标准节点格式
const NodeStructure = {
    id: "unique_id",
    title: "节点标题",
    content: "节点内容",
    type: "节点类型",
    parent: "父节点ID",
    children: ["子节点ID数组"],
    metadata: {
        created: "创建时间",
        modified: "修改时间",
        tags: ["标签数组"],
        priority: "优先级",
        status: "状态"
    },
    style: {
        color: "颜色",
        background: "背景色",
        font: "字体设置"
    }
};
```

### **4. 命令注入系统**
NodeMind的特色功能：

```javascript
// 注入系统核心
- 问答模式开关
- 模板选择机制
- 内容注入处理
- 会话记录管理
```

## 🔧 **技术架构要求**

### **1. 数据流架构**
```
用户操作 → 事件总线 → 数据底座 → 组件更新 → UI渲染
```

### **2. 组件通信**
```javascript
// 事件驱动通信
EventBus.emit('node:created', nodeData);
EventBus.on('node:updated', handleNodeUpdate);
```

### **3. 存储策略**
```javascript
// 多层存储
- 内存存储：实时数据操作
- 本地存储：用户数据持久化  
- 会话存储：临时数据缓存
- 文件导出：数据备份和分享
```

## 🎨 **UI/UX设计原则**

### **1. 响应式设计**
- 支持不同屏幕尺寸
- 面板可调整大小
- 移动端友好

### **2. 用户体验**
- 操作直观简单
- 快速响应反馈
- 错误处理友好
- 数据自动保存

### **3. 视觉设计**
- 现代化界面风格
- 清晰的信息层次
- 一致的交互模式
- 可定制的主题

## 🐛 **已知问题和解决方案**

### **1. 命令注入BUG**
**问题**：问答模式开关逻辑错误
**解决**：确保开关默认为未选中状态

### **2. 代码冗余问题**
**问题**：V1-V3存在大量重复代码
**解决**：V4采用严格的模块化设计

### **3. 性能问题**
**问题**：单文件过大导致加载慢
**解决**：模块化加载，按需引入

## 📊 **数据格式标准**

### **1. 脑图数据格式**
```json
{
  "meta": {
    "name": "脑图名称",
    "author": "作者",
    "version": "1.0"
  },
  "format": "node_tree",
  "data": {
    "id": "root",
    "topic": "根节点",
    "children": [...]
  }
}
```

### **2. 节点数据库格式**
```json
{
  "nodeId": {
    "id": "nodeId",
    "title": "标题",
    "content": "内容",
    "type": "类型",
    "metadata": {...},
    "relations": [...]
  }
}
```

### **3. 会话数据格式**
```json
{
  "sessionId": "unique_session_id",
  "timestamp": "2025-01-20T10:00:00Z",
  "type": "qa_mode|note_mode",
  "content": "会话内容",
  "context": {...}
}
```

## 🔄 **迁移策略**

### **1. 数据迁移**
- 支持从V1-V3格式导入
- 自动数据格式转换
- 数据完整性验证

### **2. 功能迁移**
- 核心功能优先迁移
- 逐步添加高级功能
- 保持向后兼容

### **3. 用户迁移**
- 平滑的升级体验
- 数据无损迁移
- 功能使用指导

## 🎯 **V4项目目标**

### **性能目标**
- 首屏加载时间 < 500ms
- 内存占用 < 50MB
- 文件大小 < 200KB

### **质量目标**
- 代码覆盖率 > 80%
- 模块化程度 > 90%
- 用户满意度 > 95%

### **功能目标**
- 100%功能对等
- 新增高级功能
- 更好的用户体验

## 📚 **参考文档**

### **原项目重要文档**
- `NodeMind项目元数据结构.md` - 数据结构标准
- `NodeMind脑图解析器标准v2.0.md` - 解析器规范
- `injection项目模块化解耦技术方案.md` - 模块化方案
- `NodeMind使用指南.md` - 功能使用说明

### **技术参考**
- jsMind官方文档
- Web Components标准
- ES6 Modules规范
- CSS Grid/Flexbox布局

## 🚀 **开发优先级**

### **第一阶段：核心架构**
1. 万能节点数据底座
2. 事件总线系统
3. 模块管理器
4. 基础组件框架

### **第二阶段：核心功能**
1. 脑图组件
2. 节点面板
3. 数据存储
4. 基础UI

### **第三阶段：高级功能**
1. 模板系统
2. 注入功能
3. 导入导出
4. 主题系统

### **第四阶段：完善优化**
1. 性能优化
2. 错误处理
3. 用户体验
4. 文档完善

---

**注意**：这份文档是V4项目的知识基础，开发过程中应该经常参考，确保V4项目继承了NodeMind的核心价值和设计理念。 