<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jsMind 思维导图示例</title>
    <!-- 引入 jsMind 的 CSS 文件 -->
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsmind@0.8.7/style/jsmind.css" />
    <!-- 引入 jsMind 的 JS 文件 -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jsmind@0.8.7/es6/jsmind.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        
        .controls {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            text-align: center;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        #jsmind_container {
            width: 100%;
            height: 600px;
            border: 1px solid #dee2e6;
            background: #fff;
        }
        
        .info {
            padding: 15px;
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            margin: 20px;
            border-radius: 4px;
        }
        
        .info h3 {
            margin: 0 0 10px 0;
            color: #007bff;
        }
        
        .info p {
            margin: 5px 0;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>jsMind 思维导图演示</h1>
            <p>一个基于JavaScript的开源思维导图框架</p>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="addNode()">添加节点</button>
            <button class="btn btn-secondary" onclick="editNode()">编辑节点</button>
            <button class="btn btn-danger" onclick="removeNode()">删除节点</button>
            <button class="btn btn-success" onclick="expandAll()">展开全部</button>
            <button class="btn btn-secondary" onclick="collapseAll()">收起全部</button>
            <button class="btn" onclick="changeTheme()">切换主题</button>
            <button class="btn btn-secondary" onclick="exportData()">导出数据</button>
        </div>
        
        <div id="jsmind_container"></div>
        
        <div class="info">
            <h3>操作说明：</h3>
            <p>• <strong>双击节点</strong>：直接编辑节点内容</p>
            <p>• <strong>单击节点</strong>：选中节点（选中后可使用上方按钮操作）</p>
            <p>• <strong>拖拽</strong>：可以拖拽整个思维导图进行移动</p>
            <p>• <strong>滚轮</strong>：可以缩放思维导图</p>
            <p>• <strong>添加节点</strong>：选中一个节点后点击"添加节点"按钮</p>
            <p>• <strong>删除节点</strong>：选中一个节点后点击"删除节点"按钮</p>
        </div>
    </div>

    <script type="text/javascript">
        // 思维导图数据
        var mind = {
            // 元数据
            meta: {
                name: "jsMind演示",
                author: "demo@example.com",
                version: "0.2"
            },
            // 数据格式声明
            format: "node_tree",
            // 数据内容
            data: {
                id: "root",
                topic: "jsMind思维导图",
                children: [
                    {
                        id: "easy",
                        topic: "简单易用",
                        direction: "right",
                        children: [
                            { id: "easy1", topic: "快速上手" },
                            { id: "easy2", topic: "丰富功能" },
                            { id: "easy3", topic: "高度可定制" }
                        ]
                    },
                    {
                        id: "powerful",
                        topic: "功能强大",
                        direction: "right",
                        children: [
                            { id: "powerful1", topic: "基于HTML5 Canvas" },
                            { id: "powerful2", topic: "支持多种主题" },
                            { id: "powerful3", topic: "支持拖拽编辑" }
                        ]
                    },
                    {
                        id: "opensource",
                        topic: "开源免费",
                        direction: "left",
                        children: [
                            { id: "opensource1", topic: "BSD协议" },
                            { id: "opensource2", topic: "GitHub托管" },
                            { id: "opensource3", topic: "活跃社区" }
                        ]
                    },
                    {
                        id: "compatibility",
                        topic: "兼容性好",
                        direction: "left",
                        children: [
                            { id: "compatibility1", topic: "现代浏览器" },
                            { id: "compatibility2", topic: "移动端支持" },
                            { id: "compatibility3", topic: "响应式设计" }
                        ]
                    }
                ]
            }
        };

        // 配置选项
        var options = {
            container: 'jsmind_container',  // 容器ID
            editable: true,                 // 是否可编辑
            theme: 'primary',              // 主题
            view: {
                engine: 'canvas',          // 渲染引擎
                hmargin: 100,              // 水平边距
                vmargin: 50,               // 垂直边距
                line_width: 2,             // 连线宽度
                line_color: '#558'         // 连线颜色
            },
            layout: {
                hspace: 30,                // 节点水平间距
                vspace: 20,                // 节点垂直间距
                pspace: 13                 // 节点与连线间距
            },
            shortcut: {
                enable: true,              // 启用快捷键
                handles: {},
                mapping: {
                    addchild: 45,          // Insert键添加子节点
                    addbrother: 13,        // Enter键添加兄弟节点
                    editnode: 113,         // F2键编辑节点
                    delnode: 46,           // Delete键删除节点
                    toggle: 32,            // 空格键展开/收起
                    left: 37,              // 左箭头
                    up: 38,                // 上箭头
                    right: 39,             // 右箭头
                    down: 40               // 下箭头
                }
            }
        };

        // 创建jsMind实例
        var jm = new jsMind(options);
        
        // 显示思维导图
        jm.show(mind);

        // 当前主题索引
        var currentThemeIndex = 0;
        var themes = ['primary', 'warning', 'danger', 'success', 'info', 'greensea', 'nephritis', 'belizehole', 'wisteria', 'asphalt', 'orange', 'pumpkin', 'pomegranate', 'clouds', 'asbestos'];

        // 添加节点
        function addNode() {
            var selected_node = jm.get_selected_node();
            if (!selected_node) {
                alert('请先选择一个节点');
                return;
            }
            var nodeid = jm.get_root().id + new Date().getTime();
            var topic = prompt('请输入节点内容:', '新节点');
            if (topic) {
                jm.add_node(selected_node, nodeid, topic);
            }
        }

        // 编辑节点
        function editNode() {
            var selected_node = jm.get_selected_node();
            if (!selected_node) {
                alert('请先选择一个节点');
                return;
            }
            if (selected_node.id == jm.get_root().id) {
                alert('根节点不能删除');
                return;
            }
            var topic = prompt('请输入新的节点内容:', selected_node.topic);
            if (topic) {
                jm.update_node(selected_node.id, topic);
            }
        }

        // 删除节点
        function removeNode() {
            var selected_node = jm.get_selected_node();
            if (!selected_node) {
                alert('请先选择一个节点');
                return;
            }
            if (selected_node.id == jm.get_root().id) {
                alert('根节点不能删除');
                return;
            }
            if (confirm('确定要删除选中的节点吗？')) {
                jm.remove_node(selected_node);
            }
        }

        // 展开全部
        function expandAll() {
            jm.expand_all();
        }

        // 收起全部
        function collapseAll() {
            var root = jm.get_root();
            var children = root.children;
            for (var i = 0; i < children.length; i++) {
                jm.collapse_node(children[i]);
            }
        }

        // 切换主题
        function changeTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            jm.set_theme(themes[currentThemeIndex]);
        }

        // 导出数据
        function exportData() {
            var mind_data = jm.get_data('node_tree');
            var json_str = JSON.stringify(mind_data, null, 2);
            
            // 创建一个新窗口显示JSON数据
            var newWindow = window.open('', '_blank');
            newWindow.document.write('<html><head><title>思维导图数据</title></head><body>');
            newWindow.document.write('<h3>思维导图JSON数据：</h3>');
            newWindow.document.write('<pre style="background:#f5f5f5;padding:15px;border-radius:5px;overflow:auto;">' + json_str + '</pre>');
            newWindow.document.write('</body></html>');
            newWindow.document.close();
        }

        // 监听节点选择事件
        jm.add_event_listener(function(type, data) {
            if (type === 'select_node') {
                console.log('选中节点:', data.node.topic);
            } else if (type === 'edit_node') {
                console.log('编辑节点:', data.node.topic);
            }
        });

        // 页面加载完成后的提示
        window.onload = function() {
            console.log('jsMind 思维导图已加载完成！');
            console.log('当前版本:', jsMind.version || '0.8.7');
        };
    </script>
</body>
</html> 