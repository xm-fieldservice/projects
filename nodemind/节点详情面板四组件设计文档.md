# 节点详情面板四组件设计文档

## 1. 概述

本文档详细描述了NodeMind节点详情面板的架构设计，包含4个核心组件的布局、联动关系和状态管理策略。

## 2. 整体布局结构

### 2.1 基础布局图

```
┌─────────────────────────────────────────────────────────┐
│                    标题区域（通栏）                      │
│  ┌─问答开关─┐                                          │
├──┴─────────┴──────────────┬────────────────────────────┤
│        左侧面板             │         右侧面板            │
│  ┌─────────────────────┐   │  ┌─────────────────────┐   │
│  │    内容编辑器        │   │  │     会话列表         │   │
│  │   (节点联动)        │   │  │   (节点联动)        │   │
│  └─────────────────────┘   │  └─────────────────────┘   │
│  ┌─────────────────────┐   │  ┌─────────────────────┐   │
│  │    标签组件         │   │  │    模板列表         │   │
│  │   (全局状态)        │   │  │   (全局状态)        │   │
│  └─────────────────────┘   │  └─────────────────────┘   │
└─────────────────────────────┴────────────────────────────┘
```

### 2.2 组件分组原则

- **左侧面板**：内容创作相关（内容编辑 + 标签组件）
- **右侧面板**：辅助功能（会话记录 + 模板工具）
- **联动组件**：内容编辑器 ↔ 会话列表
- **独立组件**：标签组件、模板列表

## 3. 四个核心组件详细设计

### 3.1 组件A：内容编辑器（节点联动）

**位置**：左侧面板上部
**功能**：
- 节点标题输入框
- 内容文本编辑器
- 操作按钮（复制、粘贴、提交）
- 元信息显示（创建时间、修改时间）

**行为特性**：
- ✅ 每次切换节点时自动更新内容
- ✅ 与会话列表联动：内容提交时生成新会话记录
- ✅ 自动保存编辑内容

### 3.2 组件B：标签组件（全局状态）

**位置**：左侧面板下部
**功能**：
- 分类标签（categories）
- 技术标签（technical）
- 状态标签（status）
- 自定义标签管理

**行为特性**：
- ❌ 不随节点切换而重新创建
- ❌ 不随节点切换而清空选择状态
- ✅ 保持全局选择状态，跨节点共享
- ✅ 标签选择状态持久化

### 3.3 组件C：会话列表（节点联动）

**位置**：右侧面板上部
**功能**：
- 当前节点的会话记录显示
- 新增会话按钮
- 查看全部会话按钮
- 清空会话按钮

**行为特性**：
- ✅ 每次切换节点时更新为该节点的会话记录
- ✅ 与内容编辑器联动：内容提交时自动新增会话
- ✅ 会话选择时可加载到内容编辑器
- ✅ 会话操作不影响其他节点的会话

### 3.4 组件D：模板列表（全局状态）

**位置**：右侧面板下部
**功能**：
- 已选中模板的展示
- 模板使用按钮
- 模板移除按钮
- 模板管理器入口

**行为特性**：
- ❌ 不随节点切换而清空
- ❌ 不随节点切换而重新创建
- ✅ 保持全局选择状态
- ✅ 模板选择状态跨节点保持

## 4. 标题区域自适应设计

### 4.1 问答模式开启时

**标题位置**：横跨左右两个区域的通栏显示
**标题行为**：
- 可以多行显示
- 根据内容长度自动调节高度
- 支持长标题的自动换行

**布局结构**：
```
[           标题通栏           ]
[  左侧面板  |   右侧面板   ]
```

### 4.2 问答模式关闭时

**标题位置**：仅在左侧区域显示
**标题行为**：
- 可以折叠显示
- 自动调整长度适应左侧宽度
- 超长标题使用省略号

**布局结构**：
```
[  标题（左侧）  ]
[  左侧面板（扩展到全宽）  ]
```

## 5. 问答开关控制逻辑

### 5.1 开关状态管理

**开关位置**：标题区域左上角
**状态特性**：
- 全局状态，不随节点切换而重置
- 状态持久化保存
- 默认状态：开启（可配置）

### 5.2 开关开启时（问答模式）

**显示组件**：
- ✅ 内容编辑器
- ✅ 标签组件  
- ✅ 会话列表
- ✅ 模板列表

**布局参数**：
- 左侧面板：60%宽度
- 右侧面板：40%宽度
- 分割线：显示，支持拖拽调整
- 标题区域：通栏显示，多行自适应

### 5.3 开关关闭时（纯编辑模式）

**显示组件**：
- ✅ 内容编辑器
- ✅ 标签组件
- ❌ 会话列表（隐藏）
- ❌ 模板列表（隐藏）

**布局参数**：
- 左侧面板：100%宽度
- 右侧面板：完全折叠隐藏
- 分割线：隐藏
- 标题区域：仅左侧显示，单行或折叠

## 6. 数据联动关系

### 6.1 节点切换时的更新策略

```javascript
function onNodeSwitch(newNode) {
    // 1. 更新节点联动组件
    updateContentEditor(newNode);     // 更新标题和内容
    updateSessionList(newNode);       // 更新会话列表
    
    // 2. 保持全局状态组件不变
    // 标签组件：保持当前选择状态
    // 模板列表：保持当前选择状态
    
    // 3. 更新标题显示
    updateTitleDisplay(newNode);
}
```

### 6.2 内容与会话的联动机制

**内容提交 → 会话记录**：
- 用户点击提交按钮
- 内容自动保存到当前节点
- 在会话列表中新增一条记录
- 会话记录包含时间戳和内容摘要

**会话选择 → 内容编辑器**：
- 用户点击会话记录
- 可选择是否覆盖当前编辑内容
- 加载会话内容到编辑器
- 不影响其他节点的会话

## 7. 组件持久化策略

### 7.1 需要保持状态的组件

**标签组件状态**：
- 当前选中的标签
- 标签的激活状态
- 自定义标签配置

**模板列表状态**：
- 已选择的模板集合
- 模板使用历史
- 模板配置偏好

**布局状态**：
- 问答开关状态
- 左右分栏的宽度比例
- 面板折叠状态

### 7.2 需要动态更新的组件

**内容编辑器**：
- 节点标题
- 节点内容
- 节点元信息（创建时间、修改时间）

**会话列表**：
- 当前节点的会话记录
- 会话操作按钮状态

## 8. DOM结构设计

```html
<div class="detail-workspace" id="detail-workspace">
    <!-- 标题区域（动态调整） -->
    <div class="title-area" id="dynamic-title-area">
        <div class="qa-toggle">
            <input type="checkbox" id="global-qa-mode">
            <label for="global-qa-mode">问答模式</label>
        </div>
        <div class="title-content" id="title-content">
            <!-- 节点标题，动态更新 -->
        </div>
    </div>
    
    <!-- 主内容区域 -->
    <div class="main-content-area" id="main-content-area">
        <!-- 左侧面板 -->
        <div class="left-panel" id="left-panel">
            <!-- 内容编辑器（节点联动） -->
            <div class="content-section" id="dynamic-content-section">
                <div class="content-header" id="content-header">
                    <!-- 操作按钮区域 -->
                </div>
                <div class="content-editor" id="content-editor">
                    <!-- 标题输入 + 内容编辑器 -->
                </div>
            </div>
            
            <!-- 标签组件（全局状态） -->
            <div class="tags-section" id="global-tags-section">
                <div class="tags-header">
                    <span>标签组件</span>
                </div>
                <div class="tag-groups-container" id="global-tag-groups">
                    <!-- 全局标签组件 -->
                </div>
            </div>
        </div>
        
        <!-- 分割线（可拖拽调整） -->
        <div class="main-splitter" id="main-splitter"></div>
        
        <!-- 右侧面板（可折叠） -->
        <div class="right-panel" id="right-panel">
            <!-- 会话列表（节点联动） -->
            <div class="session-section" id="dynamic-session-section">
                <div class="session-header">
                    <h4>会话列表</h4>
                    <div class="session-controls">
                        <!-- 会话操作按钮 -->
                    </div>
                </div>
                <div class="session-list" id="session-list">
                    <!-- 动态会话列表 -->
                </div>
            </div>
            
            <!-- 内部分割线 -->
            <div class="right-splitter" id="right-splitter"></div>
            
            <!-- 模板列表（全局状态） -->
            <div class="template-section" id="global-template-section">
                <div class="template-header">
                    <h4>模板列表</h4>
                    <button class="template-manager-btn" onclick="openTemplateManager()">
                        ⚙️ 模板管理
                    </button>
                </div>
                <div class="selected-templates-list" id="global-templates-list">
                    <!-- 全局模板列表 -->
                </div>
            </div>
        </div>
    </div>
</div>
```

## 9. 状态管理架构

### 9.1 全局状态管理器

```javascript
class GlobalStateManager {
    constructor() {
        this.tagState = new TagStateManager();
        this.templateState = new TemplateStateManager();
        this.layoutState = new LayoutStateManager();
    }
    
    // 管理跨节点的全局状态
}
```

### 9.2 节点状态管理器

```javascript
class NodeStateManager {
    constructor() {
        this.currentNodeId = null;
        this.nodeData = {};
        this.sessionData = {};
    }
    
    // 管理当前节点的内容和会话
}
```

### 9.3 布局状态管理器

```javascript
class LayoutStateManager {
    constructor() {
        this.qaMode = true;
        this.leftPanelWidth = '60%';
        this.rightPanelWidth = '40%';
    }
    
    // 管理布局状态和面板比例
}
```

## 10. 响应式设计考虑

### 10.1 窗口宽度自适应

**小屏幕（< 768px）**：
- 强制关闭问答模式
- 仅显示左侧面板
- 标题区域紧凑显示

**中等屏幕（768px - 1200px）**：
- 正常显示所有组件
- 调整左右面板比例为 70% : 30%
- 适当减少内边距

**大屏幕（> 1200px）**：
- 完整显示所有功能
- 默认比例 60% : 40%
- 充分利用屏幕空间

### 10.2 分割线拖拽功能

**拖拽范围限制**：
- 左侧面板最小宽度：400px
- 右侧面板最小宽度：300px
- 拖拽时实时更新比例

**拖拽状态保存**：
- 用户调整后的比例持久化
- 下次打开时恢复用户偏好
- 支持重置为默认比例

## 11. 实现优先级

### 11.1 第一阶段（核心功能）

1. ✅ 实现基础DOM结构
2. ✅ 实现问答开关控制逻辑
3. ✅ 实现节点联动组件的更新机制
4. ✅ 实现全局状态组件的持久化

### 11.2 第二阶段（交互优化）

1. ✅ 实现分割线拖拽功能
2. ✅ 实现响应式布局
3. ✅ 实现状态持久化
4. ✅ 实现内容与会话的联动

### 11.3 第三阶段（用户体验）

1. ✅ 添加动画过渡效果
2. ✅ 优化键盘快捷键
3. ✅ 添加拖拽提示和引导
4. ✅ 性能优化和错误处理

## 12. 技术实现要点

### 12.1 组件隔离策略

- 使用独立的容器ID避免冲突
- 全局组件使用 `global-` 前缀
- 动态组件使用 `dynamic-` 前缀
- 严格区分组件的更新范围

### 12.2 事件管理

- 全局状态变化时触发对应事件
- 节点切换时只更新必要的组件
- 避免不必要的DOM重绘和重排

### 12.3 性能优化

- 使用虚拟滚动优化大量会话记录
- 延迟加载非关键组件
- 缓存频繁访问的DOM元素

---

**文档版本**：v1.0  
**最后更新**：2025-06-18  
**维护者**：NodeMind开发团队 