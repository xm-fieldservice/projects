<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jsMind 快捷键测试页面</title>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsmind@0.8.7/style/jsmind.css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jsmind@0.8.7/es6/jsmind.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jsmind@0.8.7/es6/jsmind.draggable-node.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            margin: 20px;
            background: #f5f7fa;
        }
        
        .test-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .test-info {
            padding: 20px;
            background: #e8f4fd;
            border-left: 4px solid #2196f3;
            margin: 20px;
            border-radius: 6px;
        }
        
        .test-info h3 {
            margin: 0 0 15px 0;
            color: #1976d2;
        }
        
        .shortcut-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .shortcut-item {
            background: rgba(255,255,255,0.8);
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .shortcut-key {
            font-weight: bold;
            color: #d32f2f;
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        
        #jsmind_container {
            width: 100%;
            height: 400px;
            background: #fff;
            border-top: 1px solid #ddd;
        }
        
        .status {
            background: #2c3e50;
            color: white;
            padding: 10px 20px;
            font-size: 12px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>🧪 jsMind 快捷键测试</h1>
            <p>测试新的 Ctrl+Enter 快捷键功能</p>
        </div>
        
        <div class="test-info">
            <h3>🎮 快捷键测试说明</h3>
            <p><strong>主要变更：</strong>添加子节点的快捷键已从 <del>Insert</del> 改为 <span class="shortcut-key">Ctrl+Enter</span></p>
            
            <div class="shortcut-list">
                <div class="shortcut-item">
                    <strong>🆕 <span class="shortcut-key">Ctrl+Enter</span></strong><br>
                    添加子节点（新快捷键）
                </div>
                <div class="shortcut-item">
                    <strong><span class="shortcut-key">Enter</span></strong><br>
                    添加兄弟节点
                </div>
                <div class="shortcut-item">
                    <strong><span class="shortcut-key">F2</span></strong><br>
                    编辑节点内容
                </div>
                <div class="shortcut-item">
                    <strong><span class="shortcut-key">Delete</span></strong><br>
                    删除选中节点
                </div>
                <div class="shortcut-item">
                    <strong><span class="shortcut-key">Space</span></strong><br>
                    展开/收起节点
                </div>
                <div class="shortcut-item">
                    <strong><span class="shortcut-key">Ctrl+H</span></strong><br>
                    显示帮助信息
                </div>
            </div>
            
            <p style="margin-top: 15px;"><strong>测试步骤：</strong></p>
            <ol style="margin: 10px 0;">
                <li>点击选中任意节点（节点会有蓝色边框）</li>
                <li>按下 <span class="shortcut-key">Ctrl+Enter</span> 组合键</li>
                <li>观察是否成功添加了子节点</li>
                <li>尝试其他快捷键功能</li>
            </ol>
        </div>
        
        <div id="jsmind_container"></div>
        
        <div class="status">
            按 <span class="shortcut-key">Ctrl+H</span> 显示完整快捷键帮助 | 选中节点后按 <span class="shortcut-key">Ctrl+Enter</span> 添加子节点
        </div>
    </div>

    <script type="text/javascript">
        // 测试用的简单思维导图数据
        var testMind = {
            meta: {
                name: "快捷键测试",
                author: "Test",
                version: "1.0"
            },
            format: "node_tree",
            data: {
                id: "root",
                topic: "🧪 快捷键测试",
                children: [
                    {
                        id: "test1",
                        topic: "选中我测试 Ctrl+Enter",
                        direction: "right"
                    },
                    {
                        id: "test2", 
                        topic: "或者选中我测试",
                        direction: "right"
                    }
                ]
            }
        };

        // jsMind 配置
        var options = {
            container: 'jsmind_container',
            editable: true,
            theme: 'primary',
            view: {
                engine: 'canvas',
                hmargin: 100,
                vmargin: 50,
                line_width: 2,
                line_color: '#566'
            },
            layout: {
                hspace: 30,
                vspace: 20,
                pspace: 13
            },
            shortcut: {
                enable: true,
                handles: {},
                mapping: {
                    addchild: 4096 + 13,  // Ctrl+Enter 添加子节点 🆕
                    addbrother: 13,      // Enter 添加兄弟节点
                    editnode: 113,       // F2 编辑节点
                    delnode: 46,         // Delete 删除节点
                    toggle: 32,          // Space 展开/收起
                    left: 37, up: 38, right: 39, down: 40
                }
            }
        };

        // 创建jsMind实例
        var jm = new jsMind(options);
        jm.show(testMind);
        jm.enable_draggable_node();

        // 监听事件
        jm.add_event_listener(function(type, data) {
            if (type === 'select_node') {
                console.log('✅ 选中节点:', data.node.topic);
            } else if (type === 'add_node') {
                console.log('🆕 添加节点:', data.node.topic);
                alert('✅ 成功！Ctrl+Enter 快捷键工作正常\n新添加的节点: ' + data.node.topic);
            } else if (type === 'edit_node') {
                console.log('✏️ 编辑节点:', data.node.topic);
            } else if (type === 'remove_node') {
                console.log('🗑️ 删除节点:', data.node.topic);
            }
        });

        // 快捷键帮助
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'h') {
                e.preventDefault();
                alert('🎮 jsMind 快捷键帮助\n\n🆕 主要更新:\n• Ctrl+Enter - 添加子节点（新快捷键）\n\n📋 完整快捷键列表:\n• Ctrl+Enter - 添加子节点\n• Enter - 添加兄弟节点\n• F2 - 编辑节点内容\n• Delete - 删除节点\n• Space - 展开/收起节点\n• 方向键 - 选择相邻节点\n• Ctrl+H - 显示此帮助\n\n🖱️ 鼠标操作:\n• 单击 - 选中节点\n• 双击 - 编辑节点\n• 拖拽 - 移动节点结构');
            }
        });

        // 页面加载完成提示
        window.addEventListener('load', function() {
            console.log('🧪 快捷键测试页面已加载');
            console.log('📝 测试说明: 选中节点后按 Ctrl+Enter 添加子节点');
            
            // 3秒后显示提示
            setTimeout(function() {
                if (confirm('🎯 开始快捷键测试？\n\n点击"确定"查看测试说明')) {
                    alert('📋 测试步骤:\n\n1️⃣ 点击任意节点选中它\n2️⃣ 按下 Ctrl+Enter 组合键\n3️⃣ 观察是否添加了子节点\n4️⃣ 尝试其他快捷键\n\n💡 提示: 按 Ctrl+H 可随时查看帮助');
                }
            }, 1000);
        });
    </script>
</body>
</html> 