<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jsMind æ€ç»´å¯¼å›¾ç¤ºä¾‹ï¼ˆæ”¯æŒæ‹–æ‹½åŠŸèƒ½ï¼‰</title>
    <!-- å¼•å…¥ jsMind çš„ CSS æ–‡ä»¶ -->
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsmind@0.8.7/style/jsmind.css" />
    <!-- å¼•å…¥ jsMind çš„ JS æ–‡ä»¶ -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jsmind@0.8.7/es6/jsmind.js"></script>
    <!-- å¼•å…¥æ‹–æ‹½åŠŸèƒ½æ’ä»¶ -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jsmind@0.8.7/es6/jsmind.draggable-node.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            grid-template-rows: auto 1fr;
            height: 100vh;
            background: white;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 5px 0;
            font-size: 24px;
            font-weight: 600;
        }
        
        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin: 0;
        }
        
        /* å·¦ä¾§èŠ‚ç‚¹åˆ—è¡¨åŒºåŸŸ */
        .left-panel {
            background: #f8f9fa;
            border-right: 2px solid #dee2e6;
            display: flex;
            flex-direction: column;
        }
        
        .left-panel-header {
            background: #343a40;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .help-toggle-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .help-toggle-btn:hover {
            background: #0056b3;
        }
        
        .node-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            min-height: 200px;
        }
        
        .node-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .node-item:hover {
            background: #e3f2fd;
            border-color: #2196f3;
            transform: translateX(2px);
        }
        
        .node-item.active {
            background: #2196f3;
            color: white;
            border-color: #1976d2;
        }
        
        .node-item .node-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .node-item .node-info {
            font-size: 12px;
            opacity: 0.7;
        }
        
        /* ä¸­é—´æ€ç»´å¯¼å›¾åŒºåŸŸ */
        .center-panel {
            display: flex;
            flex-direction: column;
            background: #fff;
        }
        
        .toolbar {
            background: #f8f9fa;
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #1e7e34; }
        
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; }
        
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #545b62; }
        
        .btn-info { background: #17a2b8; }
        .btn-info:hover { background: #138496; }
        
        #jsmind_container {
            flex: 1;
            background: #fff;
        }
        
        /* å³ä¾§è¯¦æƒ…é¢æ¿ */
        .right-panel {
            background: #f8f9fa;
            border-left: 2px solid #dee2e6;
            display: flex;
            flex-direction: column;
        }
        
        .right-panel-header {
            background: #343a40;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }
        
        .node-details {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .detail-section {
            margin-bottom: 20px;
        }
        
        .detail-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .detail-content {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .detail-content.editable {
            min-height: 100px;
            resize: vertical;
        }
        
        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid #2196f3;
        }
        
        .no-selection {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            margin-top: 50px;
        }
        
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 250px 1fr 300px;
            }
        }
        
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr auto;
            }
            
            .left-panel, .right-panel {
                border: none;
                border-top: 1px solid #dee2e6;
                border-bottom: 1px solid #dee2e6;
            }
        }
        
        /* å¸®åŠ©åŒºåŸŸæ ·å¼ */
        .help-section {
            border-top: 1px solid #dee2e6;
            background: #fff;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .help-header {
            background: #17a2b8;
            color: white;
            padding: 10px 15px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .help-content {
            padding: 10px;
        }
        
        .help-item {
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            padding: 10px;
            border-left: 3px solid #007bff;
        }
        
        .help-title {
            font-weight: 600;
            font-size: 13px;
            color: #495057;
            margin-bottom: 8px;
        }
        
        .help-list {
            margin: 0;
            padding-left: 20px;
            font-size: 11px;
            line-height: 1.4;
        }
        
        .help-list li {
            margin: 4px 0;
            color: #666;
        }
        
        .help-list li strong {
            color: #d63384;
        }
        
        .no-nodes {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
            margin: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px dashed #dee2e6;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <h1>ğŸ§  jsMind èŠ‚ç‚¹ç®¡ç†ç³»ç»Ÿ</h1>
            <p class="subtitle">å·¦ä¾§é€‰æ‹©èŠ‚ç‚¹ | ä¸­é—´æŸ¥çœ‹è„‘å›¾ | å³ä¾§ç¼–è¾‘è¯¦æƒ…</p>
        </div>
        
        <!-- å·¦ä¾§èŠ‚ç‚¹åˆ—è¡¨ -->
        <div class="left-panel">
            <div class="left-panel-header">
                ğŸ“‹ èŠ‚ç‚¹åˆ—è¡¨
                <div>
                    <button class="help-toggle-btn" onclick="resetToOriginalView()" style="margin-right: 5px;">
                        ğŸ  åŸå§‹
                    </button>
                    <button class="help-toggle-btn" onclick="toggleHelp()" id="helpToggleBtn">
                        ğŸ“– æ˜¾ç¤ºå¸®åŠ©
                    </button>
                </div>
            </div>
            <div class="node-list" id="nodeList">
                <!-- èŠ‚ç‚¹åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- æ“ä½œæŒ‡å—åŒºåŸŸ -->
            <div class="help-section" id="helpSection" style="display: none;">
                <div class="help-header">ğŸ“– æ“ä½œæŒ‡å—</div>
                <div class="help-content">
                    <div class="help-item">
                        <div class="help-title">ğŸ–±ï¸ é¼ æ ‡æ“ä½œ</div>
                        <ul class="help-list">
                            <li>å•å‡»èŠ‚ç‚¹é€‰ä¸­</li>
                            <li>åŒå‡»èŠ‚ç‚¹ç¼–è¾‘å†…å®¹</li>
                            <li>æ‹–æ‹½ç”»å¸ƒç§»åŠ¨è§†å›¾</li>
                            <li>æ»šè½®ç¼©æ”¾æ€ç»´å¯¼å›¾</li>
                            <li><strong>æ‹–æ‹½èŠ‚ç‚¹é‡æ–°ç»„ç»‡ç»“æ„</strong></li>
                        </ul>
                    </div>
                    
                    <div class="help-item">
                        <div class="help-title">ğŸ“‹ åˆ—è¡¨æ“ä½œ</div>
                        <ul class="help-list">
                            <li><strong>ç‚¹å‡»åˆ—è¡¨é¡¹ - è®¾ä¸ºä¸­å¿ƒèŠ‚ç‚¹</strong></li>
                            <li>å±‚çº§ç¼©è¿›æ˜¾ç¤ºèŠ‚ç‚¹ç»“æ„</li>
                            <li>æ˜¾ç¤ºèŠ‚ç‚¹IDå’Œå±‚çº§ä¿¡æ¯</li>
                            <li>åŒæ­¥é€‰ä¸­çŠ¶æ€å’Œè¯¦æƒ…</li>
                            <li>ğŸ  åŸå§‹æŒ‰é’®å›åˆ°å®Œæ•´è§†å›¾</li>
                        </ul>
                    </div>
                    
                    <div class="help-item">
                        <div class="help-title">âŒ¨ï¸ å¿«æ·é”®</div>
                        <ul class="help-list">
                            <li>Ctrl+Enter - æ·»åŠ å­èŠ‚ç‚¹</li>
                            <li>Enter - æ·»åŠ å…„å¼ŸèŠ‚ç‚¹</li>
                            <li>F2 - ç¼–è¾‘èŠ‚ç‚¹å†…å®¹</li>
                            <li>Delete - åˆ é™¤é€‰ä¸­èŠ‚ç‚¹</li>
                            <li>Space - å±•å¼€/æ”¶èµ·èŠ‚ç‚¹</li>
                        </ul>
                    </div>
                    
                    <div class="help-item">
                        <div class="help-title">ğŸ”€ æ‹–æ‹½åŠŸèƒ½</div>
                        <ul class="help-list">
                            <li>æŒ‰ä½é¼ æ ‡å·¦é”®æ‹–æ‹½èŠ‚ç‚¹</li>
                            <li>æ‹–æ‹½åˆ°ç›®æ ‡èŠ‚ç‚¹ä¸Šé‡Šæ”¾</li>
                            <li>è¢«æ‹–æ‹½èŠ‚ç‚¹æˆä¸ºç›®æ ‡èŠ‚ç‚¹å­èŠ‚ç‚¹</li>
                            <li>æ”¯æŒè·¨åˆ†æ”¯æ‹–æ‹½ç§»åŠ¨</li>
                            <li>å¯ä»¥é€šè¿‡æŒ‰é’®å¼€å¯/å…³é—­æ‹–æ‹½</li>
                        </ul>
                    </div>
                    
                    <div class="help-item">
                        <div class="help-title">ğŸ¨ ä¸»é¢˜å’ŒåŠŸèƒ½</div>
                        <ul class="help-list">
                            <li>15ç§å†…ç½®ç²¾ç¾ä¸»é¢˜</li>
                            <li>æ”¯æŒè‡ªå®šä¹‰èŠ‚ç‚¹æ ·å¼</li>
                            <li>é«˜æ¸…Canvasæ¸²æŸ“</li>
                            <li>å“åº”å¼è®¾è®¡æ”¯æŒ</li>
                            <li>å¤šç§å¯¼å‡ºæ ¼å¼</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä¸­é—´æ€ç»´å¯¼å›¾ -->
        <div class="center-panel">
            <div class="toolbar">
                <button class="btn" onclick="addNode()">â• æ·»åŠ èŠ‚ç‚¹</button>
                <button class="btn btn-warning" onclick="editNode()">âœï¸ ç¼–è¾‘èŠ‚ç‚¹</button>
                <button class="btn btn-danger" onclick="removeNode()">ğŸ—‘ï¸ åˆ é™¤èŠ‚ç‚¹</button>
                <button class="btn btn-success" onclick="expandAll()">ğŸ“‚ å±•å¼€å…¨éƒ¨</button>
                <button class="btn btn-secondary" onclick="collapseAll()">ğŸ“ æ”¶èµ·å…¨éƒ¨</button>
                <button class="btn btn-info" onclick="changeTheme()">ğŸ¨ åˆ‡æ¢ä¸»é¢˜</button>
                <button class="btn btn-secondary" onclick="exportData()">ğŸ’¾ å¯¼å‡ºæ•°æ®</button>
                <button class="btn" onclick="toggleDrag()">ğŸ”€ <span id="dragStatus">ç¦ç”¨æ‹–æ‹½</span></button>
                <button class="btn btn-info" onclick="resetToOriginalView()">ğŸ  åŸå§‹è§†å›¾</button>
            </div>
            
            <div id="jsmind_container"></div>
        </div>
        
        <!-- å³ä¾§è¯¦æƒ…é¢æ¿ -->
        <div class="right-panel">
            <div class="right-panel-header">
                ğŸ“ èŠ‚ç‚¹è¯¦æƒ…
            </div>
            <div class="node-details" id="nodeDetails">
                <div class="no-selection">
                    è¯·ä»å·¦ä¾§åˆ—è¡¨æˆ–æ€ç»´å¯¼å›¾ä¸­é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹æŸ¥çœ‹è¯¦æƒ…
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // æ€ç»´å¯¼å›¾æ•°æ®
        var mindData = {
            meta: {
                name: "jsMindæ‹–æ‹½æ¼”ç¤º",
                author: "NodeMind Demo",
                version: "1.0.0"
            },
            format: "node_tree",
            data: {
                id: "root",
                topic: "ğŸ§  jsMind æ‹–æ‹½æ¼”ç¤º",
                children: [
                    {
                        id: "features",
                        topic: "ğŸš€ æ ¸å¿ƒç‰¹æ€§",
                        direction: "right",
                        children: [
                            { id: "feature1", topic: "çº¯JavaScriptå®ç°" },
                            { id: "feature2", topic: "HTML5 Canvasæ¸²æŸ“" },
                            { id: "feature3", topic: "æ”¯æŒèŠ‚ç‚¹æ‹–æ‹½" },
                            { id: "feature4", topic: "ä¸°å¯Œçš„äº¤äº’åŠŸèƒ½" }
                        ]
                    },
                    {
                        id: "drag",
                        topic: "ğŸ”€ æ‹–æ‹½åŠŸèƒ½",
                        direction: "right",
                        children: [
                            { id: "drag1", topic: "æ‹–æ‹½èŠ‚ç‚¹ç§»åŠ¨" },
                            { id: "drag2", topic: "è·¨åˆ†æ”¯æ‹–æ‹½" },
                            { id: "drag3", topic: "è‡ªåŠ¨é‡æ–°ç»„ç»‡" },
                            { id: "drag4", topic: "å®æ—¶è§†è§‰åé¦ˆ" }
                        ]
                    },
                    {
                        id: "usecases",
                        topic: "ğŸ“‹ åº”ç”¨åœºæ™¯",
                        direction: "right",
                        children: [
                            { id: "use1", topic: "çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ" },
                            { id: "use2", topic: "é¡¹ç›®è§„åˆ’å·¥å…·" },
                            { id: "use3", topic: "å­¦ä¹ ç¬”è®°æ•´ç†" },
                            { id: "use4", topic: "å›¢é˜Ÿåä½œå¹³å°" }
                        ]
                    },
                    {
                        id: "benefits",
                        topic: "â­ ä¸»è¦ä¼˜åŠ¿",
                        direction: "right",
                        children: [
                            { id: "benefit1", topic: "å¼€æºå…è´¹" },
                            { id: "benefit2", topic: "æ˜“äºé›†æˆ" },
                            { id: "benefit3", topic: "é«˜æ€§èƒ½æ¸²æŸ“" },
                            { id: "benefit4", topic: "å¤šç«¯å…¼å®¹" }
                        ]
                    }
                ]
            }
        };

        // é…ç½®é€‰é¡¹ï¼Œå¯ç”¨æ‹–æ‹½åŠŸèƒ½
        var options = {
            container: 'jsmind_container',
            editable: true,
            theme: 'primary',
            view: {
                engine: 'canvas',
                hmargin: 120,
                vmargin: 60,
                line_width: 2,
                line_color: '#566'
            },
            layout: {
                hspace: 30,
                vspace: 20,
                pspace: 13
            },
            shortcut: {
                enable: true,
                handles: {},
                mapping: {
                    addchild: 4096 + 13,  // Ctrl+Enter æ·»åŠ å­èŠ‚ç‚¹
                    addbrother: 13,  // Enter
                    editnode: 113,   // F2
                    delnode: 46,     // Delete
                    toggle: 32,      // Space
                    left: 37, up: 38, right: 39, down: 40
                }
            }
        };

        // åˆ›å»ºjsMindå®ä¾‹
        var jm = new jsMind(options);
        jm.show(mindData);

        // å¯ç”¨æ‹–æ‹½åŠŸèƒ½
        jm.enable_draggable_node();

        // ä¸»é¢˜åˆ—è¡¨
        var themes = [
            { name: 'primary', label: 'è“è‰²ä¸»é¢˜' },
            { name: 'success', label: 'æˆåŠŸç»¿' },
            { name: 'warning', label: 'è­¦å‘Šæ©™' },
            { name: 'danger', label: 'å±é™©çº¢' },
            { name: 'info', label: 'ä¿¡æ¯é’' },
            { name: 'greensea', label: 'æµ·ç»¿è‰²' },
            { name: 'nephritis', label: 'ç¿¡ç¿ ç»¿' },
            { name: 'belizehole', label: 'æ·±è“è‰²' },
            { name: 'wisteria', label: 'ç´«è—¤è‰²' },
            { name: 'asphalt', label: 'æ²¥é’ç°' },
            { name: 'orange', label: 'æ©™çº¢è‰²' },
            { name: 'pumpkin', label: 'å—ç“œè‰²' },
            { name: 'pomegranate', label: 'çŸ³æ¦´çº¢' },
            { name: 'clouds', label: 'äº‘æœµç™½' },
            { name: 'asbestos', label: 'çŸ³æ£‰ç°' }
        ];

        var currentThemeIndex = 0;
        var isDragEnabled = true;

        // æ·»åŠ èŠ‚ç‚¹
        function addNode() {
            var selected = jm.get_selected_node();
            if (!selected) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            
            var topic = prompt('è¯·è¾“å…¥æ–°èŠ‚ç‚¹çš„å†…å®¹:', 'æ–°èŠ‚ç‚¹');
            if (topic && topic.trim()) {
                var nodeId = 'node_' + Date.now();
                jm.add_node(selected, nodeId, topic.trim());
                showMessage('å·²æ·»åŠ èŠ‚ç‚¹: ' + topic);
                updateSelectedNodeDisplay();
            }
        }

        // ç¼–è¾‘èŠ‚ç‚¹
        function editNode() {
            var selected = jm.get_selected_node();
            if (!selected) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            
            var newTopic = prompt('è¯·è¾“å…¥æ–°çš„èŠ‚ç‚¹å†…å®¹:', selected.topic);
            if (newTopic && newTopic.trim()) {
                jm.update_node(selected.id, newTopic.trim());
                showMessage('å·²æ›´æ–°èŠ‚ç‚¹: ' + newTopic);
                updateSelectedNodeDisplay();
            }
        }

        // åˆ é™¤èŠ‚ç‚¹
        function removeNode() {
            var selected = jm.get_selected_node();
            if (!selected) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹');
                return;
            }
            
            if (selected.id === jm.get_root().id) {
                alert('æ ¹èŠ‚ç‚¹ä¸èƒ½åˆ é™¤');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤èŠ‚ç‚¹ "' + selected.topic + '" åŠå…¶æ‰€æœ‰å­èŠ‚ç‚¹å—ï¼Ÿ')) {
                var topic = selected.topic;
                jm.remove_node(selected);
                showMessage('å·²åˆ é™¤èŠ‚ç‚¹: ' + topic);
                updateSelectedNodeDisplay();
            }
        }

        // å±•å¼€å…¨éƒ¨
        function expandAll() {
            jm.expand_all();
            showMessage('å·²å±•å¼€æ‰€æœ‰èŠ‚ç‚¹');
        }

        // æ”¶èµ·å…¨éƒ¨
        function collapseAll() {
            var root = jm.get_root();
            if (root.children) {
                root.children.forEach(function(child) {
                    jm.collapse_node(child);
                });
            }
            showMessage('å·²æ”¶èµ·æ‰€æœ‰å­èŠ‚ç‚¹');
        }

        // åˆ‡æ¢ä¸»é¢˜
        function changeTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            var theme = themes[currentThemeIndex];
            jm.set_theme(theme.name);
            document.getElementById('currentTheme').textContent = theme.label;
            showMessage('å·²åˆ‡æ¢åˆ°ä¸»é¢˜: ' + theme.label);
        }

        // åˆ‡æ¢æ‹–æ‹½åŠŸèƒ½
        function toggleDrag() {
            if (isDragEnabled) {
                jm.disable_draggable_node();
                isDragEnabled = false;
                document.getElementById('dragStatus').textContent = 'å¯ç”¨æ‹–æ‹½';
                document.getElementById('dragEnabled').textContent = 'å·²ç¦ç”¨';
                showMessage('å·²ç¦ç”¨æ‹–æ‹½åŠŸèƒ½');
            } else {
                jm.enable_draggable_node();
                isDragEnabled = true;
                document.getElementById('dragStatus').textContent = 'ç¦ç”¨æ‹–æ‹½';
                document.getElementById('dragEnabled').textContent = 'å·²å¯ç”¨';
                showMessage('å·²å¯ç”¨æ‹–æ‹½åŠŸèƒ½');
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            var data = jm.get_data('node_tree');
            var jsonStr = JSON.stringify(data, null, 2);
            
            var newWindow = window.open('', '_blank', 'width=900,height=700');
            var htmlContent = '<!DOCTYPE html><html><head><title>æ€ç»´å¯¼å›¾æ•°æ®å¯¼å‡º</title>';
            htmlContent += '<style>body{font-family:Monaco,Consolas,monospace;margin:30px;background:#f8f9fa;}';
            htmlContent += '.container{background:white;padding:25px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}';
            htmlContent += 'h2{color:#2c3e50;margin:0 0 20px 0;}';
            htmlContent += 'pre{background:#f8f9fa;padding:20px;border-radius:6px;overflow:auto;border:1px solid #dee2e6;}</style>';
            htmlContent += '</head><body><div class="container">';
            htmlContent += '<h2>ğŸ§  æ€ç»´å¯¼å›¾ JSON æ•°æ®</h2>';
            htmlContent += '<pre>' + htmlContent.replace(/</g, '&lt;').replace(/>/g, '&gt;') + jsonStr + '</pre>';
            htmlContent += '</div></body></html>';
            
            newWindow.document.write(htmlContent);
            newWindow.document.close();
        }

        // æ›´æ–°é€‰ä¸­èŠ‚ç‚¹æ˜¾ç¤º
        function updateSelectedNodeDisplay() {
            var selected = jm.get_selected_node();
            var display = selected ? selected.topic : 'æ— ';
            if (display.length > 15) {
                display = display.substring(0, 15) + '...';
            }
            document.getElementById('selectedNode').textContent = display;
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message) {
            console.log('jsMind: ' + message);
            
            // åˆ›å»ºä¸´æ—¶æ¶ˆæ¯æç¤º
            var toast = document.createElement('div');
            toast.style.cssText = 'position:fixed;top:20px;right:20px;background:#28a745;color:white;padding:12px 20px;border-radius:6px;z-index:9999;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.15);';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(function() {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s ease';
                setTimeout(function() {
                    document.body.removeChild(toast);
                }, 300);
            }, 2000);
        }

        // äº‹ä»¶ç›‘å¬
        jm.add_event_listener(function(type, data) {
            if (type === 'select_node') {
                updateSelectedNodeDisplay();
                updateNodeDetails(data.node.id);
                console.log('é€‰ä¸­èŠ‚ç‚¹:', data.node.topic);
                
                // åŒæ­¥å·¦ä¾§åˆ—è¡¨çš„é€‰ä¸­çŠ¶æ€
                var allItems = document.querySelectorAll('.node-item');
                allItems.forEach(function(item) {
                    item.classList.remove('active');
                });
                var selectedItem = document.querySelector(`[data-node-id="${data.node.id}"]`);
                if (selectedItem) {
                    selectedItem.classList.add('active');
                }
            } else if (type === 'edit_node') {
                console.log('ç¼–è¾‘èŠ‚ç‚¹:', data.node.topic);
                generateNodeList(); // é‡æ–°ç”ŸæˆèŠ‚ç‚¹åˆ—è¡¨
                updateNodeDetails(data.node.id); // æ›´æ–°è¯¦æƒ…
            } else if (type === 'move_node') {
                showMessage('èŠ‚ç‚¹å·²ç§»åŠ¨: ' + data.node.topic);
                console.log('ç§»åŠ¨èŠ‚ç‚¹:', data.node.topic, 'åˆ°æ–°ä½ç½®');
                generateNodeList(); // é‡æ–°ç”ŸæˆèŠ‚ç‚¹åˆ—è¡¨
            } else if (type === 'add_node') {
                console.log('æ·»åŠ èŠ‚ç‚¹:', data.node.topic);
                generateNodeList(); // é‡æ–°ç”ŸæˆèŠ‚ç‚¹åˆ—è¡¨
                showMessage('âœ… å·²æ·»åŠ èŠ‚ç‚¹: ' + data.node.topic);
            } else if (type === 'remove_node') {
                console.log('åˆ é™¤èŠ‚ç‚¹:', data.node.topic);
                generateNodeList(); // é‡æ–°ç”ŸæˆèŠ‚ç‚¹åˆ—è¡¨
                // æ¸…ç©ºè¯¦æƒ…é¢æ¿
                document.getElementById('nodeDetails').innerHTML = '<div class="no-selection">è¯·é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹æŸ¥çœ‹è¯¦æƒ…</div>';
                showMessage('ğŸ—‘ï¸ å·²åˆ é™¤èŠ‚ç‚¹: ' + data.node.topic);
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            updateSelectedNodeDisplay();
            showMessage('ğŸ‰ jsMind èŠ‚ç‚¹ç®¡ç†ç³»ç»Ÿå·²å¯åŠ¨ï¼');
            console.log('jsMind èŠ‚ç‚¹ç®¡ç†ç³»ç»Ÿå·²å¯åŠ¨');
            console.log('ç‰ˆæœ¬: 0.8.7');
            console.log('æ‹–æ‹½åŠŸèƒ½: å·²å¯ç”¨');
            console.log('å½“å‰ä¸»é¢˜:', themes[currentThemeIndex].label);
            
            // åˆå§‹åŒ–èŠ‚ç‚¹åˆ—è¡¨ - å¤šæ¬¡å°è¯•ç¡®ä¿ç”ŸæˆæˆåŠŸ
            setTimeout(function() {
                generateNodeList();
                console.log('ğŸ“‹ ç¬¬ä¸€æ¬¡å°è¯•ç”ŸæˆèŠ‚ç‚¹åˆ—è¡¨');
            }, 300);
            
            setTimeout(function() {
                generateNodeList();
                console.log('ğŸ“‹ ç¬¬äºŒæ¬¡å°è¯•ç”ŸæˆèŠ‚ç‚¹åˆ—è¡¨');
            }, 800);
            
            setTimeout(function() {
                generateNodeList();
                console.log('ğŸ“‹ ç¬¬ä¸‰æ¬¡å°è¯•ç”ŸæˆèŠ‚ç‚¹åˆ—è¡¨');
            }, 1500);
        });

        // æ·»åŠ é”®ç›˜æ”¯æŒæç¤º
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'h') {
                e.preventDefault();
                alert('å¿«æ·é”®æç¤º:\n\nCtrl+Enter - æ·»åŠ å­èŠ‚ç‚¹\nEnter - æ·»åŠ å…„å¼ŸèŠ‚ç‚¹\nF2 - ç¼–è¾‘èŠ‚ç‚¹\nDelete - åˆ é™¤èŠ‚ç‚¹\nSpace - å±•å¼€/æ”¶èµ·èŠ‚ç‚¹\næ–¹å‘é”® - é€‰æ‹©ç›¸é‚»èŠ‚ç‚¹\n\né¼ æ ‡æ“ä½œ:\n- æ‹–æ‹½èŠ‚ç‚¹é‡æ–°ç»„ç»‡ç»“æ„\n- åŒå‡»èŠ‚ç‚¹ç¼–è¾‘å†…å®¹\n- æ»šè½®ç¼©æ”¾è§†å›¾');
            }
        });

        // æ·»åŠ å¸®åŠ©æŒ‰é’®æ§åˆ¶æ˜¾ç¤º/éšè—åŠŸèƒ½
        function toggleHelp() {
            var helpSection = document.getElementById('helpSection');
            var toggleBtn = document.getElementById('helpToggleBtn');
            
            if (helpSection.style.display === 'none') {
                helpSection.style.display = 'block';
                toggleBtn.textContent = 'ğŸ“– éšè—å¸®åŠ©';
                showMessage('ğŸ“– æ“ä½œæŒ‡å—å·²æ˜¾ç¤º');
            } else {
                helpSection.style.display = 'none';
                toggleBtn.textContent = 'ğŸ“– æ˜¾ç¤ºå¸®åŠ©';
                showMessage('ğŸ“– æ“ä½œæŒ‡å—å·²éšè—');
            }
        }

        // ç”ŸæˆèŠ‚ç‚¹åˆ—è¡¨
        function generateNodeList() {
            console.log('ğŸ”§ å¼€å§‹ç”ŸæˆèŠ‚ç‚¹åˆ—è¡¨...');
            var nodeListContainer = document.getElementById('nodeList');
            console.log('ğŸ“ nodeListå®¹å™¨:', nodeListContainer);
            
            var rootNode = jm.get_root();
            console.log('ğŸŒ³ æ ¹èŠ‚ç‚¹:', rootNode);
            
            if (!nodeListContainer) {
                console.error('âŒ æ‰¾ä¸åˆ°nodeListå®¹å™¨ï¼');
                return;
            }
            
            if (!rootNode) {
                console.log('âš ï¸ æ²¡æœ‰æ ¹èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºæš‚æ— èŠ‚ç‚¹');
                nodeListContainer.innerHTML = '<div class="no-nodes">æš‚æ— èŠ‚ç‚¹</div>';
                return;
            }
            
            var nodeItems = [];
            
            function collectNodes(node, depth = 0) {
                var indent = 'ã€€'.repeat(depth);
                nodeItems.push({
                    id: node.id,
                    topic: node.topic,
                    depth: depth,
                    indent: indent,
                    node: node
                });
                console.log('ğŸ“ æ”¶é›†èŠ‚ç‚¹:', depth, node.topic);
                
                if (node.children) {
                    node.children.forEach(function(child) {
                        collectNodes(child, depth + 1);
                    });
                }
            }
            
            collectNodes(rootNode);
            console.log('ğŸ“Š æ€»å…±æ”¶é›†åˆ°', nodeItems.length, 'ä¸ªèŠ‚ç‚¹');
            
            var html = '';
            nodeItems.forEach(function(item) {
                html += `
                    <div class="node-item" onclick="selectNodeFromList('${item.id}')" data-node-id="${item.id}">
                        <div class="node-title">${item.indent}${item.topic}</div>
                        <div class="node-info">å±‚çº§: ${item.depth} | ID: ${item.id}</div>
                    </div>
                `;
            });
            
            nodeListContainer.innerHTML = html;
            console.log('âœ… èŠ‚ç‚¹åˆ—è¡¨HTMLå·²æ›´æ–°ï¼Œé•¿åº¦:', html.length);
            console.log('ğŸ¯ èŠ‚ç‚¹åˆ—è¡¨ç”Ÿæˆå®Œæˆï¼');
        }
        
        // ä»åˆ—è¡¨é€‰æ‹©èŠ‚ç‚¹
        function selectNodeFromList(nodeId) {
            // ç§»é™¤ä¹‹å‰çš„é€‰ä¸­çŠ¶æ€
            var allItems = document.querySelectorAll('.node-item');
            allItems.forEach(function(item) {
                item.classList.remove('active');
            });
            
            // æ·»åŠ é€‰ä¸­çŠ¶æ€
            var selectedItem = document.querySelector(`[data-node-id="${nodeId}"]`);
            if (selectedItem) {
                selectedItem.classList.add('active');
            }
            
            // åœ¨æ€ç»´å¯¼å›¾ä¸­é€‰ä¸­èŠ‚ç‚¹
            jm.select_node(nodeId);
            
            // å°†é€‰ä¸­çš„èŠ‚ç‚¹ä½œä¸ºä¸­å¿ƒèŠ‚ç‚¹é‡æ–°æ˜¾ç¤ºæ€ç»´å¯¼å›¾
            var selectedNode = jm.get_node(nodeId);
            if (selectedNode) {
                // åˆ›å»ºä»¥é€‰ä¸­èŠ‚ç‚¹ä¸ºæ ¹çš„æ–°æ•°æ®ç»“æ„
                var newMindData = createSubMindMap(selectedNode);
                
                // é‡æ–°æ˜¾ç¤ºæ€ç»´å¯¼å›¾
                jm.show(newMindData);
                
                // å¯ç”¨æ‹–æ‹½åŠŸèƒ½
                jm.enable_draggable_node();
                
                showMessage('ğŸ¯ å·²å°† "' + selectedNode.topic + '" è®¾ä¸ºä¸­å¿ƒèŠ‚ç‚¹');
                console.log('è®¾ç½®ä¸­å¿ƒèŠ‚ç‚¹:', selectedNode.topic);
            }
            
            // æ›´æ–°è¯¦æƒ…é¢æ¿
            updateNodeDetails(nodeId);
        }
        
        // åˆ›å»ºä»¥æŒ‡å®šèŠ‚ç‚¹ä¸ºæ ¹çš„å­æ€ç»´å¯¼å›¾
        function createSubMindMap(centerNode) {
            return {
                meta: {
                    name: "åŠ¨æ€ä¸­å¿ƒ - " + centerNode.topic,
                    author: "NodeMind System", 
                    version: "1.0.0"
                },
                format: "node_tree",
                data: {
                    id: centerNode.id,
                    topic: centerNode.topic,
                    children: centerNode.children || []
                }
            };
        }
        
        // æ·»åŠ "å›åˆ°åŸå§‹è§†å›¾"æŒ‰é’®åŠŸèƒ½
        function resetToOriginalView() {
            jm.show(mindData);
            jm.enable_draggable_node();
            generateNodeList();
            showMessage('ğŸ  å·²å›åˆ°åŸå§‹æ€ç»´å¯¼å›¾è§†å›¾');
            
            // æ¸…é™¤å·¦ä¾§åˆ—è¡¨çš„é€‰ä¸­çŠ¶æ€
            var allItems = document.querySelectorAll('.node-item');
            allItems.forEach(function(item) {
                item.classList.remove('active');
            });
            
            // æ¸…ç©ºè¯¦æƒ…é¢æ¿
            document.getElementById('nodeDetails').innerHTML = '<div class="no-selection">è¯·ä»å·¦ä¾§åˆ—è¡¨æˆ–æ€ç»´å¯¼å›¾ä¸­é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹æŸ¥çœ‹è¯¦æƒ…</div>';
        }
        
        // æ›´æ–°èŠ‚ç‚¹è¯¦æƒ…é¢æ¿
        function updateNodeDetails(nodeId) {
            var node = jm.get_node(nodeId);
            var detailsContainer = document.getElementById('nodeDetails');
            
            if (!node) {
                detailsContainer.innerHTML = '<div class="no-selection">èŠ‚ç‚¹ä¸å­˜åœ¨</div>';
                return;
            }
            
            // æ¨¡æ‹ŸèŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå®é™…åº”ç”¨ä¸­å¯ä»¥ä»æ•°æ®åº“è·å–ï¼‰
            var createTime = new Date().toLocaleString('zh-CN');
            var tags = ['é‡è¦', 'é¡¹ç›®ç›¸å…³', 'å¾…å¤„ç†']; // ç¤ºä¾‹æ ‡ç­¾
            
            var html = `
                <div class="detail-section">
                    <div class="detail-label">ğŸ“ æ ‡é¢˜</div>
                    <div class="detail-content">${node.topic}</div>
                </div>
                
                <div class="detail-section">
                    <div class="detail-label">ğŸ“„ å†…å®¹æè¿°</div>
                    <textarea class="detail-content editable" placeholder="æš‚æ— å†…å®¹æè¿°ï¼Œç‚¹å‡»è¿™é‡Œæ·»åŠ ...">${node.topic}çš„è¯¦ç»†æè¿°å†…å®¹...</textarea>
                </div>
                
                <div class="detail-section">
                    <div class="detail-label">ğŸ• åˆ›å»ºæ—¶é—´</div>
                    <div class="detail-content">${createTime}</div>
                </div>
                
                <div class="detail-section">
                    <div class="detail-label">ğŸ·ï¸ æ ‡ç­¾</div>
                    <div class="detail-content">
                        <div class="tag-container">
                            ${tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="detail-label">ğŸ“Š èŠ‚ç‚¹ä¿¡æ¯</div>
                    <div class="detail-content">
                        <div>èŠ‚ç‚¹ID: ${node.id}</div>
                        <div>å­èŠ‚ç‚¹æ•°: ${node.children ? node.children.length : 0}</div>
                        <div>å±‚çº§æ·±åº¦: ${getNodeDepth(node)}</div>
                    </div>
                </div>
            `;
            
            detailsContainer.innerHTML = html;
        }
        
        // è·å–èŠ‚ç‚¹æ·±åº¦
        function getNodeDepth(targetNode) {
            var rootNode = jm.get_root();
            
            function findDepth(node, depth = 0) {
                if (node.id === targetNode.id) {
                    return depth;
                }
                
                if (node.children) {
                    for (var i = 0; i < node.children.length; i++) {
                        var result = findDepth(node.children[i], depth + 1);
                        if (result !== -1) {
                            return result;
                        }
                    }
                }
                
                return -1;
            }
            
            return findDepth(rootNode);
        }
    </script>
</body>
</html> 